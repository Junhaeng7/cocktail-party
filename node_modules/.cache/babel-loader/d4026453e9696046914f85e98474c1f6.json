{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2017-2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *\t http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function sent() {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) {\n      try {\n        if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [op[0] & 2, t.value];\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n          case 7:\n            op = _.ops.pop();\n            _.trys.pop();\n            continue;\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n              _.ops.push(op);\n              break;\n            }\n            if (t[2]) _.ops.pop();\n            _.trys.pop();\n            continue;\n        }\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar types_1 = require(\"./types\");\nvar core_1 = require(\"@aws-amplify/core\");\nvar amazon_cognito_identity_js_1 = require(\"amazon-cognito-identity-js\");\nvar url_1 = require(\"url\");\nvar OAuth_1 = __importDefault(require(\"./OAuth/OAuth\"));\nvar urlListener_1 = __importDefault(require(\"./urlListener\"));\nvar Errors_1 = require(\"./Errors\");\nvar Auth_1 = require(\"./types/Auth\");\nvar logger = new core_1.ConsoleLogger('AuthClass');\nvar USER_ADMIN_SCOPE = 'aws.cognito.signin.user.admin';\n// 10 sec, following this guide https://www.nngroup.com/articles/response-times-3-important-limits/\nvar OAUTH_FLOW_MS_TIMEOUT = 10 * 1000;\nvar AMPLIFY_SYMBOL = typeof Symbol !== 'undefined' && typeof Symbol.for === 'function' ? Symbol.for('amplify_default') : '@@amplify_default';\nvar dispatchAuthEvent = function dispatchAuthEvent(event, data, message) {\n  core_1.Hub.dispatch('auth', {\n    event: event,\n    data: data,\n    message: message\n  }, 'Auth', AMPLIFY_SYMBOL);\n};\n// Cognito Documentation for max device\n// tslint:disable-next-line:max-line-length\n// https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_ListDevices.html#API_ListDevices_RequestSyntax\nvar MAX_DEVICES = 60;\n/**\n * Provide authentication steps\n */\nvar AuthClass = /** @class */function () {\n  /**\n   * Initialize Auth with AWS configurations\n   * @param {Object} config - Configuration of the Auth\n   */\n  function AuthClass(config) {\n    var _this = this;\n    this.userPool = null;\n    this.user = null;\n    this.oAuthFlowInProgress = false;\n    this.Credentials = core_1.Credentials;\n    this.wrapRefreshSessionCallback = function (callback) {\n      var wrapped = function wrapped(error, data) {\n        if (data) {\n          dispatchAuthEvent('tokenRefresh', undefined, \"New token retrieved\");\n        } else {\n          dispatchAuthEvent('tokenRefresh_failure', error, \"Failed to retrieve new token\");\n        }\n        return callback(error, data);\n      };\n      return wrapped;\n    }; // prettier-ignore\n    this.configure(config);\n    this.currentCredentials = this.currentCredentials.bind(this);\n    this.currentUserCredentials = this.currentUserCredentials.bind(this);\n    core_1.Hub.listen('auth', function (_a) {\n      var payload = _a.payload;\n      var event = payload.event;\n      switch (event) {\n        case 'signIn':\n          _this._storage.setItem('amplify-signin-with-hostedUI', 'false');\n          break;\n        case 'signOut':\n          _this._storage.removeItem('amplify-signin-with-hostedUI');\n          break;\n        case 'cognitoHostedUI':\n          _this._storage.setItem('amplify-signin-with-hostedUI', 'true');\n          break;\n      }\n    });\n  }\n  AuthClass.prototype.getModuleName = function () {\n    return 'Auth';\n  };\n  AuthClass.prototype.configure = function (config) {\n    var _this = this;\n    if (!config) return this._config || {};\n    logger.debug('configure Auth');\n    var conf = Object.assign({}, this._config, core_1.Parser.parseMobilehubConfig(config).Auth, config);\n    this._config = conf;\n    var _a = this._config,\n      userPoolId = _a.userPoolId,\n      userPoolWebClientId = _a.userPoolWebClientId,\n      cookieStorage = _a.cookieStorage,\n      oauth = _a.oauth,\n      region = _a.region,\n      identityPoolId = _a.identityPoolId,\n      mandatorySignIn = _a.mandatorySignIn,\n      refreshHandlers = _a.refreshHandlers,\n      identityPoolRegion = _a.identityPoolRegion,\n      clientMetadata = _a.clientMetadata,\n      endpoint = _a.endpoint;\n    if (!this._config.storage) {\n      // backward compatability\n      if (cookieStorage) this._storage = new amazon_cognito_identity_js_1.CookieStorage(cookieStorage);else {\n        this._storage = config.ssr ? new core_1.UniversalStorage() : new core_1.StorageHelper().getStorage();\n      }\n    } else {\n      if (!this._isValidAuthStorage(this._config.storage)) {\n        logger.error('The storage in the Auth config is not valid!');\n        throw new Error('Empty storage object');\n      }\n      this._storage = this._config.storage;\n    }\n    this._storageSync = Promise.resolve();\n    if (typeof this._storage['sync'] === 'function') {\n      this._storageSync = this._storage['sync']();\n    }\n    if (userPoolId) {\n      var userPoolData = {\n        UserPoolId: userPoolId,\n        ClientId: userPoolWebClientId,\n        endpoint: endpoint\n      };\n      userPoolData.Storage = this._storage;\n      this.userPool = new amazon_cognito_identity_js_1.CognitoUserPool(userPoolData, this.wrapRefreshSessionCallback);\n    }\n    this.Credentials.configure({\n      mandatorySignIn: mandatorySignIn,\n      region: identityPoolRegion || region,\n      userPoolId: userPoolId,\n      identityPoolId: identityPoolId,\n      refreshHandlers: refreshHandlers,\n      storage: this._storage\n    });\n    // initialize cognitoauth client if hosted ui options provided\n    // to keep backward compatibility:\n    var cognitoHostedUIConfig = oauth ? types_1.isCognitoHostedOpts(this._config.oauth) ? oauth : oauth.awsCognito : undefined;\n    if (cognitoHostedUIConfig) {\n      var cognitoAuthParams = Object.assign({\n        cognitoClientId: userPoolWebClientId,\n        UserPoolId: userPoolId,\n        domain: cognitoHostedUIConfig['domain'],\n        scopes: cognitoHostedUIConfig['scope'],\n        redirectSignIn: cognitoHostedUIConfig['redirectSignIn'],\n        redirectSignOut: cognitoHostedUIConfig['redirectSignOut'],\n        responseType: cognitoHostedUIConfig['responseType'],\n        Storage: this._storage,\n        urlOpener: cognitoHostedUIConfig['urlOpener'],\n        clientMetadata: clientMetadata\n      }, cognitoHostedUIConfig['options']);\n      this._oAuthHandler = new OAuth_1.default({\n        scopes: cognitoAuthParams.scopes,\n        config: cognitoAuthParams,\n        cognitoClientId: cognitoAuthParams.cognitoClientId\n      });\n      // **NOTE** - Remove this in a future major release as it is a breaking change\n      // Prevents _handleAuthResponse from being called multiple times in Expo\n      // See https://github.com/aws-amplify/amplify-js/issues/4388\n      var usedResponseUrls_1 = {};\n      urlListener_1.default(function (_a) {\n        var url = _a.url;\n        if (usedResponseUrls_1[url]) {\n          return;\n        }\n        usedResponseUrls_1[url] = true;\n        _this._handleAuthResponse(url);\n      });\n    }\n    dispatchAuthEvent('configured', null, \"The Auth category has been configured successfully\");\n    return this._config;\n  };\n  /**\n   * Sign up with username, password and other attributes like phone, email\n   * @param {String | object} params - The user attributes used for signin\n   * @param {String[]} restOfAttrs - for the backward compatability\n   * @return - A promise resolves callback data if success\n   */\n  AuthClass.prototype.signUp = function (params) {\n    var _this = this;\n    var restOfAttrs = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n      restOfAttrs[_i - 1] = arguments[_i];\n    }\n    if (!this.userPool) {\n      return this.rejectNoUserPool();\n    }\n    var username = null;\n    var password = null;\n    var attributes = [];\n    var validationData = null;\n    var clientMetadata;\n    if (params && typeof params === 'string') {\n      username = params;\n      password = restOfAttrs ? restOfAttrs[0] : null;\n      var email = restOfAttrs ? restOfAttrs[1] : null;\n      var phone_number = restOfAttrs ? restOfAttrs[2] : null;\n      if (email) attributes.push(new amazon_cognito_identity_js_1.CognitoUserAttribute({\n        Name: 'email',\n        Value: email\n      }));\n      if (phone_number) attributes.push(new amazon_cognito_identity_js_1.CognitoUserAttribute({\n        Name: 'phone_number',\n        Value: phone_number\n      }));\n    } else if (params && typeof params === 'object') {\n      username = params['username'];\n      password = params['password'];\n      if (params && params.clientMetadata) {\n        clientMetadata = params.clientMetadata;\n      } else if (this._config.clientMetadata) {\n        clientMetadata = this._config.clientMetadata;\n      }\n      var attrs_1 = params['attributes'];\n      if (attrs_1) {\n        Object.keys(attrs_1).map(function (key) {\n          attributes.push(new amazon_cognito_identity_js_1.CognitoUserAttribute({\n            Name: key,\n            Value: attrs_1[key]\n          }));\n        });\n      }\n      var validationDataObject_1 = params['validationData'];\n      if (validationDataObject_1) {\n        validationData = [];\n        Object.keys(validationDataObject_1).map(function (key) {\n          validationData.push(new amazon_cognito_identity_js_1.CognitoUserAttribute({\n            Name: key,\n            Value: validationDataObject_1[key]\n          }));\n        });\n      }\n    } else {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.SignUpError);\n    }\n    if (!username) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyUsername);\n    }\n    if (!password) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyPassword);\n    }\n    logger.debug('signUp attrs:', attributes);\n    logger.debug('signUp validation data:', validationData);\n    return new Promise(function (resolve, reject) {\n      _this.userPool.signUp(username, password, attributes, validationData, function (err, data) {\n        if (err) {\n          dispatchAuthEvent('signUp_failure', err, username + \" failed to signup\");\n          reject(err);\n        } else {\n          dispatchAuthEvent('signUp', data, username + \" has signed up successfully\");\n          resolve(data);\n        }\n      }, clientMetadata);\n    });\n  };\n  /**\n   * Send the verification code to confirm sign up\n   * @param {String} username - The username to be confirmed\n   * @param {String} code - The verification code\n   * @param {ConfirmSignUpOptions} options - other options for confirm signup\n   * @return - A promise resolves callback data if success\n   */\n  AuthClass.prototype.confirmSignUp = function (username, code, options) {\n    if (!this.userPool) {\n      return this.rejectNoUserPool();\n    }\n    if (!username) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyUsername);\n    }\n    if (!code) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyCode);\n    }\n    var user = this.createCognitoUser(username);\n    var forceAliasCreation = options && typeof options.forceAliasCreation === 'boolean' ? options.forceAliasCreation : true;\n    var clientMetadata;\n    if (options && options.clientMetadata) {\n      clientMetadata = options.clientMetadata;\n    } else if (this._config.clientMetadata) {\n      clientMetadata = this._config.clientMetadata;\n    }\n    return new Promise(function (resolve, reject) {\n      user.confirmRegistration(code, forceAliasCreation, function (err, data) {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(data);\n        }\n      }, clientMetadata);\n    });\n  };\n  /**\n   * Resend the verification code\n   * @param {String} username - The username to be confirmed\n   * @param {ClientMetadata} clientMetadata - Metadata to be passed to Cognito Lambda triggers\n   * @return - A promise resolves code delivery details if successful\n   */\n  AuthClass.prototype.resendSignUp = function (username, clientMetadata) {\n    if (clientMetadata === void 0) {\n      clientMetadata = this._config.clientMetadata;\n    }\n    if (!this.userPool) {\n      return this.rejectNoUserPool();\n    }\n    if (!username) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyUsername);\n    }\n    var user = this.createCognitoUser(username);\n    return new Promise(function (resolve, reject) {\n      user.resendConfirmationCode(function (err, data) {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(data);\n        }\n      }, clientMetadata);\n    });\n  };\n  /**\n   * Sign in\n   * @param {String | SignInOpts} usernameOrSignInOpts - The username to be signed in or the sign in options\n   * @param {String} password - The password of the username\n   * @return - A promise resolves the CognitoUser\n   */\n  AuthClass.prototype.signIn = function (usernameOrSignInOpts, pw, clientMetadata) {\n    if (clientMetadata === void 0) {\n      clientMetadata = this._config.clientMetadata;\n    }\n    if (!this.userPool) {\n      return this.rejectNoUserPool();\n    }\n    var username = null;\n    var password = null;\n    var validationData = {};\n    // for backward compatibility\n    if (typeof usernameOrSignInOpts === 'string') {\n      username = usernameOrSignInOpts;\n      password = pw;\n    } else if (types_1.isUsernamePasswordOpts(usernameOrSignInOpts)) {\n      if (typeof pw !== 'undefined') {\n        logger.warn('The password should be defined under the first parameter object!');\n      }\n      username = usernameOrSignInOpts.username;\n      password = usernameOrSignInOpts.password;\n      validationData = usernameOrSignInOpts.validationData;\n    } else {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.InvalidUsername);\n    }\n    if (!username) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyUsername);\n    }\n    var authDetails = new amazon_cognito_identity_js_1.AuthenticationDetails({\n      Username: username,\n      Password: password,\n      ValidationData: validationData,\n      ClientMetadata: clientMetadata\n    });\n    if (password) {\n      return this.signInWithPassword(authDetails);\n    } else {\n      return this.signInWithoutPassword(authDetails);\n    }\n  };\n  /**\n   * Return an object with the authentication callbacks\n   * @param {CognitoUser} user - the cognito user object\n   * @param {} resolve - function called when resolving the current step\n   * @param {} reject - function called when rejecting the current step\n   * @return - an object with the callback methods for user authentication\n   */\n  AuthClass.prototype.authCallbacks = function (user, resolve, reject) {\n    var _this = this;\n    var that = this;\n    return {\n      onSuccess: function onSuccess(session) {\n        return __awaiter(_this, void 0, void 0, function () {\n          var cred, e_1, currentUser, e_2;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                logger.debug(session);\n                delete user['challengeName'];\n                delete user['challengeParam'];\n                _a.label = 1;\n              case 1:\n                _a.trys.push([1, 4, 5, 9]);\n                return [4 /*yield*/, this.Credentials.clear()];\n              case 2:\n                _a.sent();\n                return [4 /*yield*/, this.Credentials.set(session, 'session')];\n              case 3:\n                cred = _a.sent();\n                logger.debug('succeed to get cognito credentials', cred);\n                return [3 /*break*/, 9];\n              case 4:\n                e_1 = _a.sent();\n                logger.debug('cannot get cognito credentials', e_1);\n                return [3 /*break*/, 9];\n              case 5:\n                _a.trys.push([5, 7,, 8]);\n                return [4 /*yield*/, this.currentUserPoolUser()];\n              case 6:\n                currentUser = _a.sent();\n                that.user = currentUser;\n                dispatchAuthEvent('signIn', currentUser, \"A user \" + user.getUsername() + \" has been signed in\");\n                resolve(currentUser);\n                return [3 /*break*/, 8];\n              case 7:\n                e_2 = _a.sent();\n                logger.error('Failed to get the signed in user', e_2);\n                reject(e_2);\n                return [3 /*break*/, 8];\n              case 8:\n                return [7 /*endfinally*/];\n              case 9:\n                return [2 /*return*/];\n            }\n          });\n        });\n      },\n\n      onFailure: function onFailure(err) {\n        logger.debug('signIn failure', err);\n        dispatchAuthEvent('signIn_failure', err, user.getUsername() + \" failed to signin\");\n        reject(err);\n      },\n      customChallenge: function customChallenge(challengeParam) {\n        logger.debug('signIn custom challenge answer required');\n        user['challengeName'] = 'CUSTOM_CHALLENGE';\n        user['challengeParam'] = challengeParam;\n        resolve(user);\n      },\n      mfaRequired: function mfaRequired(challengeName, challengeParam) {\n        logger.debug('signIn MFA required');\n        user['challengeName'] = challengeName;\n        user['challengeParam'] = challengeParam;\n        resolve(user);\n      },\n      mfaSetup: function mfaSetup(challengeName, challengeParam) {\n        logger.debug('signIn mfa setup', challengeName);\n        user['challengeName'] = challengeName;\n        user['challengeParam'] = challengeParam;\n        resolve(user);\n      },\n      newPasswordRequired: function newPasswordRequired(userAttributes, requiredAttributes) {\n        logger.debug('signIn new password');\n        user['challengeName'] = 'NEW_PASSWORD_REQUIRED';\n        user['challengeParam'] = {\n          userAttributes: userAttributes,\n          requiredAttributes: requiredAttributes\n        };\n        resolve(user);\n      },\n      totpRequired: function totpRequired(challengeName, challengeParam) {\n        logger.debug('signIn totpRequired');\n        user['challengeName'] = challengeName;\n        user['challengeParam'] = challengeParam;\n        resolve(user);\n      },\n      selectMFAType: function selectMFAType(challengeName, challengeParam) {\n        logger.debug('signIn selectMFAType', challengeName);\n        user['challengeName'] = challengeName;\n        user['challengeParam'] = challengeParam;\n        resolve(user);\n      }\n    };\n  };\n  /**\n   * Sign in with a password\n   * @private\n   * @param {AuthenticationDetails} authDetails - the user sign in data\n   * @return - A promise resolves the CognitoUser object if success or mfa required\n   */\n  AuthClass.prototype.signInWithPassword = function (authDetails) {\n    var _this = this;\n    if (this.pendingSignIn) {\n      throw new Error('Pending sign-in attempt already in progress');\n    }\n    var user = this.createCognitoUser(authDetails.getUsername());\n    this.pendingSignIn = new Promise(function (resolve, reject) {\n      user.authenticateUser(authDetails, _this.authCallbacks(user, function (value) {\n        _this.pendingSignIn = null;\n        resolve(value);\n      }, function (error) {\n        _this.pendingSignIn = null;\n        reject(error);\n      }));\n    });\n    return this.pendingSignIn;\n  };\n  /**\n   * Sign in without a password\n   * @private\n   * @param {AuthenticationDetails} authDetails - the user sign in data\n   * @return - A promise resolves the CognitoUser object if success or mfa required\n   */\n  AuthClass.prototype.signInWithoutPassword = function (authDetails) {\n    var _this = this;\n    var user = this.createCognitoUser(authDetails.getUsername());\n    user.setAuthenticationFlowType('CUSTOM_AUTH');\n    return new Promise(function (resolve, reject) {\n      user.initiateAuth(authDetails, _this.authCallbacks(user, resolve, reject));\n    });\n  };\n  /**\n   * This was previously used by an authenticated user to get MFAOptions,\n   * but no longer returns a meaningful response. Refer to the documentation for\n   * how to setup and use MFA: https://docs.amplify.aws/lib/auth/mfa/q/platform/js\n   * @deprecated\n   * @param {CognitoUser} user - the current user\n   * @return - A promise resolves the current preferred mfa option if success\n   */\n  AuthClass.prototype.getMFAOptions = function (user) {\n    return new Promise(function (res, rej) {\n      user.getMFAOptions(function (err, mfaOptions) {\n        if (err) {\n          logger.debug('get MFA Options failed', err);\n          rej(err);\n          return;\n        }\n        logger.debug('get MFA options success', mfaOptions);\n        res(mfaOptions);\n        return;\n      });\n    });\n  };\n  /**\n   * get preferred mfa method\n   * @param {CognitoUser} user - the current cognito user\n   * @param {GetPreferredMFAOpts} params - options for getting the current user preferred MFA\n   */\n  AuthClass.prototype.getPreferredMFA = function (user, params) {\n    var _this = this;\n    var that = this;\n    return new Promise(function (res, rej) {\n      var clientMetadata = _this._config.clientMetadata; // TODO: verify behavior if this is override during signIn\n      var bypassCache = params ? params.bypassCache : false;\n      user.getUserData(function (err, data) {\n        if (err) {\n          logger.debug('getting preferred mfa failed', err);\n          rej(err);\n          return;\n        }\n        var mfaType = that._getMfaTypeFromUserData(data);\n        if (!mfaType) {\n          rej('invalid MFA Type');\n          return;\n        } else {\n          res(mfaType);\n          return;\n        }\n      }, {\n        bypassCache: bypassCache,\n        clientMetadata: clientMetadata\n      });\n    });\n  };\n  AuthClass.prototype._getMfaTypeFromUserData = function (data) {\n    var ret = null;\n    var preferredMFA = data.PreferredMfaSetting;\n    // if the user has used Auth.setPreferredMFA() to setup the mfa type\n    // then the \"PreferredMfaSetting\" would exist in the response\n    if (preferredMFA) {\n      ret = preferredMFA;\n    } else {\n      // if mfaList exists but empty, then its noMFA\n      var mfaList = data.UserMFASettingList;\n      if (!mfaList) {\n        // if SMS was enabled by using Auth.enableSMS(),\n        // the response would contain MFAOptions\n        // as for now Cognito only supports for SMS, so we will say it is 'SMS_MFA'\n        // if it does not exist, then it should be NOMFA\n        var MFAOptions = data.MFAOptions;\n        if (MFAOptions) {\n          ret = 'SMS_MFA';\n        } else {\n          ret = 'NOMFA';\n        }\n      } else if (mfaList.length === 0) {\n        ret = 'NOMFA';\n      } else {\n        logger.debug('invalid case for getPreferredMFA', data);\n      }\n    }\n    return ret;\n  };\n  AuthClass.prototype._getUserData = function (user, params) {\n    return new Promise(function (res, rej) {\n      user.getUserData(function (err, data) {\n        if (err) {\n          logger.debug('getting user data failed', err);\n          rej(err);\n          return;\n        } else {\n          res(data);\n          return;\n        }\n      }, params);\n    });\n  };\n  /**\n   * set preferred MFA method\n   * @param {CognitoUser} user - the current Cognito user\n   * @param {string} mfaMethod - preferred mfa method\n   * @return - A promise resolve if success\n   */\n  AuthClass.prototype.setPreferredMFA = function (user, mfaMethod) {\n    return __awaiter(this, void 0, void 0, function () {\n      var clientMetadata, userData, smsMfaSettings, totpMfaSettings, _a, mfaList, currentMFAType, that;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            clientMetadata = this._config.clientMetadata;\n            return [4 /*yield*/, this._getUserData(user, {\n              bypassCache: true,\n              clientMetadata: clientMetadata\n            })];\n          case 1:\n            userData = _b.sent();\n            smsMfaSettings = null;\n            totpMfaSettings = null;\n            _a = mfaMethod;\n            switch (_a) {\n              case 'TOTP':\n                return [3 /*break*/, 2];\n              case 'SOFTWARE_TOKEN_MFA':\n                return [3 /*break*/, 2];\n              case 'SMS':\n                return [3 /*break*/, 3];\n              case 'SMS_MFA':\n                return [3 /*break*/, 3];\n              case 'NOMFA':\n                return [3 /*break*/, 4];\n            }\n            return [3 /*break*/, 6];\n          case 2:\n            totpMfaSettings = {\n              PreferredMfa: true,\n              Enabled: true\n            };\n            return [3 /*break*/, 7];\n          case 3:\n            smsMfaSettings = {\n              PreferredMfa: true,\n              Enabled: true\n            };\n            return [3 /*break*/, 7];\n          case 4:\n            mfaList = userData['UserMFASettingList'];\n            return [4 /*yield*/, this._getMfaTypeFromUserData(userData)];\n          case 5:\n            currentMFAType = _b.sent();\n            if (currentMFAType === 'NOMFA') {\n              return [2 /*return*/, Promise.resolve('No change for mfa type')];\n            } else if (currentMFAType === 'SMS_MFA') {\n              smsMfaSettings = {\n                PreferredMfa: false,\n                Enabled: false\n              };\n            } else if (currentMFAType === 'SOFTWARE_TOKEN_MFA') {\n              totpMfaSettings = {\n                PreferredMfa: false,\n                Enabled: false\n              };\n            } else {\n              return [2 /*return*/, this.rejectAuthError(Auth_1.AuthErrorTypes.InvalidMFA)];\n            }\n            // if there is a UserMFASettingList in the response\n            // we need to disable every mfa type in that list\n            if (mfaList && mfaList.length !== 0) {\n              // to disable SMS or TOTP if exists in that list\n              mfaList.forEach(function (mfaType) {\n                if (mfaType === 'SMS_MFA') {\n                  smsMfaSettings = {\n                    PreferredMfa: false,\n                    Enabled: false\n                  };\n                } else if (mfaType === 'SOFTWARE_TOKEN_MFA') {\n                  totpMfaSettings = {\n                    PreferredMfa: false,\n                    Enabled: false\n                  };\n                }\n              });\n            }\n            return [3 /*break*/, 7];\n          case 6:\n            logger.debug('no validmfa method provided');\n            return [2 /*return*/, this.rejectAuthError(Auth_1.AuthErrorTypes.NoMFA)];\n          case 7:\n            that = this;\n            return [2 /*return*/, new Promise(function (res, rej) {\n              user.setUserMfaPreference(smsMfaSettings, totpMfaSettings, function (err, result) {\n                if (err) {\n                  logger.debug('Set user mfa preference error', err);\n                  return rej(err);\n                }\n                logger.debug('Set user mfa success', result);\n                logger.debug('Caching the latest user data into local');\n                // cache the latest result into user data\n                user.getUserData(function (err, data) {\n                  if (err) {\n                    logger.debug('getting user data failed', err);\n                    return rej(err);\n                  } else {\n                    return res(result);\n                  }\n                }, {\n                  bypassCache: true,\n                  clientMetadata: clientMetadata\n                });\n              });\n            })];\n        }\n      });\n    });\n  };\n  /**\n   * disable SMS\n   * @deprecated\n   * @param {CognitoUser} user - the current user\n   * @return - A promise resolves is success\n   */\n  AuthClass.prototype.disableSMS = function (user) {\n    return new Promise(function (res, rej) {\n      user.disableMFA(function (err, data) {\n        if (err) {\n          logger.debug('disable mfa failed', err);\n          rej(err);\n          return;\n        }\n        logger.debug('disable mfa succeed', data);\n        res(data);\n        return;\n      });\n    });\n  };\n  /**\n   * enable SMS\n   * @deprecated\n   * @param {CognitoUser} user - the current user\n   * @return - A promise resolves is success\n   */\n  AuthClass.prototype.enableSMS = function (user) {\n    return new Promise(function (res, rej) {\n      user.enableMFA(function (err, data) {\n        if (err) {\n          logger.debug('enable mfa failed', err);\n          rej(err);\n          return;\n        }\n        logger.debug('enable mfa succeed', data);\n        res(data);\n        return;\n      });\n    });\n  };\n  /**\n   * Setup TOTP\n   * @param {CognitoUser} user - the current user\n   * @return - A promise resolves with the secret code if success\n   */\n  AuthClass.prototype.setupTOTP = function (user) {\n    return new Promise(function (res, rej) {\n      user.associateSoftwareToken({\n        onFailure: function onFailure(err) {\n          logger.debug('associateSoftwareToken failed', err);\n          rej(err);\n          return;\n        },\n        associateSecretCode: function associateSecretCode(secretCode) {\n          logger.debug('associateSoftwareToken sucess', secretCode);\n          res(secretCode);\n          return;\n        }\n      });\n    });\n  };\n  /**\n   * verify TOTP setup\n   * @param {CognitoUser} user - the current user\n   * @param {string} challengeAnswer - challenge answer\n   * @return - A promise resolves is success\n   */\n  AuthClass.prototype.verifyTotpToken = function (user, challengeAnswer) {\n    logger.debug('verification totp token', user, challengeAnswer);\n    return new Promise(function (res, rej) {\n      user.verifySoftwareToken(challengeAnswer, 'My TOTP device', {\n        onFailure: function onFailure(err) {\n          logger.debug('verifyTotpToken failed', err);\n          rej(err);\n          return;\n        },\n        onSuccess: function onSuccess(data) {\n          dispatchAuthEvent('signIn', user, \"A user \" + user.getUsername() + \" has been signed in\");\n          logger.debug('verifyTotpToken success', data);\n          res(data);\n          return;\n        }\n      });\n    });\n  };\n  /**\n   * Send MFA code to confirm sign in\n   * @param {Object} user - The CognitoUser object\n   * @param {String} code - The confirmation code\n   */\n  AuthClass.prototype.confirmSignIn = function (user, code, mfaType, clientMetadata) {\n    var _this = this;\n    if (clientMetadata === void 0) {\n      clientMetadata = this._config.clientMetadata;\n    }\n    if (!code) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyCode);\n    }\n    var that = this;\n    return new Promise(function (resolve, reject) {\n      user.sendMFACode(code, {\n        onSuccess: function onSuccess(session) {\n          return __awaiter(_this, void 0, void 0, function () {\n            var cred, e_3;\n            return __generator(this, function (_a) {\n              switch (_a.label) {\n                case 0:\n                  logger.debug(session);\n                  _a.label = 1;\n                case 1:\n                  _a.trys.push([1, 4, 5, 6]);\n                  return [4 /*yield*/, this.Credentials.clear()];\n                case 2:\n                  _a.sent();\n                  return [4 /*yield*/, this.Credentials.set(session, 'session')];\n                case 3:\n                  cred = _a.sent();\n                  logger.debug('succeed to get cognito credentials', cred);\n                  return [3 /*break*/, 6];\n                case 4:\n                  e_3 = _a.sent();\n                  logger.debug('cannot get cognito credentials', e_3);\n                  return [3 /*break*/, 6];\n                case 5:\n                  that.user = user;\n                  dispatchAuthEvent('signIn', user, \"A user \" + user.getUsername() + \" has been signed in\");\n                  resolve(user);\n                  return [7 /*endfinally*/];\n                case 6:\n                  return [2 /*return*/];\n              }\n            });\n          });\n        },\n\n        onFailure: function onFailure(err) {\n          logger.debug('confirm signIn failure', err);\n          reject(err);\n        }\n      }, mfaType, clientMetadata);\n    });\n  };\n  AuthClass.prototype.completeNewPassword = function (user, password, requiredAttributes, clientMetadata) {\n    var _this = this;\n    if (requiredAttributes === void 0) {\n      requiredAttributes = {};\n    }\n    if (clientMetadata === void 0) {\n      clientMetadata = this._config.clientMetadata;\n    }\n    if (!password) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyPassword);\n    }\n    var that = this;\n    return new Promise(function (resolve, reject) {\n      user.completeNewPasswordChallenge(password, requiredAttributes, {\n        onSuccess: function onSuccess(session) {\n          return __awaiter(_this, void 0, void 0, function () {\n            var cred, e_4;\n            return __generator(this, function (_a) {\n              switch (_a.label) {\n                case 0:\n                  logger.debug(session);\n                  _a.label = 1;\n                case 1:\n                  _a.trys.push([1, 4, 5, 6]);\n                  return [4 /*yield*/, this.Credentials.clear()];\n                case 2:\n                  _a.sent();\n                  return [4 /*yield*/, this.Credentials.set(session, 'session')];\n                case 3:\n                  cred = _a.sent();\n                  logger.debug('succeed to get cognito credentials', cred);\n                  return [3 /*break*/, 6];\n                case 4:\n                  e_4 = _a.sent();\n                  logger.debug('cannot get cognito credentials', e_4);\n                  return [3 /*break*/, 6];\n                case 5:\n                  that.user = user;\n                  dispatchAuthEvent('signIn', user, \"A user \" + user.getUsername() + \" has been signed in\");\n                  resolve(user);\n                  return [7 /*endfinally*/];\n                case 6:\n                  return [2 /*return*/];\n              }\n            });\n          });\n        },\n\n        onFailure: function onFailure(err) {\n          logger.debug('completeNewPassword failure', err);\n          dispatchAuthEvent('completeNewPassword_failure', err, _this.user + \" failed to complete the new password flow\");\n          reject(err);\n        },\n        mfaRequired: function mfaRequired(challengeName, challengeParam) {\n          logger.debug('signIn MFA required');\n          user['challengeName'] = challengeName;\n          user['challengeParam'] = challengeParam;\n          resolve(user);\n        },\n        mfaSetup: function mfaSetup(challengeName, challengeParam) {\n          logger.debug('signIn mfa setup', challengeName);\n          user['challengeName'] = challengeName;\n          user['challengeParam'] = challengeParam;\n          resolve(user);\n        },\n        totpRequired: function totpRequired(challengeName, challengeParam) {\n          logger.debug('signIn mfa setup', challengeName);\n          user['challengeName'] = challengeName;\n          user['challengeParam'] = challengeParam;\n          resolve(user);\n        }\n      }, clientMetadata);\n    });\n  };\n  /**\n   * Send the answer to a custom challenge\n   * @param {CognitoUser} user - The CognitoUser object\n   * @param {String} challengeResponses - The confirmation code\n   */\n  AuthClass.prototype.sendCustomChallengeAnswer = function (user, challengeResponses, clientMetadata) {\n    var _this = this;\n    if (clientMetadata === void 0) {\n      clientMetadata = this._config.clientMetadata;\n    }\n    if (!this.userPool) {\n      return this.rejectNoUserPool();\n    }\n    if (!challengeResponses) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyChallengeResponse);\n    }\n    var that = this;\n    return new Promise(function (resolve, reject) {\n      user.sendCustomChallengeAnswer(challengeResponses, _this.authCallbacks(user, resolve, reject), clientMetadata);\n    });\n  };\n  /**\n   * Delete an authenticated users' attributes\n   * @param {CognitoUser} - The currently logged in user object\n   * @return {Promise}\n   **/\n  AuthClass.prototype.deleteUserAttributes = function (user, attributeNames) {\n    var that = this;\n    return new Promise(function (resolve, reject) {\n      that.userSession(user).then(function (session) {\n        user.deleteAttributes(attributeNames, function (err, result) {\n          if (err) {\n            return reject(err);\n          } else {\n            return resolve(result);\n          }\n        });\n      });\n    });\n  };\n  /**\n   * Update an authenticated users' attributes\n   * @param {CognitoUser} - The currently logged in user object\n   * @return {Promise}\n   **/\n  AuthClass.prototype.updateUserAttributes = function (user, attributes, clientMetadata) {\n    if (clientMetadata === void 0) {\n      clientMetadata = this._config.clientMetadata;\n    }\n    var attributeList = [];\n    var that = this;\n    return new Promise(function (resolve, reject) {\n      that.userSession(user).then(function (session) {\n        for (var key in attributes) {\n          if (key !== 'sub' && key.indexOf('_verified') < 0) {\n            var attr = {\n              Name: key,\n              Value: attributes[key]\n            };\n            attributeList.push(attr);\n          }\n        }\n        user.updateAttributes(attributeList, function (err, result) {\n          if (err) {\n            return reject(err);\n          } else {\n            return resolve(result);\n          }\n        }, clientMetadata);\n      });\n    });\n  };\n  /**\n   * Return user attributes\n   * @param {Object} user - The CognitoUser object\n   * @return - A promise resolves to user attributes if success\n   */\n  AuthClass.prototype.userAttributes = function (user) {\n    var _this = this;\n    return new Promise(function (resolve, reject) {\n      _this.userSession(user).then(function (session) {\n        user.getUserAttributes(function (err, attributes) {\n          if (err) {\n            reject(err);\n          } else {\n            resolve(attributes);\n          }\n        });\n      });\n    });\n  };\n  AuthClass.prototype.verifiedContact = function (user) {\n    var that = this;\n    return this.userAttributes(user).then(function (attributes) {\n      var attrs = that.attributesToObject(attributes);\n      var unverified = {};\n      var verified = {};\n      if (attrs['email']) {\n        if (attrs['email_verified']) {\n          verified['email'] = attrs['email'];\n        } else {\n          unverified['email'] = attrs['email'];\n        }\n      }\n      if (attrs['phone_number']) {\n        if (attrs['phone_number_verified']) {\n          verified['phone_number'] = attrs['phone_number'];\n        } else {\n          unverified['phone_number'] = attrs['phone_number'];\n        }\n      }\n      return {\n        verified: verified,\n        unverified: unverified\n      };\n    });\n  };\n  /**\n   * Get current authenticated user\n   * @return - A promise resolves to current authenticated CognitoUser if success\n   */\n  AuthClass.prototype.currentUserPoolUser = function (params) {\n    var _this = this;\n    if (!this.userPool) {\n      return this.rejectNoUserPool();\n    }\n    return new Promise(function (res, rej) {\n      _this._storageSync.then(function () {\n        return __awaiter(_this, void 0, void 0, function () {\n          var user, clientMetadata;\n          var _this = this;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                if (!this.isOAuthInProgress()) return [3 /*break*/, 2];\n                logger.debug('OAuth signIn in progress, waiting for resolution...');\n                return [4 /*yield*/, new Promise(function (res) {\n                  var timeoutId = setTimeout(function () {\n                    logger.debug('OAuth signIn in progress timeout');\n                    core_1.Hub.remove('auth', hostedUISignCallback);\n                    res();\n                  }, OAUTH_FLOW_MS_TIMEOUT);\n                  core_1.Hub.listen('auth', hostedUISignCallback);\n                  function hostedUISignCallback(_a) {\n                    var payload = _a.payload;\n                    var event = payload.event;\n                    if (event === 'cognitoHostedUI' || event === 'cognitoHostedUI_failure') {\n                      logger.debug(\"OAuth signIn resolved: \" + event);\n                      clearTimeout(timeoutId);\n                      core_1.Hub.remove('auth', hostedUISignCallback);\n                      res();\n                    }\n                  }\n                })];\n              case 1:\n                _a.sent();\n                _a.label = 2;\n              case 2:\n                user = this.userPool.getCurrentUser();\n                if (!user) {\n                  logger.debug('Failed to get user from user pool');\n                  rej('No current user');\n                  return [2 /*return*/];\n                }\n\n                clientMetadata = this._config.clientMetadata;\n                // refresh the session if the session expired.\n                user.getSession(function (err, session) {\n                  return __awaiter(_this, void 0, void 0, function () {\n                    var bypassCache, clientMetadata, _a, scope;\n                    var _this = this;\n                    return __generator(this, function (_b) {\n                      switch (_b.label) {\n                        case 0:\n                          if (err) {\n                            logger.debug('Failed to get the user session', err);\n                            rej(err);\n                            return [2 /*return*/];\n                          }\n\n                          bypassCache = params ? params.bypassCache : false;\n                          if (!bypassCache) return [3 /*break*/, 2];\n                          return [4 /*yield*/, this.Credentials.clear()];\n                        case 1:\n                          _b.sent();\n                          _b.label = 2;\n                        case 2:\n                          clientMetadata = this._config.clientMetadata;\n                          _a = session.getAccessToken().decodePayload().scope, scope = _a === void 0 ? '' : _a;\n                          if (scope.split(' ').includes(USER_ADMIN_SCOPE)) {\n                            user.getUserData(function (err, data) {\n                              if (err) {\n                                logger.debug('getting user data failed', err);\n                                // Make sure the user is still valid\n                                if (err.message === 'User is disabled.' || err.message === 'User does not exist.' || err.message === 'Access Token has been revoked' // Session revoked by another app\n                                ) {\n                                  rej(err);\n                                } else {\n                                  // the error may also be thrown when lack of permissions to get user info etc\n                                  // in that case we just bypass the error\n                                  res(user);\n                                }\n                                return;\n                              }\n                              var preferredMFA = data.PreferredMfaSetting || 'NOMFA';\n                              var attributeList = [];\n                              for (var i = 0; i < data.UserAttributes.length; i++) {\n                                var attribute = {\n                                  Name: data.UserAttributes[i].Name,\n                                  Value: data.UserAttributes[i].Value\n                                };\n                                var userAttribute = new amazon_cognito_identity_js_1.CognitoUserAttribute(attribute);\n                                attributeList.push(userAttribute);\n                              }\n                              var attributes = _this.attributesToObject(attributeList);\n                              Object.assign(user, {\n                                attributes: attributes,\n                                preferredMFA: preferredMFA\n                              });\n                              return res(user);\n                            }, {\n                              bypassCache: bypassCache,\n                              clientMetadata: clientMetadata\n                            });\n                          } else {\n                            logger.debug(\"Unable to get the user data because the \" + USER_ADMIN_SCOPE + \" \" + \"is not in the scopes of the access token\");\n                            return [2 /*return*/, res(user)];\n                          }\n                          return [2 /*return*/];\n                      }\n                    });\n                  });\n                }, {\n                  clientMetadata: clientMetadata\n                });\n                return [2 /*return*/];\n            }\n          });\n        });\n      }).catch(function (e) {\n        logger.debug('Failed to sync cache info into memory', e);\n        return rej(e);\n      });\n    });\n  };\n  AuthClass.prototype.isOAuthInProgress = function () {\n    return this.oAuthFlowInProgress;\n  };\n  /**\n   * Get current authenticated user\n   * @param {CurrentUserOpts} - options for getting the current user\n   * @return - A promise resolves to current authenticated CognitoUser if success\n   */\n  AuthClass.prototype.currentAuthenticatedUser = function (params) {\n    return __awaiter(this, void 0, void 0, function () {\n      var federatedUser, e_5, federatedInfo, user, e_6;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            logger.debug('getting current authenticated user');\n            federatedUser = null;\n            _a.label = 1;\n          case 1:\n            _a.trys.push([1, 3,, 4]);\n            return [4 /*yield*/, this._storageSync];\n          case 2:\n            _a.sent();\n            return [3 /*break*/, 4];\n          case 3:\n            e_5 = _a.sent();\n            logger.debug('Failed to sync cache info into memory', e_5);\n            throw e_5;\n          case 4:\n            try {\n              federatedInfo = JSON.parse(this._storage.getItem('aws-amplify-federatedInfo'));\n              if (federatedInfo) {\n                federatedUser = __assign(__assign({}, federatedInfo.user), {\n                  token: federatedInfo.token\n                });\n              }\n            } catch (e) {\n              logger.debug('cannot load federated user from auth storage');\n            }\n            if (!federatedUser) return [3 /*break*/, 5];\n            this.user = federatedUser;\n            logger.debug('get current authenticated federated user', this.user);\n            return [2 /*return*/, this.user];\n          case 5:\n            logger.debug('get current authenticated userpool user');\n            user = null;\n            _a.label = 6;\n          case 6:\n            _a.trys.push([6, 8,, 9]);\n            return [4 /*yield*/, this.currentUserPoolUser(params)];\n          case 7:\n            user = _a.sent();\n            return [3 /*break*/, 9];\n          case 8:\n            e_6 = _a.sent();\n            if (e_6 === 'No userPool') {\n              logger.error('Cannot get the current user because the user pool is missing. ' + 'Please make sure the Auth module is configured with a valid Cognito User Pool ID');\n            }\n            logger.debug('The user is not authenticated by the error', e_6);\n            return [2 /*return*/, Promise.reject('The user is not authenticated')];\n          case 9:\n            this.user = user;\n            return [2 /*return*/, this.user];\n        }\n      });\n    });\n  };\n  /**\n   * Get current user's session\n   * @return - A promise resolves to session object if success\n   */\n  AuthClass.prototype.currentSession = function () {\n    var that = this;\n    logger.debug('Getting current session');\n    // Purposely not calling the reject method here because we don't need a console error\n    if (!this.userPool) {\n      return Promise.reject();\n    }\n    return new Promise(function (res, rej) {\n      that.currentUserPoolUser().then(function (user) {\n        that.userSession(user).then(function (session) {\n          res(session);\n          return;\n        }).catch(function (e) {\n          logger.debug('Failed to get the current session', e);\n          rej(e);\n          return;\n        });\n      }).catch(function (e) {\n        logger.debug('Failed to get the current user', e);\n        rej(e);\n        return;\n      });\n    });\n  };\n  /**\n   * Get the corresponding user session\n   * @param {Object} user - The CognitoUser object\n   * @return - A promise resolves to the session\n   */\n  AuthClass.prototype.userSession = function (user) {\n    if (!user) {\n      logger.debug('the user is null');\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.NoUserSession);\n    }\n    var clientMetadata = this._config.clientMetadata; // TODO: verify behavior if this is override during signIn\n    return new Promise(function (resolve, reject) {\n      logger.debug('Getting the session from this user:', user);\n      user.getSession(function (err, session) {\n        if (err) {\n          logger.debug('Failed to get the session from user', user);\n          reject(err);\n          return;\n        } else {\n          logger.debug('Succeed to get the user session', session);\n          resolve(session);\n          return;\n        }\n      }, {\n        clientMetadata: clientMetadata\n      });\n    });\n  };\n  /**\n   * Get authenticated credentials of current user.\n   * @return - A promise resolves to be current user's credentials\n   */\n  AuthClass.prototype.currentUserCredentials = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var e_7, federatedInfo;\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            logger.debug('Getting current user credentials');\n            _a.label = 1;\n          case 1:\n            _a.trys.push([1, 3,, 4]);\n            return [4 /*yield*/, this._storageSync];\n          case 2:\n            _a.sent();\n            return [3 /*break*/, 4];\n          case 3:\n            e_7 = _a.sent();\n            logger.debug('Failed to sync cache info into memory', e_7);\n            throw e_7;\n          case 4:\n            federatedInfo = null;\n            try {\n              federatedInfo = JSON.parse(this._storage.getItem('aws-amplify-federatedInfo'));\n            } catch (e) {\n              logger.debug('failed to get or parse item aws-amplify-federatedInfo', e);\n            }\n            if (federatedInfo) {\n              // refresh the jwt token here if necessary\n              return [2 /*return*/, this.Credentials.refreshFederatedToken(federatedInfo)];\n            } else {\n              return [2 /*return*/, this.currentSession().then(function (session) {\n                logger.debug('getting session success', session);\n                return _this.Credentials.set(session, 'session');\n              }).catch(function (error) {\n                logger.debug('getting session failed', error);\n                return _this.Credentials.set(null, 'guest');\n              })];\n            }\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  AuthClass.prototype.currentCredentials = function () {\n    logger.debug('getting current credentials');\n    return this.Credentials.get();\n  };\n  /**\n   * Initiate an attribute confirmation request\n   * @param {Object} user - The CognitoUser\n   * @param {Object} attr - The attributes to be verified\n   * @return - A promise resolves to callback data if success\n   */\n  AuthClass.prototype.verifyUserAttribute = function (user, attr, clientMetadata) {\n    if (clientMetadata === void 0) {\n      clientMetadata = this._config.clientMetadata;\n    }\n    return new Promise(function (resolve, reject) {\n      user.getAttributeVerificationCode(attr, {\n        onSuccess: function onSuccess(success) {\n          return resolve(success);\n        },\n        onFailure: function onFailure(err) {\n          return reject(err);\n        }\n      }, clientMetadata);\n    });\n  };\n  /**\n   * Confirm an attribute using a confirmation code\n   * @param {Object} user - The CognitoUser\n   * @param {Object} attr - The attribute to be verified\n   * @param {String} code - The confirmation code\n   * @return - A promise resolves to callback data if success\n   */\n  AuthClass.prototype.verifyUserAttributeSubmit = function (user, attr, code) {\n    if (!code) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyCode);\n    }\n    return new Promise(function (resolve, reject) {\n      user.verifyAttribute(attr, code, {\n        onSuccess: function onSuccess(data) {\n          resolve(data);\n          return;\n        },\n        onFailure: function onFailure(err) {\n          reject(err);\n          return;\n        }\n      });\n    });\n  };\n  AuthClass.prototype.verifyCurrentUserAttribute = function (attr) {\n    var that = this;\n    return that.currentUserPoolUser().then(function (user) {\n      return that.verifyUserAttribute(user, attr);\n    });\n  };\n  /**\n   * Confirm current user's attribute using a confirmation code\n   * @param {Object} attr - The attribute to be verified\n   * @param {String} code - The confirmation code\n   * @return - A promise resolves to callback data if success\n   */\n  AuthClass.prototype.verifyCurrentUserAttributeSubmit = function (attr, code) {\n    var that = this;\n    return that.currentUserPoolUser().then(function (user) {\n      return that.verifyUserAttributeSubmit(user, attr, code);\n    });\n  };\n  AuthClass.prototype.cognitoIdentitySignOut = function (opts, user) {\n    return __awaiter(this, void 0, void 0, function () {\n      var e_8, isSignedInHostedUI;\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n            return [4 /*yield*/, this._storageSync];\n          case 1:\n            _a.sent();\n            return [3 /*break*/, 3];\n          case 2:\n            e_8 = _a.sent();\n            logger.debug('Failed to sync cache info into memory', e_8);\n            throw e_8;\n          case 3:\n            isSignedInHostedUI = this._oAuthHandler && this._storage.getItem('amplify-signin-with-hostedUI') === 'true';\n            return [2 /*return*/, new Promise(function (res, rej) {\n              if (opts && opts.global) {\n                logger.debug('user global sign out', user);\n                // in order to use global signout\n                // we must validate the user as an authenticated user by using getSession\n                var clientMetadata = _this._config.clientMetadata; // TODO: verify behavior if this is override during signIn\n                user.getSession(function (err, result) {\n                  if (err) {\n                    logger.debug('failed to get the user session', err);\n                    return rej(err);\n                  }\n                  user.globalSignOut({\n                    onSuccess: function onSuccess(data) {\n                      logger.debug('global sign out success');\n                      if (isSignedInHostedUI) {\n                        _this.oAuthSignOutRedirect(res, rej);\n                      } else {\n                        return res();\n                      }\n                    },\n                    onFailure: function onFailure(err) {\n                      logger.debug('global sign out failed', err);\n                      return rej(err);\n                    }\n                  });\n                }, {\n                  clientMetadata: clientMetadata\n                });\n              } else {\n                logger.debug('user sign out', user);\n                user.signOut(function () {\n                  if (isSignedInHostedUI) {\n                    _this.oAuthSignOutRedirect(res, rej);\n                  } else {\n                    return res();\n                  }\n                });\n              }\n            })];\n        }\n      });\n    });\n  };\n  AuthClass.prototype.oAuthSignOutRedirect = function (resolve, reject) {\n    var isBrowser = core_1.JS.browserOrNode().isBrowser;\n    if (isBrowser) {\n      this.oAuthSignOutRedirectOrReject(reject);\n    } else {\n      this.oAuthSignOutAndResolve(resolve);\n    }\n  };\n  AuthClass.prototype.oAuthSignOutAndResolve = function (resolve) {\n    this._oAuthHandler.signOut();\n    resolve();\n  };\n  AuthClass.prototype.oAuthSignOutRedirectOrReject = function (reject) {\n    this._oAuthHandler.signOut(); // this method redirects url\n    // App should be redirected to another url otherwise it will reject\n    setTimeout(function () {\n      return reject('Signout timeout fail');\n    }, 3000);\n  };\n  /**\n   * Sign out method\n   * @\n   * @return - A promise resolved if success\n   */\n  AuthClass.prototype.signOut = function (opts) {\n    return __awaiter(this, void 0, void 0, function () {\n      var e_9, user;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n            return [4 /*yield*/, this.cleanCachedItems()];\n          case 1:\n            _a.sent();\n            return [3 /*break*/, 3];\n          case 2:\n            e_9 = _a.sent();\n            logger.debug('failed to clear cached items');\n            return [3 /*break*/, 3];\n          case 3:\n            if (!this.userPool) return [3 /*break*/, 7];\n            user = this.userPool.getCurrentUser();\n            if (!user) return [3 /*break*/, 5];\n            return [4 /*yield*/, this.cognitoIdentitySignOut(opts, user)];\n          case 4:\n            _a.sent();\n            return [3 /*break*/, 6];\n          case 5:\n            logger.debug('no current Cognito user');\n            _a.label = 6;\n          case 6:\n            return [3 /*break*/, 8];\n          case 7:\n            logger.debug('no Congito User pool');\n            _a.label = 8;\n          case 8:\n            /**\n             * Note for future refactor - no reliable way to get username with\n             * Cognito User Pools vs Identity when federating with Social Providers\n             * This is why we need a well structured session object that can be inspected\n             * and information passed back in the message below for Hub dispatch\n             */\n            dispatchAuthEvent('signOut', this.user, \"A user has been signed out\");\n            this.user = null;\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  AuthClass.prototype.cleanCachedItems = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            // clear cognito cached item\n            return [4 /*yield*/, this.Credentials.clear()];\n          case 1:\n            // clear cognito cached item\n            _a.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /**\n   * Change a password for an authenticated user\n   * @param {Object} user - The CognitoUser object\n   * @param {String} oldPassword - the current password\n   * @param {String} newPassword - the requested new password\n   * @return - A promise resolves if success\n   */\n  AuthClass.prototype.changePassword = function (user, oldPassword, newPassword, clientMetadata) {\n    var _this = this;\n    if (clientMetadata === void 0) {\n      clientMetadata = this._config.clientMetadata;\n    }\n    return new Promise(function (resolve, reject) {\n      _this.userSession(user).then(function (session) {\n        user.changePassword(oldPassword, newPassword, function (err, data) {\n          if (err) {\n            logger.debug('change password failure', err);\n            return reject(err);\n          } else {\n            return resolve(data);\n          }\n        }, clientMetadata);\n      });\n    });\n  };\n  /**\n   * Initiate a forgot password request\n   * @param {String} username - the username to change password\n   * @return - A promise resolves if success\n   */\n  AuthClass.prototype.forgotPassword = function (username, clientMetadata) {\n    if (clientMetadata === void 0) {\n      clientMetadata = this._config.clientMetadata;\n    }\n    if (!this.userPool) {\n      return this.rejectNoUserPool();\n    }\n    if (!username) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyUsername);\n    }\n    var user = this.createCognitoUser(username);\n    return new Promise(function (resolve, reject) {\n      user.forgotPassword({\n        onSuccess: function onSuccess() {\n          resolve();\n          return;\n        },\n        onFailure: function onFailure(err) {\n          logger.debug('forgot password failure', err);\n          dispatchAuthEvent('forgotPassword_failure', err, username + \" forgotPassword failed\");\n          reject(err);\n          return;\n        },\n        inputVerificationCode: function inputVerificationCode(data) {\n          dispatchAuthEvent('forgotPassword', user, username + \" has initiated forgot password flow\");\n          resolve(data);\n          return;\n        }\n      }, clientMetadata);\n    });\n  };\n  /**\n   * Confirm a new password using a confirmation Code\n   * @param {String} username - The username\n   * @param {String} code - The confirmation code\n   * @param {String} password - The new password\n   * @return - A promise that resolves if success\n   */\n  AuthClass.prototype.forgotPasswordSubmit = function (username, code, password, clientMetadata) {\n    if (clientMetadata === void 0) {\n      clientMetadata = this._config.clientMetadata;\n    }\n    if (!this.userPool) {\n      return this.rejectNoUserPool();\n    }\n    if (!username) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyUsername);\n    }\n    if (!code) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyCode);\n    }\n    if (!password) {\n      return this.rejectAuthError(Auth_1.AuthErrorTypes.EmptyPassword);\n    }\n    var user = this.createCognitoUser(username);\n    return new Promise(function (resolve, reject) {\n      user.confirmPassword(code, password, {\n        onSuccess: function onSuccess(success) {\n          dispatchAuthEvent('forgotPasswordSubmit', user, username + \" forgotPasswordSubmit successful\");\n          resolve(success);\n          return;\n        },\n        onFailure: function onFailure(err) {\n          dispatchAuthEvent('forgotPasswordSubmit_failure', err, username + \" forgotPasswordSubmit failed\");\n          reject(err);\n          return;\n        }\n      }, clientMetadata);\n    });\n  };\n  /**\n   * Get user information\n   * @async\n   * @return {Object }- current User's information\n   */\n  AuthClass.prototype.currentUserInfo = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var source, user, attributes, userAttrs, credentials, e_10, info, err_1, user;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            source = this.Credentials.getCredSource();\n            if (!(!source || source === 'aws' || source === 'userPool')) return [3 /*break*/, 9];\n            return [4 /*yield*/, this.currentUserPoolUser().catch(function (err) {\n              return logger.error(err);\n            })];\n          case 1:\n            user = _a.sent();\n            if (!user) {\n              return [2 /*return*/, null];\n            }\n            _a.label = 2;\n          case 2:\n            _a.trys.push([2, 8,, 9]);\n            return [4 /*yield*/, this.userAttributes(user)];\n          case 3:\n            attributes = _a.sent();\n            userAttrs = this.attributesToObject(attributes);\n            credentials = null;\n            _a.label = 4;\n          case 4:\n            _a.trys.push([4, 6,, 7]);\n            return [4 /*yield*/, this.currentCredentials()];\n          case 5:\n            credentials = _a.sent();\n            return [3 /*break*/, 7];\n          case 6:\n            e_10 = _a.sent();\n            logger.debug('Failed to retrieve credentials while getting current user info', e_10);\n            return [3 /*break*/, 7];\n          case 7:\n            info = {\n              id: credentials ? credentials.identityId : undefined,\n              username: user.getUsername(),\n              attributes: userAttrs\n            };\n            return [2 /*return*/, info];\n          case 8:\n            err_1 = _a.sent();\n            logger.error('currentUserInfo error', err_1);\n            return [2 /*return*/, {}];\n          case 9:\n            if (source === 'federated') {\n              user = this.user;\n              return [2 /*return*/, user ? user : {}];\n            }\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  AuthClass.prototype.federatedSignIn = function (providerOrOptions, response, user) {\n    return __awaiter(this, void 0, void 0, function () {\n      var options, provider, customState, client_id, redirect_uri, provider, loggedInUser, token, identity_id, expires_at, credentials, currentUser;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!this._config.identityPoolId && !this._config.userPoolId) {\n              throw new Error(\"Federation requires either a User Pool or Identity Pool in config\");\n            }\n            // Ensure backwards compatability\n            if (typeof providerOrOptions === 'undefined') {\n              if (this._config.identityPoolId && !this._config.userPoolId) {\n                throw new Error(\"Federation with Identity Pools requires tokens passed as arguments\");\n              }\n            }\n            if (!(types_1.isFederatedSignInOptions(providerOrOptions) || types_1.isFederatedSignInOptionsCustom(providerOrOptions) || types_1.hasCustomState(providerOrOptions) || typeof providerOrOptions === 'undefined')) return [3 /*break*/, 1];\n            options = providerOrOptions || {\n              provider: Auth_1.CognitoHostedUIIdentityProvider.Cognito\n            };\n            provider = types_1.isFederatedSignInOptions(options) ? options.provider : options.customProvider;\n            customState = types_1.isFederatedSignInOptions(options) ? options.customState : options.customState;\n            if (this._config.userPoolId) {\n              client_id = types_1.isCognitoHostedOpts(this._config.oauth) ? this._config.userPoolWebClientId : this._config.oauth.clientID;\n              redirect_uri = types_1.isCognitoHostedOpts(this._config.oauth) ? this._config.oauth.redirectSignIn : this._config.oauth.redirectUri;\n              this._oAuthHandler.oauthSignIn(this._config.oauth.responseType, this._config.oauth.domain, redirect_uri, client_id, provider, customState);\n            }\n            return [3 /*break*/, 4];\n          case 1:\n            provider = providerOrOptions;\n            // To check if the user is already logged in\n            try {\n              loggedInUser = JSON.stringify(JSON.parse(this._storage.getItem('aws-amplify-federatedInfo')).user);\n              if (loggedInUser) {\n                logger.warn(\"There is already a signed in user: \" + loggedInUser + \" in your app.\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tYou should not call Auth.federatedSignIn method again as it may cause unexpected behavior.\");\n              }\n            } catch (e) {}\n            token = response.token, identity_id = response.identity_id, expires_at = response.expires_at;\n            return [4 /*yield*/, this.Credentials.set({\n              provider: provider,\n              token: token,\n              identity_id: identity_id,\n              user: user,\n              expires_at: expires_at\n            }, 'federation')];\n          case 2:\n            credentials = _a.sent();\n            return [4 /*yield*/, this.currentAuthenticatedUser()];\n          case 3:\n            currentUser = _a.sent();\n            dispatchAuthEvent('signIn', currentUser, \"A user \" + currentUser.username + \" has been signed in\");\n            logger.debug('federated sign in credentials', credentials);\n            return [2 /*return*/, credentials];\n          case 4:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /**\n   * Used to complete the OAuth flow with or without the Cognito Hosted UI\n   * @param {String} URL - optional parameter for customers to pass in the response URL\n   */\n  AuthClass.prototype._handleAuthResponse = function (URL) {\n    return __awaiter(this, void 0, void 0, function () {\n      var currentUrl, hasCodeOrError, hasTokenOrError, _a, accessToken, idToken, refreshToken, state, session, credentials, isCustomStateIncluded, currentUser, customState, err_2;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (this.oAuthFlowInProgress) {\n              logger.debug(\"Skipping URL \" + URL + \" current flow in progress\");\n              return [2 /*return*/];\n            }\n\n            _b.label = 1;\n          case 1:\n            _b.trys.push([1,, 8, 9]);\n            this.oAuthFlowInProgress = true;\n            if (!this._config.userPoolId) {\n              throw new Error(\"OAuth responses require a User Pool defined in config\");\n            }\n            dispatchAuthEvent('parsingCallbackUrl', {\n              url: URL\n            }, \"The callback url is being parsed\");\n            currentUrl = URL || (core_1.JS.browserOrNode().isBrowser ? window.location.href : '');\n            hasCodeOrError = !!(url_1.parse(currentUrl).query || '').split('&').map(function (entry) {\n              return entry.split('=');\n            }).find(function (_a) {\n              var _b = __read(_a, 1),\n                k = _b[0];\n              return k === 'code' || k === 'error';\n            });\n            hasTokenOrError = !!(url_1.parse(currentUrl).hash || '#').substr(1).split('&').map(function (entry) {\n              return entry.split('=');\n            }).find(function (_a) {\n              var _b = __read(_a, 1),\n                k = _b[0];\n              return k === 'access_token' || k === 'error';\n            });\n            if (!(hasCodeOrError || hasTokenOrError)) return [3 /*break*/, 7];\n            this._storage.setItem('amplify-redirected-from-hosted-ui', 'true');\n            _b.label = 2;\n          case 2:\n            _b.trys.push([2, 6,, 7]);\n            return [4 /*yield*/, this._oAuthHandler.handleAuthResponse(currentUrl)];\n          case 3:\n            _a = _b.sent(), accessToken = _a.accessToken, idToken = _a.idToken, refreshToken = _a.refreshToken, state = _a.state;\n            session = new amazon_cognito_identity_js_1.CognitoUserSession({\n              IdToken: new amazon_cognito_identity_js_1.CognitoIdToken({\n                IdToken: idToken\n              }),\n              RefreshToken: new amazon_cognito_identity_js_1.CognitoRefreshToken({\n                RefreshToken: refreshToken\n              }),\n              AccessToken: new amazon_cognito_identity_js_1.CognitoAccessToken({\n                AccessToken: accessToken\n              })\n            });\n            credentials = void 0;\n            if (!this._config.identityPoolId) return [3 /*break*/, 5];\n            return [4 /*yield*/, this.Credentials.set(session, 'session')];\n          case 4:\n            credentials = _b.sent();\n            logger.debug('AWS credentials', credentials);\n            _b.label = 5;\n          case 5:\n            isCustomStateIncluded = /-/.test(state);\n            currentUser = this.createCognitoUser(session.getIdToken().decodePayload()['cognito:username']);\n            // This calls cacheTokens() in Cognito SDK\n            currentUser.setSignInUserSession(session);\n            if (window && typeof window.history !== 'undefined') {\n              window.history.replaceState({}, null, this._config.oauth.redirectSignIn);\n            }\n            dispatchAuthEvent('signIn', currentUser, \"A user \" + currentUser.getUsername() + \" has been signed in\");\n            dispatchAuthEvent('cognitoHostedUI', currentUser, \"A user \" + currentUser.getUsername() + \" has been signed in via Cognito Hosted UI\");\n            if (isCustomStateIncluded) {\n              customState = state.split('-').splice(1).join('-');\n              dispatchAuthEvent('customOAuthState', core_1.urlSafeDecode(customState), \"State for user \" + currentUser.getUsername());\n            }\n            //#endregion\n            return [2 /*return*/, credentials];\n          case 6:\n            err_2 = _b.sent();\n            logger.debug('Error in cognito hosted auth response', err_2);\n            // Just like a successful handling of `?code`, replace the window history to \"dispose\" of the `code`.\n            // Otherwise, reloading the page will throw errors as the `code` has already been spent.\n            if (window && typeof window.history !== 'undefined') {\n              window.history.replaceState({}, null, this._config.oauth.redirectSignIn);\n            }\n            dispatchAuthEvent('signIn_failure', err_2, \"The OAuth response flow failed\");\n            dispatchAuthEvent('cognitoHostedUI_failure', err_2, \"A failure occurred when returning to the Cognito Hosted UI\");\n            dispatchAuthEvent('customState_failure', err_2, \"A failure occurred when returning state\");\n            return [3 /*break*/, 7];\n          case 7:\n            return [3 /*break*/, 9];\n          case 8:\n            this.oAuthFlowInProgress = false;\n            return [7 /*endfinally*/];\n          case 9:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /**\n   * Compact version of credentials\n   * @param {Object} credentials\n   * @return {Object} - Credentials\n   */\n  AuthClass.prototype.essentialCredentials = function (credentials) {\n    return {\n      accessKeyId: credentials.accessKeyId,\n      sessionToken: credentials.sessionToken,\n      secretAccessKey: credentials.secretAccessKey,\n      identityId: credentials.identityId,\n      authenticated: credentials.authenticated\n    };\n  };\n  AuthClass.prototype.attributesToObject = function (attributes) {\n    var _this = this;\n    var obj = {};\n    if (attributes) {\n      attributes.map(function (attribute) {\n        if (attribute.Name === 'email_verified' || attribute.Name === 'phone_number_verified') {\n          obj[attribute.Name] = _this.isTruthyString(attribute.Value) || attribute.Value === true;\n        } else {\n          obj[attribute.Name] = attribute.Value;\n        }\n      });\n    }\n    return obj;\n  };\n  AuthClass.prototype.isTruthyString = function (value) {\n    return typeof value.toLowerCase === 'function' && value.toLowerCase() === 'true';\n  };\n  AuthClass.prototype.createCognitoUser = function (username) {\n    var userData = {\n      Username: username,\n      Pool: this.userPool\n    };\n    userData.Storage = this._storage;\n    var authenticationFlowType = this._config.authenticationFlowType;\n    var user = new amazon_cognito_identity_js_1.CognitoUser(userData);\n    if (authenticationFlowType) {\n      user.setAuthenticationFlowType(authenticationFlowType);\n    }\n    return user;\n  };\n  AuthClass.prototype._isValidAuthStorage = function (obj) {\n    // We need to check if the obj has the functions of Storage\n    return !!obj && typeof obj.getItem === 'function' && typeof obj.setItem === 'function' && typeof obj.removeItem === 'function' && typeof obj.clear === 'function';\n  };\n  AuthClass.prototype.noUserPoolErrorHandler = function (config) {\n    if (config) {\n      if (!config.userPoolId || !config.identityPoolId) {\n        return Auth_1.AuthErrorTypes.MissingAuthConfig;\n      }\n    }\n    return Auth_1.AuthErrorTypes.NoConfig;\n  };\n  AuthClass.prototype.rejectAuthError = function (type) {\n    return Promise.reject(new Errors_1.AuthError(type));\n  };\n  AuthClass.prototype.rejectNoUserPool = function () {\n    var type = this.noUserPoolErrorHandler(this._config);\n    return Promise.reject(new Errors_1.NoUserPoolError(type));\n  };\n  AuthClass.prototype.rememberDevice = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var currUser, error_1;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n            return [4 /*yield*/, this.currentUserPoolUser()];\n          case 1:\n            currUser = _a.sent();\n            return [3 /*break*/, 3];\n          case 2:\n            error_1 = _a.sent();\n            logger.debug('The user is not authenticated by the error', error_1);\n            return [2 /*return*/, Promise.reject('The user is not authenticated')];\n          case 3:\n            currUser.getCachedDeviceKeyAndPassword();\n            return [2 /*return*/, new Promise(function (res, rej) {\n              currUser.setDeviceStatusRemembered({\n                onSuccess: function onSuccess(data) {\n                  res(data);\n                },\n                onFailure: function onFailure(err) {\n                  if (err.code === 'InvalidParameterException') {\n                    rej(new Errors_1.AuthError(Auth_1.AuthErrorTypes.DeviceConfig));\n                  } else if (err.code === 'NetworkError') {\n                    rej(new Errors_1.AuthError(Auth_1.AuthErrorTypes.NetworkError));\n                  } else {\n                    rej(err);\n                  }\n                }\n              });\n            })];\n        }\n      });\n    });\n  };\n  AuthClass.prototype.forgetDevice = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var currUser, error_2;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n            return [4 /*yield*/, this.currentUserPoolUser()];\n          case 1:\n            currUser = _a.sent();\n            return [3 /*break*/, 3];\n          case 2:\n            error_2 = _a.sent();\n            logger.debug('The user is not authenticated by the error', error_2);\n            return [2 /*return*/, Promise.reject('The user is not authenticated')];\n          case 3:\n            currUser.getCachedDeviceKeyAndPassword();\n            return [2 /*return*/, new Promise(function (res, rej) {\n              currUser.forgetDevice({\n                onSuccess: function onSuccess(data) {\n                  res(data);\n                },\n                onFailure: function onFailure(err) {\n                  if (err.code === 'InvalidParameterException') {\n                    rej(new Errors_1.AuthError(Auth_1.AuthErrorTypes.DeviceConfig));\n                  } else if (err.code === 'NetworkError') {\n                    rej(new Errors_1.AuthError(Auth_1.AuthErrorTypes.NetworkError));\n                  } else {\n                    rej(err);\n                  }\n                }\n              });\n            })];\n        }\n      });\n    });\n  };\n  AuthClass.prototype.fetchDevices = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var currUser, error_3;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n            return [4 /*yield*/, this.currentUserPoolUser()];\n          case 1:\n            currUser = _a.sent();\n            return [3 /*break*/, 3];\n          case 2:\n            error_3 = _a.sent();\n            logger.debug('The user is not authenticated by the error', error_3);\n            throw new Error('The user is not authenticated');\n          case 3:\n            currUser.getCachedDeviceKeyAndPassword();\n            return [2 /*return*/, new Promise(function (res, rej) {\n              var cb = {\n                onSuccess: function onSuccess(data) {\n                  var deviceList = data.Devices.map(function (device) {\n                    var deviceName = device.DeviceAttributes.find(function (_a) {\n                      var Name = _a.Name;\n                      return Name === 'device_name';\n                    }) || {};\n                    var deviceInfo = {\n                      id: device.DeviceKey,\n                      name: deviceName.Value\n                    };\n                    return deviceInfo;\n                  });\n                  res(deviceList);\n                },\n                onFailure: function onFailure(err) {\n                  if (err.code === 'InvalidParameterException') {\n                    rej(new Errors_1.AuthError(Auth_1.AuthErrorTypes.DeviceConfig));\n                  } else if (err.code === 'NetworkError') {\n                    rej(new Errors_1.AuthError(Auth_1.AuthErrorTypes.NetworkError));\n                  } else {\n                    rej(err);\n                  }\n                }\n              };\n              currUser.listDevices(MAX_DEVICES, null, cb);\n            })];\n        }\n      });\n    });\n  };\n  return AuthClass;\n}();\nexports.AuthClass = AuthClass;\nexports.Auth = new AuthClass(null);\ncore_1.Amplify.register(exports.Auth);","map":{"version":3,"names":["types_1","require","core_1","amazon_cognito_identity_js_1","url_1","OAuth_1","__importDefault","urlListener_1","Errors_1","Auth_1","logger","ConsoleLogger","USER_ADMIN_SCOPE","OAUTH_FLOW_MS_TIMEOUT","AMPLIFY_SYMBOL","Symbol","for","dispatchAuthEvent","event","data","message","Hub","dispatch","MAX_DEVICES","AuthClass","config","_this","userPool","user","oAuthFlowInProgress","Credentials","wrapRefreshSessionCallback","callback","wrapped","error","undefined","configure","currentCredentials","bind","currentUserCredentials","listen","_a","payload","_storage","setItem","removeItem","prototype","getModuleName","_config","debug","conf","Object","assign","Parser","parseMobilehubConfig","Auth","userPoolId","userPoolWebClientId","cookieStorage","oauth","region","identityPoolId","mandatorySignIn","refreshHandlers","identityPoolRegion","clientMetadata","endpoint","storage","CookieStorage","ssr","UniversalStorage","StorageHelper","getStorage","_isValidAuthStorage","Error","_storageSync","Promise","resolve","userPoolData","UserPoolId","ClientId","Storage","CognitoUserPool","cognitoHostedUIConfig","isCognitoHostedOpts","awsCognito","cognitoAuthParams","cognitoClientId","domain","scopes","redirectSignIn","redirectSignOut","responseType","urlOpener","_oAuthHandler","default","usedResponseUrls_1","url","_handleAuthResponse","signUp","params","restOfAttrs","_i","arguments","length","rejectNoUserPool","username","password","attributes","validationData","email","phone_number","push","CognitoUserAttribute","Name","Value","attrs_1","keys","map","key","validationDataObject_1","rejectAuthError","AuthErrorTypes","SignUpError","EmptyUsername","EmptyPassword","reject","err","confirmSignUp","code","options","EmptyCode","createCognitoUser","forceAliasCreation","confirmRegistration","resendSignUp","resendConfirmationCode","signIn","usernameOrSignInOpts","pw","isUsernamePasswordOpts","warn","InvalidUsername","authDetails","AuthenticationDetails","Username","Password","ValidationData","ClientMetadata","signInWithPassword","signInWithoutPassword","authCallbacks","that","onSuccess","session","__awaiter","clear","sent","set","cred","e_1","currentUserPoolUser","currentUser","getUsername","e_2","onFailure","customChallenge","challengeParam","mfaRequired","challengeName","mfaSetup","newPasswordRequired","userAttributes","requiredAttributes","totpRequired","selectMFAType","pendingSignIn","authenticateUser","value","setAuthenticationFlowType","initiateAuth","getMFAOptions","res","rej","mfaOptions","getPreferredMFA","bypassCache","getUserData","mfaType","_getMfaTypeFromUserData","ret","preferredMFA","PreferredMfaSetting","mfaList","UserMFASettingList","MFAOptions","_getUserData","setPreferredMFA","mfaMethod","userData","_b","smsMfaSettings","totpMfaSettings","PreferredMfa","Enabled","currentMFAType","InvalidMFA","forEach","NoMFA","setUserMfaPreference","result","disableSMS","disableMFA","enableSMS","enableMFA","setupTOTP","associateSoftwareToken","associateSecretCode","secretCode","verifyTotpToken","challengeAnswer","verifySoftwareToken","confirmSignIn","sendMFACode","e_3","completeNewPassword","completeNewPasswordChallenge","e_4","sendCustomChallengeAnswer","challengeResponses","EmptyChallengeResponse","deleteUserAttributes","attributeNames","userSession","then","deleteAttributes","updateUserAttributes","attributeList","indexOf","attr","updateAttributes","getUserAttributes","verifiedContact","attrs","attributesToObject","unverified","verified","isOAuthInProgress","timeoutId","setTimeout","remove","hostedUISignCallback","clearTimeout","getCurrentUser","getSession","getAccessToken","decodePayload","scope","split","includes","i","UserAttributes","attribute","userAttribute","catch","e","currentAuthenticatedUser","federatedUser","e_5","federatedInfo","JSON","parse","getItem","__assign","token","e_6","currentSession","NoUserSession","e_7","refreshFederatedToken","get","verifyUserAttribute","getAttributeVerificationCode","success","verifyUserAttributeSubmit","verifyAttribute","verifyCurrentUserAttribute","verifyCurrentUserAttributeSubmit","cognitoIdentitySignOut","opts","e_8","isSignedInHostedUI","global","globalSignOut","oAuthSignOutRedirect","signOut","isBrowser","JS","browserOrNode","oAuthSignOutRedirectOrReject","oAuthSignOutAndResolve","cleanCachedItems","changePassword","oldPassword","newPassword","forgotPassword","inputVerificationCode","forgotPasswordSubmit","confirmPassword","currentUserInfo","source","getCredSource","userAttrs","credentials","e_10","info","id","identityId","err_1","federatedSignIn","providerOrOptions","response","isFederatedSignInOptions","isFederatedSignInOptionsCustom","hasCustomState","provider","CognitoHostedUIIdentityProvider","Cognito","customProvider","customState","client_id","clientID","redirect_uri","redirectUri","oauthSignIn","loggedInUser","stringify","identity_id","expires_at","URL","currentUrl","window","location","href","hasCodeOrError","query","entry","find","__read","k","hasTokenOrError","hash","substr","handleAuthResponse","accessToken","idToken","refreshToken","state","CognitoUserSession","IdToken","CognitoIdToken","RefreshToken","CognitoRefreshToken","AccessToken","CognitoAccessToken","isCustomStateIncluded","test","getIdToken","setSignInUserSession","history","replaceState","splice","join","urlSafeDecode","err_2","essentialCredentials","accessKeyId","sessionToken","secretAccessKey","authenticated","obj","isTruthyString","toLowerCase","Pool","authenticationFlowType","CognitoUser","noUserPoolErrorHandler","MissingAuthConfig","NoConfig","type","AuthError","NoUserPoolError","rememberDevice","currUser","error_1","getCachedDeviceKeyAndPassword","setDeviceStatusRemembered","DeviceConfig","NetworkError","forgetDevice","error_2","fetchDevices","error_3","cb","deviceList","Devices","device","deviceName","DeviceAttributes","deviceInfo","DeviceKey","name","listDevices","exports","Amplify","register"],"sources":["../src/Auth.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAaA,IAAAA,OAAA,GAAAC,OAAA;AAsBA,IAAAC,MAAA,GAAAD,OAAA;AAYA,IAAAE,4BAAA,GAAAF,OAAA;AAmBA,IAAAG,KAAA,GAAAH,OAAA;AACA,IAAAI,OAAA,GAAAC,eAAA,CAAAL,OAAA;AACA,IAAAM,aAAA,GAAAD,eAAA,CAAAL,OAAA;AACA,IAAAO,QAAA,GAAAP,OAAA;AACA,IAAAQ,MAAA,GAAAR,OAAA;AAMA,IAAMS,MAAM,GAAG,IAAIR,MAAA,CAAAS,aAAM,CAAC,WAAW,CAAC;AACtC,IAAMC,gBAAgB,GAAG,+BAA+B;AAExD;AACA,IAAMC,qBAAqB,GAAG,EAAE,GAAG,IAAI;AAEvC,IAAMC,cAAc,GAAI,OAAOC,MAAM,KAAK,WAAW,IACrD,OAAOA,MAAM,CAACC,GAAG,KAAK,UAAU,GAC7BD,MAAM,CAACC,GAAG,CAAC,iBAAiB,CAAC,GAC7B,mBAA8B;AAEjC,IAAMC,iBAAiB,GAAG,SAApBA,iBAAiBA,CAAIC,KAAa,EAAEC,IAAS,EAAEC,OAAe;EACnElB,MAAA,CAAAmB,GAAG,CAACC,QAAQ,CAAC,MAAM,EAAE;IAAEJ,KAAK,EAAAA,KAAA;IAAEC,IAAI,EAAAA,IAAA;IAAEC,OAAO,EAAAA;EAAA,CAAE,EAAE,MAAM,EAAEN,cAAc,CAAC;AACvE,CAAC;AAED;AACA;AACA;AACA,IAAMS,WAAW,GAAG,EAAE;AAEtB;;;AAGA,IAAAC,SAAA;EAYC;;;;EAIA,SAAAA,UAAYC,MAAmB;IAA/B,IAAAC,KAAA;IAdQ,KAAAC,QAAQ,GAAoB,IAAI;IAChC,KAAAC,IAAI,GAAQ,IAAI;IAIhB,KAAAC,mBAAmB,GAAY,KAAK;IAG5C,KAAAC,WAAW,GAAG5B,MAAA,CAAA4B,WAAW;IAwJzB,KAAAC,0BAA0B,GAAG,UAACC,QAA0B;MACvD,IAAMC,OAAO,GAAqB,SAA5BA,OAAOA,CAAsBC,KAAK,EAAEf,IAAI;QAC7C,IAAIA,IAAI,EAAE;UACTF,iBAAiB,CAAC,cAAc,EAAEkB,SAAS,EAAE,qBAAqB,CAAC;SACnE,MAAM;UACNlB,iBAAiB,CAChB,sBAAsB,EACtBiB,KAAK,EACL,8BAA8B,CAC9B;;QAEF,OAAOF,QAAQ,CAACE,KAAK,EAAEf,IAAI,CAAC;MAC7B,CAAC;MACD,OAAOc,OAAO;IACf,CAAC,EAAC;IA/JD,IAAI,CAACG,SAAS,CAACX,MAAM,CAAC;IACtB,IAAI,CAACY,kBAAkB,GAAG,IAAI,CAACA,kBAAkB,CAACC,IAAI,CAAC,IAAI,CAAC;IAC5D,IAAI,CAACC,sBAAsB,GAAG,IAAI,CAACA,sBAAsB,CAACD,IAAI,CAAC,IAAI,CAAC;IAEpEpC,MAAA,CAAAmB,GAAG,CAACmB,MAAM,CAAC,MAAM,EAAE,UAACC,EAAW;UAATC,OAAA,GAAAD,EAAA,CAAAC,OAAO;MACpB,IAAAxB,KAAA,GAAAwB,OAAA,CAAAxB,KAAK;MACb,QAAQA,KAAK;QACZ,KAAK,QAAQ;UACZQ,KAAI,CAACiB,QAAQ,CAACC,OAAO,CAAC,8BAA8B,EAAE,OAAO,CAAC;UAC9D;QACD,KAAK,SAAS;UACblB,KAAI,CAACiB,QAAQ,CAACE,UAAU,CAAC,8BAA8B,CAAC;UACxD;QACD,KAAK,iBAAiB;UACrBnB,KAAI,CAACiB,QAAQ,CAACC,OAAO,CAAC,8BAA8B,EAAE,MAAM,CAAC;UAC7D;MAAM;IAET,CAAC,CAAC;EACH;EAEOpB,SAAA,CAAAsB,SAAA,CAAAC,aAAa,GAApB;IACC,OAAO,MAAM;EACd,CAAC;EAEDvB,SAAA,CAAAsB,SAAA,CAAAV,SAAS,GAAT,UAAUX,MAAO;IAAjB,IAAAC,KAAA;IACC,IAAI,CAACD,MAAM,EAAE,OAAO,IAAI,CAACuB,OAAO,IAAI,EAAE;IACtCtC,MAAM,CAACuC,KAAK,CAAC,gBAAgB,CAAC;IAC9B,IAAMC,IAAI,GAAGC,MAAM,CAACC,MAAM,CACzB,EAAE,EACF,IAAI,CAACJ,OAAO,EACZ9C,MAAA,CAAAmD,MAAM,CAACC,oBAAoB,CAAC7B,MAAM,CAAC,CAAC8B,IAAI,EACxC9B,MAAM,CACN;IACD,IAAI,CAACuB,OAAO,GAAGE,IAAI;IACb,IAAAT,EAAA,QAAAO,OAYU;MAXfQ,UAAA,GAAAf,EAAA,CAAAe,UAAU;MACVC,mBAAA,GAAAhB,EAAA,CAAAgB,mBAAmB;MACnBC,aAAA,GAAAjB,EAAA,CAAAiB,aAAa;MACbC,KAAA,GAAAlB,EAAA,CAAAkB,KAAK;MACLC,MAAA,GAAAnB,EAAA,CAAAmB,MAAM;MACNC,cAAA,GAAApB,EAAA,CAAAoB,cAAc;MACdC,eAAA,GAAArB,EAAA,CAAAqB,eAAe;MACfC,eAAA,GAAAtB,EAAA,CAAAsB,eAAe;MACfC,kBAAA,GAAAvB,EAAA,CAAAuB,kBAAkB;MAClBC,cAAA,GAAAxB,EAAA,CAAAwB,cAAc;MACdC,QAAA,GAAAzB,EAAA,CAAAyB,QACe;IAEhB,IAAI,CAAC,IAAI,CAAClB,OAAO,CAACmB,OAAO,EAAE;MAC1B;MACA,IAAIT,aAAa,EAAE,IAAI,CAACf,QAAQ,GAAG,IAAIxC,4BAAA,CAAAiE,aAAa,CAACV,aAAa,CAAC,CAAC,KAC/D;QACJ,IAAI,CAACf,QAAQ,GAAGlB,MAAM,CAAC4C,GAAG,GACvB,IAAInE,MAAA,CAAAoE,gBAAgB,EAAE,GACtB,IAAIpE,MAAA,CAAAqE,aAAa,EAAE,CAACC,UAAU,EAAE;;KAEpC,MAAM;MACN,IAAI,CAAC,IAAI,CAACC,mBAAmB,CAAC,IAAI,CAACzB,OAAO,CAACmB,OAAO,CAAC,EAAE;QACpDzD,MAAM,CAACwB,KAAK,CAAC,8CAA8C,CAAC;QAC5D,MAAM,IAAIwC,KAAK,CAAC,sBAAsB,CAAC;;MAExC,IAAI,CAAC/B,QAAQ,GAAG,IAAI,CAACK,OAAO,CAACmB,OAAO;;IAGrC,IAAI,CAACQ,YAAY,GAAGC,OAAO,CAACC,OAAO,EAAE;IACrC,IAAI,OAAO,IAAI,CAAClC,QAAQ,CAAC,MAAM,CAAC,KAAK,UAAU,EAAE;MAChD,IAAI,CAACgC,YAAY,GAAG,IAAI,CAAChC,QAAQ,CAAC,MAAM,CAAC,EAAE;;IAG5C,IAAIa,UAAU,EAAE;MACf,IAAMsB,YAAY,GAAyB;QAC1CC,UAAU,EAAEvB,UAAU;QACtBwB,QAAQ,EAAEvB,mBAAmB;QAC7BS,QAAQ,EAAAA;OACR;MACDY,YAAY,CAACG,OAAO,GAAG,IAAI,CAACtC,QAAQ;MAEpC,IAAI,CAAChB,QAAQ,GAAG,IAAIxB,4BAAA,CAAA+E,eAAe,CAClCJ,YAAY,EACZ,IAAI,CAAC/C,0BAA0B,CAC/B;;IAGF,IAAI,CAACD,WAAW,CAACM,SAAS,CAAC;MAC1B0B,eAAe,EAAAA,eAAA;MACfF,MAAM,EAAEI,kBAAkB,IAAIJ,MAAM;MACpCJ,UAAU,EAAAA,UAAA;MACVK,cAAc,EAAAA,cAAA;MACdE,eAAe,EAAAA,eAAA;MACfI,OAAO,EAAE,IAAI,CAACxB;KACd,CAAC;IAEF;IACA;IACA,IAAMwC,qBAAqB,GAAGxB,KAAK,GAChC3D,OAAA,CAAAoF,mBAAmB,CAAC,IAAI,CAACpC,OAAO,CAACW,KAAK,CAAC,GACtCA,KAAK,GACCA,KAAM,CAAC0B,UAAU,GACxBlD,SAAS;IAEZ,IAAIgD,qBAAqB,EAAE;MAC1B,IAAMG,iBAAiB,GAAGnC,MAAM,CAACC,MAAM,CACtC;QACCmC,eAAe,EAAE9B,mBAAmB;QACpCsB,UAAU,EAAEvB,UAAU;QACtBgC,MAAM,EAAEL,qBAAqB,CAAC,QAAQ,CAAC;QACvCM,MAAM,EAAEN,qBAAqB,CAAC,OAAO,CAAC;QACtCO,cAAc,EAAEP,qBAAqB,CAAC,gBAAgB,CAAC;QACvDQ,eAAe,EAAER,qBAAqB,CAAC,iBAAiB,CAAC;QACzDS,YAAY,EAAET,qBAAqB,CAAC,cAAc,CAAC;QACnDF,OAAO,EAAE,IAAI,CAACtC,QAAQ;QACtBkD,SAAS,EAAEV,qBAAqB,CAAC,WAAW,CAAC;QAC7ClB,cAAc,EAAAA;OACd,EACDkB,qBAAqB,CAAC,SAAS,CAAC,CAChC;MAED,IAAI,CAACW,aAAa,GAAG,IAAIzF,OAAA,CAAA0F,OAAK,CAAC;QAC9BN,MAAM,EAAEH,iBAAiB,CAACG,MAAM;QAChChE,MAAM,EAAE6D,iBAAiB;QACzBC,eAAe,EAAED,iBAAiB,CAACC;OACnC,CAAC;MAEF;MACA;MACA;MACA,IAAMS,kBAAgB,GAAG,EAAE;MAC3BzF,aAAA,CAAAwF,OAAW,CAAC,UAACtD,EAAO;YAALwD,GAAA,GAAAxD,EAAA,CAAAwD,GAAG;QACjB,IAAID,kBAAgB,CAACC,GAAG,CAAC,EAAE;UAC1B;;QAGDD,kBAAgB,CAACC,GAAG,CAAC,GAAG,IAAI;QAC5BvE,KAAI,CAACwE,mBAAmB,CAACD,GAAG,CAAC;MAC9B,CAAC,CAAC;;IAGHhF,iBAAiB,CAChB,YAAY,EACZ,IAAI,EACJ,oDAAoD,CACpD;IACD,OAAO,IAAI,CAAC+B,OAAO;EACpB,CAAC;EAkBD;;;;;;EAMOxB,SAAA,CAAAsB,SAAA,CAAAqD,MAAM,GAAb,UACCC,MAA6B;IAD9B,IAAA1E,KAAA;IAEC,IAAA2E,WAAA;SAAA,IAAAC,EAAA,IAAwB,EAAxBA,EAAA,GAAAC,SAAA,CAAAC,MAAwB,EAAxBF,EAAA,EAAwB;MAAxBD,WAAA,CAAAC,EAAA,QAAAC,SAAA,CAAAD,EAAA;;IAEA,IAAI,CAAC,IAAI,CAAC3E,QAAQ,EAAE;MACnB,OAAO,IAAI,CAAC8E,gBAAgB,EAAE;;IAG/B,IAAIC,QAAQ,GAAW,IAAI;IAC3B,IAAIC,QAAQ,GAAW,IAAI;IAC3B,IAAMC,UAAU,GAA2B,EAAE;IAC7C,IAAIC,cAAc,GAA2B,IAAI;IACjD,IAAI5C,cAAc;IAElB,IAAImC,MAAM,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE;MACzCM,QAAQ,GAAGN,MAAM;MACjBO,QAAQ,GAAGN,WAAW,GAAGA,WAAW,CAAC,CAAC,CAAC,GAAG,IAAI;MAC9C,IAAMS,KAAK,GAAWT,WAAW,GAAGA,WAAW,CAAC,CAAC,CAAC,GAAG,IAAI;MACzD,IAAMU,YAAY,GAAWV,WAAW,GAAGA,WAAW,CAAC,CAAC,CAAC,GAAG,IAAI;MAEhE,IAAIS,KAAK,EACRF,UAAU,CAACI,IAAI,CACd,IAAI7G,4BAAA,CAAA8G,oBAAoB,CAAC;QAAEC,IAAI,EAAE,OAAO;QAAEC,KAAK,EAAEL;MAAK,CAAE,CAAC,CACzD;MAEF,IAAIC,YAAY,EACfH,UAAU,CAACI,IAAI,CACd,IAAI7G,4BAAA,CAAA8G,oBAAoB,CAAC;QACxBC,IAAI,EAAE,cAAc;QACpBC,KAAK,EAAEJ;OACP,CAAC,CACF;KACF,MAAM,IAAIX,MAAM,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE;MAChDM,QAAQ,GAAGN,MAAM,CAAC,UAAU,CAAC;MAC7BO,QAAQ,GAAGP,MAAM,CAAC,UAAU,CAAC;MAE7B,IAAIA,MAAM,IAAIA,MAAM,CAACnC,cAAc,EAAE;QACpCA,cAAc,GAAGmC,MAAM,CAACnC,cAAc;OACtC,MAAM,IAAI,IAAI,CAACjB,OAAO,CAACiB,cAAc,EAAE;QACvCA,cAAc,GAAG,IAAI,CAACjB,OAAO,CAACiB,cAAc;;MAG7C,IAAMmD,OAAK,GAAGhB,MAAM,CAAC,YAAY,CAAC;MAClC,IAAIgB,OAAK,EAAE;QACVjE,MAAM,CAACkE,IAAI,CAACD,OAAK,CAAC,CAACE,GAAG,CAAC,UAAAC,GAAG;UACzBX,UAAU,CAACI,IAAI,CACd,IAAI7G,4BAAA,CAAA8G,oBAAoB,CAAC;YAAEC,IAAI,EAAEK,GAAG;YAAEJ,KAAK,EAAEC,OAAK,CAACG,GAAG;UAAC,CAAE,CAAC,CAC1D;QACF,CAAC,CAAC;;MAGH,IAAMC,sBAAoB,GAAGpB,MAAM,CAAC,gBAAgB,CAAC;MACrD,IAAIoB,sBAAoB,EAAE;QACzBX,cAAc,GAAG,EAAE;QACnB1D,MAAM,CAACkE,IAAI,CAACG,sBAAoB,CAAC,CAACF,GAAG,CAAC,UAAAC,GAAG;UACxCV,cAAc,CAACG,IAAI,CAClB,IAAI7G,4BAAA,CAAA8G,oBAAoB,CAAC;YACxBC,IAAI,EAAEK,GAAG;YACTJ,KAAK,EAAEK,sBAAoB,CAACD,GAAG;WAC/B,CAAC,CACF;QACF,CAAC,CAAC;;KAEH,MAAM;MACN,OAAO,IAAI,CAACE,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACC,WAAW,CAAC;;IAGxD,IAAI,CAACjB,QAAQ,EAAE;MACd,OAAO,IAAI,CAACe,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACE,aAAa,CAAC;;IAE1D,IAAI,CAACjB,QAAQ,EAAE;MACd,OAAO,IAAI,CAACc,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACG,aAAa,CAAC;;IAG1DnH,MAAM,CAACuC,KAAK,CAAC,eAAe,EAAE2D,UAAU,CAAC;IACzClG,MAAM,CAACuC,KAAK,CAAC,yBAAyB,EAAE4D,cAAc,CAAC;IAEvD,OAAO,IAAIjC,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClCpG,KAAI,CAACC,QAAQ,CAACwE,MAAM,CACnBO,QAAQ,EACRC,QAAQ,EACRC,UAAU,EACVC,cAAc,EACd,UAACkB,GAAG,EAAE5G,IAAI;QACT,IAAI4G,GAAG,EAAE;UACR9G,iBAAiB,CAChB,gBAAgB,EAChB8G,GAAG,EACArB,QAAQ,sBAAmB,CAC9B;UACDoB,MAAM,CAACC,GAAG,CAAC;SACX,MAAM;UACN9G,iBAAiB,CAChB,QAAQ,EACRE,IAAI,EACDuF,QAAQ,gCAA6B,CACxC;UACD7B,OAAO,CAAC1D,IAAI,CAAC;;MAEf,CAAC,EACD8C,cAAc,CACd;IACF,CAAC,CAAC;EACH,CAAC;EAED;;;;;;;EAOOzC,SAAA,CAAAsB,SAAA,CAAAkF,aAAa,GAApB,UACCtB,QAAgB,EAChBuB,IAAY,EACZC,OAA8B;IAE9B,IAAI,CAAC,IAAI,CAACvG,QAAQ,EAAE;MACnB,OAAO,IAAI,CAAC8E,gBAAgB,EAAE;;IAE/B,IAAI,CAACC,QAAQ,EAAE;MACd,OAAO,IAAI,CAACe,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACE,aAAa,CAAC;;IAE1D,IAAI,CAACK,IAAI,EAAE;MACV,OAAO,IAAI,CAACR,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACS,SAAS,CAAC;;IAGtD,IAAMvG,IAAI,GAAG,IAAI,CAACwG,iBAAiB,CAAC1B,QAAQ,CAAC;IAC7C,IAAM2B,kBAAkB,GACvBH,OAAO,IAAI,OAAOA,OAAO,CAACG,kBAAkB,KAAK,SAAS,GACvDH,OAAO,CAACG,kBAAkB,GAC1B,IAAI;IAER,IAAIpE,cAAc;IAClB,IAAIiE,OAAO,IAAIA,OAAO,CAACjE,cAAc,EAAE;MACtCA,cAAc,GAAGiE,OAAO,CAACjE,cAAc;KACvC,MAAM,IAAI,IAAI,CAACjB,OAAO,CAACiB,cAAc,EAAE;MACvCA,cAAc,GAAG,IAAI,CAACjB,OAAO,CAACiB,cAAc;;IAE7C,OAAO,IAAIW,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClClG,IAAI,CAAC0G,mBAAmB,CACvBL,IAAI,EACJI,kBAAkB,EAClB,UAACN,GAAG,EAAE5G,IAAI;QACT,IAAI4G,GAAG,EAAE;UACRD,MAAM,CAACC,GAAG,CAAC;SACX,MAAM;UACNlD,OAAO,CAAC1D,IAAI,CAAC;;MAEf,CAAC,EACD8C,cAAc,CACd;IACF,CAAC,CAAC;EACH,CAAC;EAED;;;;;;EAMOzC,SAAA,CAAAsB,SAAA,CAAAyF,YAAY,GAAnB,UACC7B,QAAgB,EAChBzC,cAA4D;IAA5D,IAAAA,cAAA;MAAAA,cAAA,GAAiC,IAAI,CAACjB,OAAO,CAACiB,cAAc;IAAA;IAE5D,IAAI,CAAC,IAAI,CAACtC,QAAQ,EAAE;MACnB,OAAO,IAAI,CAAC8E,gBAAgB,EAAE;;IAE/B,IAAI,CAACC,QAAQ,EAAE;MACd,OAAO,IAAI,CAACe,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACE,aAAa,CAAC;;IAG1D,IAAMhG,IAAI,GAAG,IAAI,CAACwG,iBAAiB,CAAC1B,QAAQ,CAAC;IAC7C,OAAO,IAAI9B,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClClG,IAAI,CAAC4G,sBAAsB,CAAC,UAACT,GAAG,EAAE5G,IAAI;QACrC,IAAI4G,GAAG,EAAE;UACRD,MAAM,CAACC,GAAG,CAAC;SACX,MAAM;UACNlD,OAAO,CAAC1D,IAAI,CAAC;;MAEf,CAAC,EAAE8C,cAAc,CAAC;IACnB,CAAC,CAAC;EACH,CAAC;EAED;;;;;;EAMOzC,SAAA,CAAAsB,SAAA,CAAA2F,MAAM,GAAb,UACCC,oBAAyC,EACzCC,EAAW,EACX1E,cAA4D;IAA5D,IAAAA,cAAA;MAAAA,cAAA,GAAiC,IAAI,CAACjB,OAAO,CAACiB,cAAc;IAAA;IAE5D,IAAI,CAAC,IAAI,CAACtC,QAAQ,EAAE;MACnB,OAAO,IAAI,CAAC8E,gBAAgB,EAAE;;IAG/B,IAAIC,QAAQ,GAAG,IAAI;IACnB,IAAIC,QAAQ,GAAG,IAAI;IACnB,IAAIE,cAAc,GAAG,EAAE;IAEvB;IACA,IAAI,OAAO6B,oBAAoB,KAAK,QAAQ,EAAE;MAC7ChC,QAAQ,GAAGgC,oBAAoB;MAC/B/B,QAAQ,GAAGgC,EAAE;KACb,MAAM,IAAI3I,OAAA,CAAA4I,sBAAsB,CAACF,oBAAoB,CAAC,EAAE;MACxD,IAAI,OAAOC,EAAE,KAAK,WAAW,EAAE;QAC9BjI,MAAM,CAACmI,IAAI,CACV,kEAAkE,CAClE;;MAEFnC,QAAQ,GAAGgC,oBAAoB,CAAChC,QAAQ;MACxCC,QAAQ,GAAG+B,oBAAoB,CAAC/B,QAAQ;MACxCE,cAAc,GAAG6B,oBAAoB,CAAC7B,cAAc;KACpD,MAAM;MACN,OAAO,IAAI,CAACY,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACoB,eAAe,CAAC;;IAE5D,IAAI,CAACpC,QAAQ,EAAE;MACd,OAAO,IAAI,CAACe,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACE,aAAa,CAAC;;IAE1D,IAAMmB,WAAW,GAAG,IAAI5I,4BAAA,CAAA6I,qBAAqB,CAAC;MAC7CC,QAAQ,EAAEvC,QAAQ;MAClBwC,QAAQ,EAAEvC,QAAQ;MAClBwC,cAAc,EAAEtC,cAAc;MAC9BuC,cAAc,EAAEnF;KAChB,CAAC;IACF,IAAI0C,QAAQ,EAAE;MACb,OAAO,IAAI,CAAC0C,kBAAkB,CAACN,WAAW,CAAC;KAC3C,MAAM;MACN,OAAO,IAAI,CAACO,qBAAqB,CAACP,WAAW,CAAC;;EAEhD,CAAC;EAED;;;;;;;EAOQvH,SAAA,CAAAsB,SAAA,CAAAyG,aAAa,GAArB,UACC3H,IAAiB,EACjBiD,OAA4C,EAC5CiD,MAA6B;IAH9B,IAAApG,KAAA;IAKC,IAAM8H,IAAI,GAAG,IAAI;IACjB,OAAO;MACNC,SAAS,EAAE,SAAAA,UAAMC,OAAO;QAAA,OAAAC,SAAA,CAAAjI,KAAA;;;;;gBACvBhB,MAAM,CAACuC,KAAK,CAACyG,OAAO,CAAC;gBACrB,OAAO9H,IAAI,CAAC,eAAe,CAAC;gBAC5B,OAAOA,IAAI,CAAC,gBAAgB,CAAC;;;;gBAE5B,qBAAM,IAAI,CAACE,WAAW,CAAC8H,KAAK,EAAE;;gBAA9BnH,EAAA,CAAAoH,IAAA,EAA8B;gBACjB,qBAAM,IAAI,CAAC/H,WAAW,CAACgI,GAAG,CAACJ,OAAO,EAAE,SAAS,CAAC;;gBAArDK,IAAI,GAAGtH,EAAA,CAAAoH,IAAA,EAA8C;gBAC3DnJ,MAAM,CAACuC,KAAK,CAAC,oCAAoC,EAAE8G,IAAI,CAAC;;;;gBAExDrJ,MAAM,CAACuC,KAAK,CAAC,gCAAgC,EAAE+G,GAAC,CAAC;;;;gBAK5B,qBAAM,IAAI,CAACC,mBAAmB,EAAE;;gBAA9CC,WAAW,GAAGzH,EAAA,CAAAoH,IAAA,EAAgC;gBACpDL,IAAI,CAAC5H,IAAI,GAAGsI,WAAW;gBACvBjJ,iBAAiB,CAChB,QAAQ,EACRiJ,WAAW,EACX,YAAUtI,IAAI,CAACuI,WAAW,EAAE,wBAAqB,CACjD;gBACDtF,OAAO,CAACqF,WAAW,CAAC;;;;gBAEpBxJ,MAAM,CAACwB,KAAK,CAAC,kCAAkC,EAAEkI,GAAC,CAAC;gBACnDtC,MAAM,CAACsC,GAAC,CAAC;;;;;;;;;OAGX;;MACDC,SAAS,EAAE,SAAAA,UAAAtC,GAAG;QACbrH,MAAM,CAACuC,KAAK,CAAC,gBAAgB,EAAE8E,GAAG,CAAC;QACnC9G,iBAAiB,CAChB,gBAAgB,EAChB8G,GAAG,EACAnG,IAAI,CAACuI,WAAW,EAAE,sBAAmB,CACxC;QACDrC,MAAM,CAACC,GAAG,CAAC;MACZ,CAAC;MACDuC,eAAe,EAAE,SAAAA,gBAAAC,cAAc;QAC9B7J,MAAM,CAACuC,KAAK,CAAC,yCAAyC,CAAC;QACvDrB,IAAI,CAAC,eAAe,CAAC,GAAG,kBAAkB;QAC1CA,IAAI,CAAC,gBAAgB,CAAC,GAAG2I,cAAc;QACvC1F,OAAO,CAACjD,IAAI,CAAC;MACd,CAAC;MACD4I,WAAW,EAAE,SAAAA,YAACC,aAAa,EAAEF,cAAc;QAC1C7J,MAAM,CAACuC,KAAK,CAAC,qBAAqB,CAAC;QACnCrB,IAAI,CAAC,eAAe,CAAC,GAAG6I,aAAa;QACrC7I,IAAI,CAAC,gBAAgB,CAAC,GAAG2I,cAAc;QACvC1F,OAAO,CAACjD,IAAI,CAAC;MACd,CAAC;MACD8I,QAAQ,EAAE,SAAAA,SAACD,aAAa,EAAEF,cAAc;QACvC7J,MAAM,CAACuC,KAAK,CAAC,kBAAkB,EAAEwH,aAAa,CAAC;QAC/C7I,IAAI,CAAC,eAAe,CAAC,GAAG6I,aAAa;QACrC7I,IAAI,CAAC,gBAAgB,CAAC,GAAG2I,cAAc;QACvC1F,OAAO,CAACjD,IAAI,CAAC;MACd,CAAC;MACD+I,mBAAmB,EAAE,SAAAA,oBAACC,cAAc,EAAEC,kBAAkB;QACvDnK,MAAM,CAACuC,KAAK,CAAC,qBAAqB,CAAC;QACnCrB,IAAI,CAAC,eAAe,CAAC,GAAG,uBAAuB;QAC/CA,IAAI,CAAC,gBAAgB,CAAC,GAAG;UACxBgJ,cAAc,EAAAA,cAAA;UACdC,kBAAkB,EAAAA;SAClB;QACDhG,OAAO,CAACjD,IAAI,CAAC;MACd,CAAC;MACDkJ,YAAY,EAAE,SAAAA,aAACL,aAAa,EAAEF,cAAc;QAC3C7J,MAAM,CAACuC,KAAK,CAAC,qBAAqB,CAAC;QACnCrB,IAAI,CAAC,eAAe,CAAC,GAAG6I,aAAa;QACrC7I,IAAI,CAAC,gBAAgB,CAAC,GAAG2I,cAAc;QACvC1F,OAAO,CAACjD,IAAI,CAAC;MACd,CAAC;MACDmJ,aAAa,EAAE,SAAAA,cAACN,aAAa,EAAEF,cAAc;QAC5C7J,MAAM,CAACuC,KAAK,CAAC,sBAAsB,EAAEwH,aAAa,CAAC;QACnD7I,IAAI,CAAC,eAAe,CAAC,GAAG6I,aAAa;QACrC7I,IAAI,CAAC,gBAAgB,CAAC,GAAG2I,cAAc;QACvC1F,OAAO,CAACjD,IAAI,CAAC;MACd;KACA;EACF,CAAC;EAED;;;;;;EAMQJ,SAAA,CAAAsB,SAAA,CAAAuG,kBAAkB,GAA1B,UACCN,WAAkC;IADnC,IAAArH,KAAA;IAGC,IAAI,IAAI,CAACsJ,aAAa,EAAE;MACvB,MAAM,IAAItG,KAAK,CAAC,6CAA6C,CAAC;;IAG/D,IAAM9C,IAAI,GAAG,IAAI,CAACwG,iBAAiB,CAACW,WAAW,CAACoB,WAAW,EAAE,CAAC;IAE9D,IAAI,CAACa,aAAa,GAAG,IAAIpG,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAChDlG,IAAI,CAACqJ,gBAAgB,CACpBlC,WAAW,EACXrH,KAAI,CAAC6H,aAAa,CACjB3H,IAAI,EACJ,UAAAsJ,KAAK;QACJxJ,KAAI,CAACsJ,aAAa,GAAG,IAAI;QACzBnG,OAAO,CAACqG,KAAK,CAAC;MACf,CAAC,EACD,UAAAhJ,KAAK;QACJR,KAAI,CAACsJ,aAAa,GAAG,IAAI;QACzBlD,MAAM,CAAC5F,KAAK,CAAC;MACd,CAAC,CACD,CACD;IACF,CAAC,CAAC;IAEF,OAAO,IAAI,CAAC8I,aAAa;EAC1B,CAAC;EAED;;;;;;EAMQxJ,SAAA,CAAAsB,SAAA,CAAAwG,qBAAqB,GAA7B,UACCP,WAAkC;IADnC,IAAArH,KAAA;IAGC,IAAME,IAAI,GAAG,IAAI,CAACwG,iBAAiB,CAACW,WAAW,CAACoB,WAAW,EAAE,CAAC;IAC9DvI,IAAI,CAACuJ,yBAAyB,CAAC,aAAa,CAAC;IAE7C,OAAO,IAAIvG,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClClG,IAAI,CAACwJ,YAAY,CAACrC,WAAW,EAAErH,KAAI,CAAC6H,aAAa,CAAC3H,IAAI,EAAEiD,OAAO,EAAEiD,MAAM,CAAC,CAAC;IAC1E,CAAC,CAAC;EACH,CAAC;EAED;;;;;;;;EAQOtG,SAAA,CAAAsB,SAAA,CAAAuI,aAAa,GAApB,UAAqBzJ,IAAuB;IAC3C,OAAO,IAAIgD,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;MAC3B3J,IAAI,CAACyJ,aAAa,CAAC,UAACtD,GAAG,EAAEyD,UAAU;QAClC,IAAIzD,GAAG,EAAE;UACRrH,MAAM,CAACuC,KAAK,CAAC,wBAAwB,EAAE8E,GAAG,CAAC;UAC3CwD,GAAG,CAACxD,GAAG,CAAC;UACR;;QAEDrH,MAAM,CAACuC,KAAK,CAAC,yBAAyB,EAAEuI,UAAU,CAAC;QACnDF,GAAG,CAACE,UAAU,CAAC;QACf;MACD,CAAC,CAAC;IACH,CAAC,CAAC;EACH,CAAC;EAED;;;;;EAKOhK,SAAA,CAAAsB,SAAA,CAAA2I,eAAe,GAAtB,UACC7J,IAAuB,EACvBwE,MAA4B;IAF7B,IAAA1E,KAAA;IAIC,IAAM8H,IAAI,GAAG,IAAI;IACjB,OAAO,IAAI5E,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;MAC3B,IAAMtH,cAAc,GAAGvC,KAAI,CAACsB,OAAO,CAACiB,cAAc,CAAC,CAAC;MAEpD,IAAMyH,WAAW,GAAGtF,MAAM,GAAGA,MAAM,CAACsF,WAAW,GAAG,KAAK;MACvD9J,IAAI,CAAC+J,WAAW,CACf,UAAC5D,GAAG,EAAE5G,IAAI;QACT,IAAI4G,GAAG,EAAE;UACRrH,MAAM,CAACuC,KAAK,CAAC,8BAA8B,EAAE8E,GAAG,CAAC;UACjDwD,GAAG,CAACxD,GAAG,CAAC;UACR;;QAGD,IAAM6D,OAAO,GAAGpC,IAAI,CAACqC,uBAAuB,CAAC1K,IAAI,CAAC;QAClD,IAAI,CAACyK,OAAO,EAAE;UACbL,GAAG,CAAC,kBAAkB,CAAC;UACvB;SACA,MAAM;UACND,GAAG,CAACM,OAAO,CAAC;UACZ;;MAEF,CAAC,EACD;QAAEF,WAAW,EAAAA,WAAA;QAAEzH,cAAc,EAAAA;MAAA,CAAE,CAC/B;IACF,CAAC,CAAC;EACH,CAAC;EAEOzC,SAAA,CAAAsB,SAAA,CAAA+I,uBAAuB,GAA/B,UAAgC1K,IAAI;IACnC,IAAI2K,GAAG,GAAG,IAAI;IACd,IAAMC,YAAY,GAAG5K,IAAI,CAAC6K,mBAAmB;IAC7C;IACA;IACA,IAAID,YAAY,EAAE;MACjBD,GAAG,GAAGC,YAAY;KAClB,MAAM;MACN;MACA,IAAME,OAAO,GAAG9K,IAAI,CAAC+K,kBAAkB;MACvC,IAAI,CAACD,OAAO,EAAE;QACb;QACA;QACA;QACA;QACA,IAAME,UAAU,GAAGhL,IAAI,CAACgL,UAAU;QAClC,IAAIA,UAAU,EAAE;UACfL,GAAG,GAAG,SAAS;SACf,MAAM;UACNA,GAAG,GAAG,OAAO;;OAEd,MAAM,IAAIG,OAAO,CAACzF,MAAM,KAAK,CAAC,EAAE;QAChCsF,GAAG,GAAG,OAAO;OACb,MAAM;QACNpL,MAAM,CAACuC,KAAK,CAAC,kCAAkC,EAAE9B,IAAI,CAAC;;;IAGxD,OAAO2K,GAAG;EACX,CAAC;EAEOtK,SAAA,CAAAsB,SAAA,CAAAsJ,YAAY,GAApB,UAAqBxK,IAAI,EAAEwE,MAAM;IAChC,OAAO,IAAIxB,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;MAC3B3J,IAAI,CAAC+J,WAAW,CAAC,UAAC5D,GAAG,EAAE5G,IAAI;QAC1B,IAAI4G,GAAG,EAAE;UACRrH,MAAM,CAACuC,KAAK,CAAC,0BAA0B,EAAE8E,GAAG,CAAC;UAC7CwD,GAAG,CAACxD,GAAG,CAAC;UACR;SACA,MAAM;UACNuD,GAAG,CAACnK,IAAI,CAAC;UACT;;MAEF,CAAC,EAAEiF,MAAM,CAAC;IACX,CAAC,CAAC;EACH,CAAC;EAED;;;;;;EAMa5E,SAAA,CAAAsB,SAAA,CAAAuJ,eAAe,GAA5B,UACCzK,IAAuB,EACvB0K,SAAsE;;;;;;YAEhErI,cAAc,GAAG,IAAI,CAACjB,OAAO,CAACiB,cAAc;YAEjC,qBAAM,IAAI,CAACmI,YAAY,CAACxK,IAAI,EAAE;cAC9C8J,WAAW,EAAE,IAAI;cACjBzH,cAAc,EAAAA;aACd,CAAC;;YAHIsI,QAAQ,GAAGC,EAAA,CAAA3C,IAAA,EAGf;YACE4C,cAAc,GAAG,IAAI;YACrBC,eAAe,GAAG,IAAI;YAElBjK,EAAA,GAAA6J,SAAS;;mBACX,MAAM;gBAAN;mBACA,oBAAoB;gBAApB;mBAMA,KAAK;gBAAL;mBACA,SAAS;gBAAT;mBAMA,OAAO;gBAAP;YAAO;;;YAZXI,eAAe,GAAG;cACjBC,YAAY,EAAE,IAAI;cAClBC,OAAO,EAAE;aACT;YACD;;YAGAH,cAAc,GAAG;cAChBE,YAAY,EAAE,IAAI;cAClBC,OAAO,EAAE;aACT;YACD;;YAEMX,OAAO,GAAGM,QAAQ,CAAC,oBAAoB,CAAC;YACvB,qBAAM,IAAI,CAACV,uBAAuB,CAACU,QAAQ,CAAC;;YAA7DM,cAAc,GAAGL,EAAA,CAAA3C,IAAA,EAA4C;YACnE,IAAIgD,cAAc,KAAK,OAAO,EAAE;cAC/B,sBAAOjI,OAAO,CAACC,OAAO,CAAC,wBAAwB,CAAC;aAChD,MAAM,IAAIgI,cAAc,KAAK,SAAS,EAAE;cACxCJ,cAAc,GAAG;gBAChBE,YAAY,EAAE,KAAK;gBACnBC,OAAO,EAAE;eACT;aACD,MAAM,IAAIC,cAAc,KAAK,oBAAoB,EAAE;cACnDH,eAAe,GAAG;gBACjBC,YAAY,EAAE,KAAK;gBACnBC,OAAO,EAAE;eACT;aACD,MAAM;cACN,sBAAO,IAAI,CAACnF,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACoF,UAAU,CAAC;;YAEvD;YACA;YACA,IAAIb,OAAO,IAAIA,OAAO,CAACzF,MAAM,KAAK,CAAC,EAAE;cACpC;cACAyF,OAAO,CAACc,OAAO,CAAC,UAAAnB,OAAO;gBACtB,IAAIA,OAAO,KAAK,SAAS,EAAE;kBAC1Ba,cAAc,GAAG;oBAChBE,YAAY,EAAE,KAAK;oBACnBC,OAAO,EAAE;mBACT;iBACD,MAAM,IAAIhB,OAAO,KAAK,oBAAoB,EAAE;kBAC5Cc,eAAe,GAAG;oBACjBC,YAAY,EAAE,KAAK;oBACnBC,OAAO,EAAE;mBACT;;cAEH,CAAC,CAAC;;YAEH;;YAEAlM,MAAM,CAACuC,KAAK,CAAC,6BAA6B,CAAC;YAC3C,sBAAO,IAAI,CAACwE,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACsF,KAAK,CAAC;;YAG7CxD,IAAI,GAAG,IAAI;YACjB,sBAAO,IAAI5E,OAAO,CAAS,UAAC0G,GAAG,EAAEC,GAAG;cACnC3J,IAAI,CAACqL,oBAAoB,CACxBR,cAAc,EACdC,eAAe,EACf,UAAC3E,GAAG,EAAEmF,MAAM;gBACX,IAAInF,GAAG,EAAE;kBACRrH,MAAM,CAACuC,KAAK,CAAC,+BAA+B,EAAE8E,GAAG,CAAC;kBAClD,OAAOwD,GAAG,CAACxD,GAAG,CAAC;;gBAEhBrH,MAAM,CAACuC,KAAK,CAAC,sBAAsB,EAAEiK,MAAM,CAAC;gBAC5CxM,MAAM,CAACuC,KAAK,CAAC,yCAAyC,CAAC;gBACvD;gBACArB,IAAI,CAAC+J,WAAW,CACf,UAAC5D,GAAG,EAAE5G,IAAI;kBACT,IAAI4G,GAAG,EAAE;oBACRrH,MAAM,CAACuC,KAAK,CAAC,0BAA0B,EAAE8E,GAAG,CAAC;oBAC7C,OAAOwD,GAAG,CAACxD,GAAG,CAAC;mBACf,MAAM;oBACN,OAAOuD,GAAG,CAAC4B,MAAM,CAAC;;gBAEpB,CAAC,EACD;kBACCxB,WAAW,EAAE,IAAI;kBACjBzH,cAAc,EAAAA;iBACd,CACD;cACF,CAAC,CACD;YACF,CAAC,CAAC;QAAC;;;GACH;EAED;;;;;;EAMOzC,SAAA,CAAAsB,SAAA,CAAAqK,UAAU,GAAjB,UAAkBvL,IAAiB;IAClC,OAAO,IAAIgD,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;MAC3B3J,IAAI,CAACwL,UAAU,CAAC,UAACrF,GAAG,EAAE5G,IAAI;QACzB,IAAI4G,GAAG,EAAE;UACRrH,MAAM,CAACuC,KAAK,CAAC,oBAAoB,EAAE8E,GAAG,CAAC;UACvCwD,GAAG,CAACxD,GAAG,CAAC;UACR;;QAEDrH,MAAM,CAACuC,KAAK,CAAC,qBAAqB,EAAE9B,IAAI,CAAC;QACzCmK,GAAG,CAACnK,IAAI,CAAC;QACT;MACD,CAAC,CAAC;IACH,CAAC,CAAC;EACH,CAAC;EAED;;;;;;EAMOK,SAAA,CAAAsB,SAAA,CAAAuK,SAAS,GAAhB,UAAiBzL,IAAiB;IACjC,OAAO,IAAIgD,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;MAC3B3J,IAAI,CAAC0L,SAAS,CAAC,UAACvF,GAAG,EAAE5G,IAAI;QACxB,IAAI4G,GAAG,EAAE;UACRrH,MAAM,CAACuC,KAAK,CAAC,mBAAmB,EAAE8E,GAAG,CAAC;UACtCwD,GAAG,CAACxD,GAAG,CAAC;UACR;;QAEDrH,MAAM,CAACuC,KAAK,CAAC,oBAAoB,EAAE9B,IAAI,CAAC;QACxCmK,GAAG,CAACnK,IAAI,CAAC;QACT;MACD,CAAC,CAAC;IACH,CAAC,CAAC;EACH,CAAC;EAED;;;;;EAKOK,SAAA,CAAAsB,SAAA,CAAAyK,SAAS,GAAhB,UAAiB3L,IAAuB;IACvC,OAAO,IAAIgD,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;MAC3B3J,IAAI,CAAC4L,sBAAsB,CAAC;QAC3BnD,SAAS,EAAE,SAAAA,UAAAtC,GAAG;UACbrH,MAAM,CAACuC,KAAK,CAAC,+BAA+B,EAAE8E,GAAG,CAAC;UAClDwD,GAAG,CAACxD,GAAG,CAAC;UACR;QACD,CAAC;QACD0F,mBAAmB,EAAE,SAAAA,oBAAAC,UAAU;UAC9BhN,MAAM,CAACuC,KAAK,CAAC,+BAA+B,EAAEyK,UAAU,CAAC;UACzDpC,GAAG,CAACoC,UAAU,CAAC;UACf;QACD;OACA,CAAC;IACH,CAAC,CAAC;EACH,CAAC;EAED;;;;;;EAMOlM,SAAA,CAAAsB,SAAA,CAAA6K,eAAe,GAAtB,UACC/L,IAAuB,EACvBgM,eAAuB;IAEvBlN,MAAM,CAACuC,KAAK,CAAC,yBAAyB,EAAErB,IAAI,EAAEgM,eAAe,CAAC;IAC9D,OAAO,IAAIhJ,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;MAC3B3J,IAAI,CAACiM,mBAAmB,CAACD,eAAe,EAAE,gBAAgB,EAAE;QAC3DvD,SAAS,EAAE,SAAAA,UAAAtC,GAAG;UACbrH,MAAM,CAACuC,KAAK,CAAC,wBAAwB,EAAE8E,GAAG,CAAC;UAC3CwD,GAAG,CAACxD,GAAG,CAAC;UACR;QACD,CAAC;QACD0B,SAAS,EAAE,SAAAA,UAAAtI,IAAI;UACdF,iBAAiB,CAChB,QAAQ,EACRW,IAAI,EACJ,YAAUA,IAAI,CAACuI,WAAW,EAAE,wBAAqB,CACjD;UACDzJ,MAAM,CAACuC,KAAK,CAAC,yBAAyB,EAAE9B,IAAI,CAAC;UAC7CmK,GAAG,CAACnK,IAAI,CAAC;UACT;QACD;OACA,CAAC;IACH,CAAC,CAAC;EACH,CAAC;EAED;;;;;EAKOK,SAAA,CAAAsB,SAAA,CAAAgL,aAAa,GAApB,UACClM,IAAuB,EACvBqG,IAAY,EACZ2D,OAAiD,EACjD3H,cAA4D;IAJ7D,IAAAvC,KAAA;IAIC,IAAAuC,cAAA;MAAAA,cAAA,GAAiC,IAAI,CAACjB,OAAO,CAACiB,cAAc;IAAA;IAE5D,IAAI,CAACgE,IAAI,EAAE;MACV,OAAO,IAAI,CAACR,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACS,SAAS,CAAC;;IAGtD,IAAMqB,IAAI,GAAG,IAAI;IACjB,OAAO,IAAI5E,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClClG,IAAI,CAACmM,WAAW,CACf9F,IAAI,EACJ;QACCwB,SAAS,EAAE,SAAAA,UAAMC,OAAO;UAAA,OAAAC,SAAA,CAAAjI,KAAA;;;;;kBACvBhB,MAAM,CAACuC,KAAK,CAACyG,OAAO,CAAC;;;;kBAEpB,qBAAM,IAAI,CAAC5H,WAAW,CAAC8H,KAAK,EAAE;;kBAA9BnH,EAAA,CAAAoH,IAAA,EAA8B;kBACjB,qBAAM,IAAI,CAAC/H,WAAW,CAACgI,GAAG,CAACJ,OAAO,EAAE,SAAS,CAAC;;kBAArDK,IAAI,GAAGtH,EAAA,CAAAoH,IAAA,EAA8C;kBAC3DnJ,MAAM,CAACuC,KAAK,CAAC,oCAAoC,EAAE8G,IAAI,CAAC;;;;kBAExDrJ,MAAM,CAACuC,KAAK,CAAC,gCAAgC,EAAE+K,GAAC,CAAC;;;kBAEjDxE,IAAI,CAAC5H,IAAI,GAAGA,IAAI;kBAEhBX,iBAAiB,CAChB,QAAQ,EACRW,IAAI,EACJ,YAAUA,IAAI,CAACuI,WAAW,EAAE,wBAAqB,CACjD;kBACDtF,OAAO,CAACjD,IAAI,CAAC;;;;;;;SAEd;;QACDyI,SAAS,EAAE,SAAAA,UAAAtC,GAAG;UACbrH,MAAM,CAACuC,KAAK,CAAC,wBAAwB,EAAE8E,GAAG,CAAC;UAC3CD,MAAM,CAACC,GAAG,CAAC;QACZ;OACA,EACD6D,OAAO,EACP3H,cAAc,CACd;IACF,CAAC,CAAC;EACH,CAAC;EAEMzC,SAAA,CAAAsB,SAAA,CAAAmL,mBAAmB,GAA1B,UACCrM,IAAuB,EACvB+E,QAAgB,EAChBkE,kBAA4B,EAC5B5G,cAA4D;IAJ7D,IAAAvC,KAAA;IAGC,IAAAmJ,kBAAA;MAAAA,kBAAA,KAA4B;IAAA;IAC5B,IAAA5G,cAAA;MAAAA,cAAA,GAAiC,IAAI,CAACjB,OAAO,CAACiB,cAAc;IAAA;IAE5D,IAAI,CAAC0C,QAAQ,EAAE;MACd,OAAO,IAAI,CAACc,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACG,aAAa,CAAC;;IAG1D,IAAM2B,IAAI,GAAG,IAAI;IACjB,OAAO,IAAI5E,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClClG,IAAI,CAACsM,4BAA4B,CAChCvH,QAAQ,EACRkE,kBAAkB,EAClB;QACCpB,SAAS,EAAE,SAAAA,UAAMC,OAAO;UAAA,OAAAC,SAAA,CAAAjI,KAAA;;;;;kBACvBhB,MAAM,CAACuC,KAAK,CAACyG,OAAO,CAAC;;;;kBAEpB,qBAAM,IAAI,CAAC5H,WAAW,CAAC8H,KAAK,EAAE;;kBAA9BnH,EAAA,CAAAoH,IAAA,EAA8B;kBACjB,qBAAM,IAAI,CAAC/H,WAAW,CAACgI,GAAG,CAACJ,OAAO,EAAE,SAAS,CAAC;;kBAArDK,IAAI,GAAGtH,EAAA,CAAAoH,IAAA,EAA8C;kBAC3DnJ,MAAM,CAACuC,KAAK,CAAC,oCAAoC,EAAE8G,IAAI,CAAC;;;;kBAExDrJ,MAAM,CAACuC,KAAK,CAAC,gCAAgC,EAAEkL,GAAC,CAAC;;;kBAEjD3E,IAAI,CAAC5H,IAAI,GAAGA,IAAI;kBAChBX,iBAAiB,CAChB,QAAQ,EACRW,IAAI,EACJ,YAAUA,IAAI,CAACuI,WAAW,EAAE,wBAAqB,CACjD;kBACDtF,OAAO,CAACjD,IAAI,CAAC;;;;;;;SAEd;;QACDyI,SAAS,EAAE,SAAAA,UAAAtC,GAAG;UACbrH,MAAM,CAACuC,KAAK,CAAC,6BAA6B,EAAE8E,GAAG,CAAC;UAChD9G,iBAAiB,CAChB,6BAA6B,EAC7B8G,GAAG,EACArG,KAAI,CAACE,IAAI,8CAA2C,CACvD;UACDkG,MAAM,CAACC,GAAG,CAAC;QACZ,CAAC;QACDyC,WAAW,EAAE,SAAAA,YAACC,aAAa,EAAEF,cAAc;UAC1C7J,MAAM,CAACuC,KAAK,CAAC,qBAAqB,CAAC;UACnCrB,IAAI,CAAC,eAAe,CAAC,GAAG6I,aAAa;UACrC7I,IAAI,CAAC,gBAAgB,CAAC,GAAG2I,cAAc;UACvC1F,OAAO,CAACjD,IAAI,CAAC;QACd,CAAC;QACD8I,QAAQ,EAAE,SAAAA,SAACD,aAAa,EAAEF,cAAc;UACvC7J,MAAM,CAACuC,KAAK,CAAC,kBAAkB,EAAEwH,aAAa,CAAC;UAC/C7I,IAAI,CAAC,eAAe,CAAC,GAAG6I,aAAa;UACrC7I,IAAI,CAAC,gBAAgB,CAAC,GAAG2I,cAAc;UACvC1F,OAAO,CAACjD,IAAI,CAAC;QACd,CAAC;QACDkJ,YAAY,EAAE,SAAAA,aAACL,aAAa,EAAEF,cAAc;UAC3C7J,MAAM,CAACuC,KAAK,CAAC,kBAAkB,EAAEwH,aAAa,CAAC;UAC/C7I,IAAI,CAAC,eAAe,CAAC,GAAG6I,aAAa;UACrC7I,IAAI,CAAC,gBAAgB,CAAC,GAAG2I,cAAc;UACvC1F,OAAO,CAACjD,IAAI,CAAC;QACd;OACA,EACDqC,cAAc,CACd;IACF,CAAC,CAAC;EACH,CAAC;EAED;;;;;EAKOzC,SAAA,CAAAsB,SAAA,CAAAsL,yBAAyB,GAAhC,UACCxM,IAAuB,EACvByM,kBAA0B,EAC1BpK,cAA4D;IAH7D,IAAAvC,KAAA;IAGC,IAAAuC,cAAA;MAAAA,cAAA,GAAiC,IAAI,CAACjB,OAAO,CAACiB,cAAc;IAAA;IAE5D,IAAI,CAAC,IAAI,CAACtC,QAAQ,EAAE;MACnB,OAAO,IAAI,CAAC8E,gBAAgB,EAAE;;IAE/B,IAAI,CAAC4H,kBAAkB,EAAE;MACxB,OAAO,IAAI,CAAC5G,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAAC4G,sBAAsB,CAAC;;IAGnE,IAAM9E,IAAI,GAAG,IAAI;IACjB,OAAO,IAAI5E,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClClG,IAAI,CAACwM,yBAAyB,CAC7BC,kBAAkB,EAClB3M,KAAI,CAAC6H,aAAa,CAAC3H,IAAI,EAAEiD,OAAO,EAAEiD,MAAM,CAAC,EACzC7D,cAAc,CACd;IACF,CAAC,CAAC;EACH,CAAC;EAED;;;;;EAKOzC,SAAA,CAAAsB,SAAA,CAAAyL,oBAAoB,GAA3B,UACC3M,IAAuB,EACvB4M,cAAwB;IAExB,IAAMhF,IAAI,GAAG,IAAI;IACjB,OAAO,IAAI5E,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClC0B,IAAI,CAACiF,WAAW,CAAC7M,IAAI,CAAC,CAAC8M,IAAI,CAAC,UAAAhF,OAAO;QAClC9H,IAAI,CAAC+M,gBAAgB,CACpBH,cAAc,EACd,UAACzG,GAAG,EAAEmF,MAAM;UACX,IAAInF,GAAG,EAAE;YACR,OAAOD,MAAM,CAACC,GAAG,CAAC;WAClB,MAAM;YACN,OAAOlD,OAAO,CAACqI,MAAM,CAAC;;QAExB,CAAC,CACD;MACF,CAAC,CAAC;IACH,CAAC,CAAC;EAEH,CAAC;EAED;;;;;EAKO1L,SAAA,CAAAsB,SAAA,CAAA8L,oBAAoB,GAA3B,UACChN,IAAuB,EACvBgF,UAAkB,EAClB3C,cAA4D;IAA5D,IAAAA,cAAA;MAAAA,cAAA,GAAiC,IAAI,CAACjB,OAAO,CAACiB,cAAc;IAAA;IAE5D,IAAM4K,aAAa,GAAgC,EAAE;IACrD,IAAMrF,IAAI,GAAG,IAAI;IACjB,OAAO,IAAI5E,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClC0B,IAAI,CAACiF,WAAW,CAAC7M,IAAI,CAAC,CAAC8M,IAAI,CAAC,UAAAhF,OAAO;QAClC,KAAK,IAAMnC,GAAG,IAAIX,UAAU,EAAE;UAC7B,IAAIW,GAAG,KAAK,KAAK,IAAIA,GAAG,CAACuH,OAAO,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE;YAClD,IAAMC,IAAI,GAA8B;cACvC7H,IAAI,EAAEK,GAAG;cACTJ,KAAK,EAAEP,UAAU,CAACW,GAAG;aACrB;YACDsH,aAAa,CAAC7H,IAAI,CAAC+H,IAAI,CAAC;;;QAG1BnN,IAAI,CAACoN,gBAAgB,CACpBH,aAAa,EACb,UAAC9G,GAAG,EAAEmF,MAAM;UACX,IAAInF,GAAG,EAAE;YACR,OAAOD,MAAM,CAACC,GAAG,CAAC;WAClB,MAAM;YACN,OAAOlD,OAAO,CAACqI,MAAM,CAAC;;QAExB,CAAC,EACDjJ,cAAc,CACd;MACF,CAAC,CAAC;IACH,CAAC,CAAC;EACH,CAAC;EACD;;;;;EAKOzC,SAAA,CAAAsB,SAAA,CAAA8H,cAAc,GAArB,UACChJ,IAAuB;IADxB,IAAAF,KAAA;IAGC,OAAO,IAAIkD,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClCpG,KAAI,CAAC+M,WAAW,CAAC7M,IAAI,CAAC,CAAC8M,IAAI,CAAC,UAAAhF,OAAO;QAClC9H,IAAI,CAACqN,iBAAiB,CAAC,UAAClH,GAAG,EAAEnB,UAAU;UACtC,IAAImB,GAAG,EAAE;YACRD,MAAM,CAACC,GAAG,CAAC;WACX,MAAM;YACNlD,OAAO,CAAC+B,UAAU,CAAC;;QAErB,CAAC,CAAC;MACH,CAAC,CAAC;IACH,CAAC,CAAC;EACH,CAAC;EAEMpF,SAAA,CAAAsB,SAAA,CAAAoM,eAAe,GAAtB,UAAuBtN,IAAuB;IAC7C,IAAM4H,IAAI,GAAG,IAAI;IACjB,OAAO,IAAI,CAACoB,cAAc,CAAChJ,IAAI,CAAC,CAAC8M,IAAI,CAAC,UAAA9H,UAAU;MAC/C,IAAMuI,KAAK,GAAG3F,IAAI,CAAC4F,kBAAkB,CAACxI,UAAU,CAAC;MACjD,IAAMyI,UAAU,GAAG,EAAE;MACrB,IAAMC,QAAQ,GAAG,EAAE;MACnB,IAAIH,KAAK,CAAC,OAAO,CAAC,EAAE;QACnB,IAAIA,KAAK,CAAC,gBAAgB,CAAC,EAAE;UAC5BG,QAAQ,CAAC,OAAO,CAAC,GAAGH,KAAK,CAAC,OAAO,CAAC;SAClC,MAAM;UACNE,UAAU,CAAC,OAAO,CAAC,GAAGF,KAAK,CAAC,OAAO,CAAC;;;MAGtC,IAAIA,KAAK,CAAC,cAAc,CAAC,EAAE;QAC1B,IAAIA,KAAK,CAAC,uBAAuB,CAAC,EAAE;UACnCG,QAAQ,CAAC,cAAc,CAAC,GAAGH,KAAK,CAAC,cAAc,CAAC;SAChD,MAAM;UACNE,UAAU,CAAC,cAAc,CAAC,GAAGF,KAAK,CAAC,cAAc,CAAC;;;MAGpD,OAAO;QACNG,QAAQ,EAAAA,QAAA;QACRD,UAAU,EAAAA;OACV;IACF,CAAC,CAAC;EACH,CAAC;EAED;;;;EAIO7N,SAAA,CAAAsB,SAAA,CAAAmH,mBAAmB,GAA1B,UACC7D,MAAwB;IADzB,IAAA1E,KAAA;IAGC,IAAI,CAAC,IAAI,CAACC,QAAQ,EAAE;MACnB,OAAO,IAAI,CAAC8E,gBAAgB,EAAE;;IAG/B,OAAO,IAAI7B,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;MAC3B7J,KAAI,CAACiD,YAAY,CACf+J,IAAI,CAAC;QAAA,OAAA/E,SAAA,CAAAjI,KAAA;;;;;;qBACD,IAAI,CAAC6N,iBAAiB,EAAE,EAAxB;gBACH7O,MAAM,CAACuC,KAAK,CAAC,qDAAqD,CAAC;gBAEnE,qBAAM,IAAI2B,OAAO,CAAC,UAAA0G,GAAG;kBACpB,IAAMkE,SAAS,GAAGC,UAAU,CAAC;oBAC5B/O,MAAM,CAACuC,KAAK,CAAC,kCAAkC,CAAC;oBAEhD/C,MAAA,CAAAmB,GAAG,CAACqO,MAAM,CAAC,MAAM,EAAEC,oBAAoB,CAAC;oBAExCrE,GAAG,EAAE;kBACN,CAAC,EAAEzK,qBAAqB,CAAC;kBAEzBX,MAAA,CAAAmB,GAAG,CAACmB,MAAM,CAAC,MAAM,EAAEmN,oBAAoB,CAAC;kBAExC,SAASA,oBAAoBA,CAAClN,EAAW;wBAATC,OAAA,GAAAD,EAAA,CAAAC,OAAO;oBAC9B,IAAAxB,KAAA,GAAAwB,OAAA,CAAAxB,KAAK;oBAEb,IACCA,KAAK,KAAK,iBAAiB,IAC3BA,KAAK,KAAK,yBAAyB,EAClC;sBACDR,MAAM,CAACuC,KAAK,CAAC,4BAA0B/B,KAAO,CAAC;sBAC/C0O,YAAY,CAACJ,SAAS,CAAC;sBAEvBtP,MAAA,CAAAmB,GAAG,CAACqO,MAAM,CAAC,MAAM,EAAEC,oBAAoB,CAAC;sBAExCrE,GAAG,EAAE;;kBAEP;gBACD,CAAC,CAAC;;gBA1BF7I,EAAA,CAAAoH,IAAA,EA0BE;;;gBAGGjI,IAAI,GAAG,IAAI,CAACD,QAAQ,CAACkO,cAAc,EAAE;gBAE3C,IAAI,CAACjO,IAAI,EAAE;kBACVlB,MAAM,CAACuC,KAAK,CAAC,mCAAmC,CAAC;kBACjDsI,GAAG,CAAC,iBAAiB,CAAC;kBACtB;;;gBAGKtH,cAAc,GAAG,IAAI,CAACjB,OAAO,CAACiB,cAAc;gBAElD;gBACArC,IAAI,CAACkO,UAAU,CACd,UAAO/H,GAAG,EAAE2B,OAAO;kBAAA,OAAAC,SAAA,CAAAjI,KAAA;;;;;;0BAClB,IAAIqG,GAAG,EAAE;4BACRrH,MAAM,CAACuC,KAAK,CAAC,gCAAgC,EAAE8E,GAAG,CAAC;4BACnDwD,GAAG,CAACxD,GAAG,CAAC;4BACR;;;0BAIK2D,WAAW,GAAGtF,MAAM,GAAGA,MAAM,CAACsF,WAAW,GAAG,KAAK;+BAEnDA,WAAW,EAAX;0BACH,qBAAM,IAAI,CAAC5J,WAAW,CAAC8H,KAAK,EAAE;;0BAA9B4C,EAAA,CAAA3C,IAAA,EAA8B;;;0BAGzB5F,cAAc,GAAG,IAAI,CAACjB,OAAO,CAACiB,cAAc;0BAG1CxB,EAAA,GAAeiH,OAAO,CAACqG,cAAc,EAAE,CAACC,aAAa,EAAE,CAAAC,KAA7C,EAAVA,KAAK,GAAAxN,EAAA,cAAG,EAAE,GAAAA,EAAA;0BAClB,IAAIwN,KAAK,CAACC,KAAK,CAAC,GAAG,CAAC,CAACC,QAAQ,CAACvP,gBAAgB,CAAC,EAAE;4BAChDgB,IAAI,CAAC+J,WAAW,CACf,UAAC5D,GAAG,EAAE5G,IAAI;8BACT,IAAI4G,GAAG,EAAE;gCACRrH,MAAM,CAACuC,KAAK,CAAC,0BAA0B,EAAE8E,GAAG,CAAC;gCAC7C;gCACA,IACCA,GAAG,CAAC3G,OAAO,KAAK,mBAAmB,IACnC2G,GAAG,CAAC3G,OAAO,KAAK,sBAAsB,IACtC2G,GAAG,CAAC3G,OAAO,KAAK,+BAA+B,CAAC;gCAAA,EAC/C;kCACDmK,GAAG,CAACxD,GAAG,CAAC;iCACR,MAAM;kCACN;kCACA;kCACAuD,GAAG,CAAC1J,IAAI,CAAC;;gCAEV;;8BAED,IAAMmK,YAAY,GAAG5K,IAAI,CAAC6K,mBAAmB,IAAI,OAAO;8BACxD,IAAM6C,aAAa,GAAG,EAAE;8BAExB,KAAK,IAAIuB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGjP,IAAI,CAACkP,cAAc,CAAC7J,MAAM,EAAE4J,CAAC,EAAE,EAAE;gCACpD,IAAME,SAAS,GAAG;kCACjBpJ,IAAI,EAAE/F,IAAI,CAACkP,cAAc,CAACD,CAAC,CAAC,CAAClJ,IAAI;kCACjCC,KAAK,EAAEhG,IAAI,CAACkP,cAAc,CAACD,CAAC,CAAC,CAACjJ;iCAC9B;gCACD,IAAMoJ,aAAa,GAAG,IAAIpQ,4BAAA,CAAA8G,oBAAoB,CAACqJ,SAAS,CAAC;gCACzDzB,aAAa,CAAC7H,IAAI,CAACuJ,aAAa,CAAC;;8BAGlC,IAAM3J,UAAU,GAAGlF,KAAI,CAAC0N,kBAAkB,CAACP,aAAa,CAAC;8BACzD1L,MAAM,CAACC,MAAM,CAACxB,IAAI,EAAE;gCAAEgF,UAAU,EAAAA,UAAA;gCAAEmF,YAAY,EAAAA;8BAAA,CAAE,CAAC;8BACjD,OAAOT,GAAG,CAAC1J,IAAI,CAAC;4BACjB,CAAC,EACD;8BAAE8J,WAAW,EAAAA,WAAA;8BAAEzH,cAAc,EAAAA;4BAAA,CAAE,CAC/B;2BACD,MAAM;4BACNvD,MAAM,CAACuC,KAAK,CACX,6CAA2CrC,gBAAgB,MAAG,GAC7D,0CAA0C,CAC3C;4BACD,sBAAO0K,GAAG,CAAC1J,IAAI,CAAC;;;;;;iBAEjB,EACD;kBAAEqC,cAAc,EAAAA;gBAAA,CAAE,CAClB;;;;;OACD,CAAC,CACDuM,KAAK,CAAC,UAAAC,CAAC;QACP/P,MAAM,CAACuC,KAAK,CAAC,uCAAuC,EAAEwN,CAAC,CAAC;QACxD,OAAOlF,GAAG,CAACkF,CAAC,CAAC;MACd,CAAC,CAAC;IACJ,CAAC,CAAC;EACH,CAAC;EAEOjP,SAAA,CAAAsB,SAAA,CAAAyM,iBAAiB,GAAzB;IACC,OAAO,IAAI,CAAC1N,mBAAmB;EAChC,CAAC;EAED;;;;;EAKaL,SAAA,CAAAsB,SAAA,CAAA4N,wBAAwB,GAArC,UACCtK,MAAwB;;;;;;YAExB1F,MAAM,CAACuC,KAAK,CAAC,oCAAoC,CAAC;YAC9C0N,aAAa,GAAG,IAAI;;;;YAEvB,qBAAM,IAAI,CAAChM,YAAY;;YAAvBlC,EAAA,CAAAoH,IAAA,EAAuB;;;;YAEvBnJ,MAAM,CAACuC,KAAK,CAAC,uCAAuC,EAAE2N,GAAC,CAAC;YACxD,MAAMA,GAAC;;YAGR,IAAI;cACGC,aAAa,GAAGC,IAAI,CAACC,KAAK,CAC/B,IAAI,CAACpO,QAAQ,CAACqO,OAAO,CAAC,2BAA2B,CAAC,CAClD;cACD,IAAIH,aAAa,EAAE;gBAClBF,aAAa,GAAAM,QAAA,CAAAA,QAAA,KACTJ,aAAa,CAACjP,IAAI;kBACrBsP,KAAK,EAAEL,aAAa,CAACK;gBAAK,EAC1B;;aAEF,CAAC,OAAOT,CAAC,EAAE;cACX/P,MAAM,CAACuC,KAAK,CAAC,8CAA8C,CAAC;;iBAGzD0N,aAAa,EAAb;YACH,IAAI,CAAC/O,IAAI,GAAG+O,aAAa;YACzBjQ,MAAM,CAACuC,KAAK,CAAC,0CAA0C,EAAE,IAAI,CAACrB,IAAI,CAAC;YACnE,sBAAO,IAAI,CAACA,IAAI;;YAEhBlB,MAAM,CAACuC,KAAK,CAAC,yCAAyC,CAAC;YACnDrB,IAAI,GAAG,IAAI;;;;YAEP,qBAAM,IAAI,CAACqI,mBAAmB,CAAC7D,MAAM,CAAC;;YAA7CxE,IAAI,GAAGa,EAAA,CAAAoH,IAAA,EAAsC;;;;YAE7C,IAAIsH,GAAC,KAAK,aAAa,EAAE;cACxBzQ,MAAM,CAACwB,KAAK,CACX,gEAAgE,GAC/D,kFAAkF,CACnF;;YAEFxB,MAAM,CAACuC,KAAK,CAAC,4CAA4C,EAAEkO,GAAC,CAAC;YAC7D,sBAAOvM,OAAO,CAACkD,MAAM,CAAC,+BAA+B,CAAC;;YAEvD,IAAI,CAAClG,IAAI,GAAGA,IAAI;YAChB,sBAAO,IAAI,CAACA,IAAI;QAAC;;;GAElB;EAED;;;;EAIOJ,SAAA,CAAAsB,SAAA,CAAAsO,cAAc,GAArB;IACC,IAAM5H,IAAI,GAAG,IAAI;IACjB9I,MAAM,CAACuC,KAAK,CAAC,yBAAyB,CAAC;IACvC;IACA,IAAI,CAAC,IAAI,CAACtB,QAAQ,EAAE;MACnB,OAAOiD,OAAO,CAACkD,MAAM,EAAE;;IAGxB,OAAO,IAAIlD,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;MAC3B/B,IAAI,CACFS,mBAAmB,EAAE,CACrByE,IAAI,CAAC,UAAA9M,IAAI;QACT4H,IAAI,CACFiF,WAAW,CAAC7M,IAAI,CAAC,CACjB8M,IAAI,CAAC,UAAAhF,OAAO;UACZ4B,GAAG,CAAC5B,OAAO,CAAC;UACZ;QACD,CAAC,CAAC,CACD8G,KAAK,CAAC,UAAAC,CAAC;UACP/P,MAAM,CAACuC,KAAK,CAAC,mCAAmC,EAAEwN,CAAC,CAAC;UACpDlF,GAAG,CAACkF,CAAC,CAAC;UACN;QACD,CAAC,CAAC;MACJ,CAAC,CAAC,CACDD,KAAK,CAAC,UAAAC,CAAC;QACP/P,MAAM,CAACuC,KAAK,CAAC,gCAAgC,EAAEwN,CAAC,CAAC;QACjDlF,GAAG,CAACkF,CAAC,CAAC;QACN;MACD,CAAC,CAAC;IACJ,CAAC,CAAC;EACH,CAAC;EAED;;;;;EAKOjP,SAAA,CAAAsB,SAAA,CAAA2L,WAAW,GAAlB,UAAmB7M,IAAI;IACtB,IAAI,CAACA,IAAI,EAAE;MACVlB,MAAM,CAACuC,KAAK,CAAC,kBAAkB,CAAC;MAChC,OAAO,IAAI,CAACwE,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAAC2J,aAAa,CAAC;;IAE1D,IAAMpN,cAAc,GAAG,IAAI,CAACjB,OAAO,CAACiB,cAAc,CAAC,CAAC;IAEpD,OAAO,IAAIW,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClCpH,MAAM,CAACuC,KAAK,CAAC,qCAAqC,EAAErB,IAAI,CAAC;MACzDA,IAAI,CAACkO,UAAU,CACd,UAAC/H,GAAG,EAAE2B,OAAO;QACZ,IAAI3B,GAAG,EAAE;UACRrH,MAAM,CAACuC,KAAK,CAAC,qCAAqC,EAAErB,IAAI,CAAC;UACzDkG,MAAM,CAACC,GAAG,CAAC;UACX;SACA,MAAM;UACNrH,MAAM,CAACuC,KAAK,CAAC,iCAAiC,EAAEyG,OAAO,CAAC;UACxD7E,OAAO,CAAC6E,OAAO,CAAC;UAChB;;MAEF,CAAC,EACD;QAAEzF,cAAc,EAAAA;MAAA,CAAE,CAClB;IACF,CAAC,CAAC;EACH,CAAC;EAED;;;;EAIazC,SAAA,CAAAsB,SAAA,CAAAP,sBAAsB,GAAnC;;;;;;;YACC7B,MAAM,CAACuC,KAAK,CAAC,kCAAkC,CAAC;;;;YAG/C,qBAAM,IAAI,CAAC0B,YAAY;;YAAvBlC,EAAA,CAAAoH,IAAA,EAAuB;;;;YAEvBnJ,MAAM,CAACuC,KAAK,CAAC,uCAAuC,EAAEqO,GAAC,CAAC;YACxD,MAAMA,GAAC;;YAIJT,aAAa,GAAG,IAAI;YACxB,IAAI;cACHA,aAAa,GAAGC,IAAI,CAACC,KAAK,CACzB,IAAI,CAACpO,QAAQ,CAACqO,OAAO,CAAC,2BAA2B,CAAC,CAClD;aACD,CAAC,OAAOP,CAAC,EAAE;cACX/P,MAAM,CAACuC,KAAK,CAAC,uDAAuD,EAAEwN,CAAC,CAAC;;YAGzE,IAAII,aAAa,EAAE;cAClB;cACA,sBAAO,IAAI,CAAC/O,WAAW,CAACyP,qBAAqB,CAACV,aAAa,CAAC;aAC5D,MAAM;cACN,sBAAO,IAAI,CAACO,cAAc,EAAE,CAC1B1C,IAAI,CAAC,UAAAhF,OAAO;gBACZhJ,MAAM,CAACuC,KAAK,CAAC,yBAAyB,EAAEyG,OAAO,CAAC;gBAChD,OAAOhI,KAAI,CAACI,WAAW,CAACgI,GAAG,CAACJ,OAAO,EAAE,SAAS,CAAC;cAChD,CAAC,CAAC,CACD8G,KAAK,CAAC,UAAAtO,KAAK;gBACXxB,MAAM,CAACuC,KAAK,CAAC,wBAAwB,EAAEf,KAAK,CAAC;gBAC7C,OAAOR,KAAI,CAACI,WAAW,CAACgI,GAAG,CAAC,IAAI,EAAE,OAAO,CAAC;cAC3C,CAAC,CAAC;;;;;;GAEJ;;EAEMtI,SAAA,CAAAsB,SAAA,CAAAT,kBAAkB,GAAzB;IACC3B,MAAM,CAACuC,KAAK,CAAC,6BAA6B,CAAC;IAC3C,OAAO,IAAI,CAACnB,WAAW,CAAC0P,GAAG,EAAE;EAC9B,CAAC;EAED;;;;;;EAMOhQ,SAAA,CAAAsB,SAAA,CAAA2O,mBAAmB,GAA1B,UACC7P,IAAuB,EACvBmN,IAAY,EACZ9K,cAA4D;IAA5D,IAAAA,cAAA;MAAAA,cAAA,GAAiC,IAAI,CAACjB,OAAO,CAACiB,cAAc;IAAA;IAE5D,OAAO,IAAIW,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClClG,IAAI,CAAC8P,4BAA4B,CAChC3C,IAAI,EACJ;QACCtF,SAAS,WAAAA,UAACkI,OAAO;UAChB,OAAO9M,OAAO,CAAC8M,OAAO,CAAC;QACxB,CAAC;QACDtH,SAAS,WAAAA,UAACtC,GAAG;UACZ,OAAOD,MAAM,CAACC,GAAG,CAAC;QACnB;OACA,EACD9D,cAAc,CACd;IACF,CAAC,CAAC;EACH,CAAC;EAED;;;;;;;EAOOzC,SAAA,CAAAsB,SAAA,CAAA8O,yBAAyB,GAAhC,UACChQ,IAAuB,EACvBmN,IAAY,EACZ9G,IAAY;IAEZ,IAAI,CAACA,IAAI,EAAE;MACV,OAAO,IAAI,CAACR,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACS,SAAS,CAAC;;IAGtD,OAAO,IAAIvD,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClClG,IAAI,CAACiQ,eAAe,CAAC9C,IAAI,EAAE9G,IAAI,EAAE;QAChCwB,SAAS,WAAAA,UAACtI,IAAI;UACb0D,OAAO,CAAC1D,IAAI,CAAC;UACb;QACD,CAAC;QACDkJ,SAAS,WAAAA,UAACtC,GAAG;UACZD,MAAM,CAACC,GAAG,CAAC;UACX;QACD;OACA,CAAC;IACH,CAAC,CAAC;EACH,CAAC;EAEMvG,SAAA,CAAAsB,SAAA,CAAAgP,0BAA0B,GAAjC,UAAkC/C,IAAY;IAC7C,IAAMvF,IAAI,GAAG,IAAI;IACjB,OAAOA,IAAI,CACTS,mBAAmB,EAAE,CACrByE,IAAI,CAAC,UAAA9M,IAAI;MAAI,OAAA4H,IAAI,CAACiI,mBAAmB,CAAC7P,IAAI,EAAEmN,IAAI,CAAC;IAApC,CAAoC,CAAC;EACrD,CAAC;EAED;;;;;;EAMAvN,SAAA,CAAAsB,SAAA,CAAAiP,gCAAgC,GAAhC,UACChD,IAAY,EACZ9G,IAAY;IAEZ,IAAMuB,IAAI,GAAG,IAAI;IACjB,OAAOA,IAAI,CACTS,mBAAmB,EAAE,CACrByE,IAAI,CAAC,UAAA9M,IAAI;MAAI,OAAA4H,IAAI,CAACoI,yBAAyB,CAAChQ,IAAI,EAAEmN,IAAI,EAAE9G,IAAI,CAAC;IAAhD,CAAgD,CAAC;EACjE,CAAC;EAEazG,SAAA,CAAAsB,SAAA,CAAAkP,sBAAsB,GAApC,UACCC,IAAiB,EACjBrQ,IAAuB;;;;;;;;YAGtB,qBAAM,IAAI,CAAC+C,YAAY;;YAAvBlC,EAAA,CAAAoH,IAAA,EAAuB;;;;YAEvBnJ,MAAM,CAACuC,KAAK,CAAC,uCAAuC,EAAEiP,GAAC,CAAC;YACxD,MAAMA,GAAC;;YAGFC,kBAAkB,GACvB,IAAI,CAACrM,aAAa,IAClB,IAAI,CAACnD,QAAQ,CAACqO,OAAO,CAAC,8BAA8B,CAAC,KAAK,MAAM;YAEjE,sBAAO,IAAIpM,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;cAC3B,IAAI0G,IAAI,IAAIA,IAAI,CAACG,MAAM,EAAE;gBACxB1R,MAAM,CAACuC,KAAK,CAAC,sBAAsB,EAAErB,IAAI,CAAC;gBAC1C;gBACA;gBACA,IAAMqC,cAAc,GAAGvC,KAAI,CAACsB,OAAO,CAACiB,cAAc,CAAC,CAAC;gBAEpDrC,IAAI,CAACkO,UAAU,CACd,UAAC/H,GAAG,EAAEmF,MAAM;kBACX,IAAInF,GAAG,EAAE;oBACRrH,MAAM,CAACuC,KAAK,CAAC,gCAAgC,EAAE8E,GAAG,CAAC;oBACnD,OAAOwD,GAAG,CAACxD,GAAG,CAAC;;kBAEhBnG,IAAI,CAACyQ,aAAa,CAAC;oBAClB5I,SAAS,EAAE,SAAAA,UAAAtI,IAAI;sBACdT,MAAM,CAACuC,KAAK,CAAC,yBAAyB,CAAC;sBACvC,IAAIkP,kBAAkB,EAAE;wBACvBzQ,KAAI,CAAC4Q,oBAAoB,CAAChH,GAAG,EAAEC,GAAG,CAAC;uBACnC,MAAM;wBACN,OAAOD,GAAG,EAAE;;oBAEd,CAAC;oBACDjB,SAAS,EAAE,SAAAA,UAAAtC,GAAG;sBACbrH,MAAM,CAACuC,KAAK,CAAC,wBAAwB,EAAE8E,GAAG,CAAC;sBAC3C,OAAOwD,GAAG,CAACxD,GAAG,CAAC;oBAChB;mBACA,CAAC;gBACH,CAAC,EACD;kBAAE9D,cAAc,EAAAA;gBAAA,CAAE,CAClB;eACD,MAAM;gBACNvD,MAAM,CAACuC,KAAK,CAAC,eAAe,EAAErB,IAAI,CAAC;gBACnCA,IAAI,CAAC2Q,OAAO,CAAC;kBACZ,IAAIJ,kBAAkB,EAAE;oBACvBzQ,KAAI,CAAC4Q,oBAAoB,CAAChH,GAAG,EAAEC,GAAG,CAAC;mBACnC,MAAM;oBACN,OAAOD,GAAG,EAAE;;gBAEd,CAAC,CAAC;;YAEJ,CAAC,CAAC;QAAC;;;GACH;EAEO9J,SAAA,CAAAsB,SAAA,CAAAwP,oBAAoB,GAA5B,UACCzN,OAAmB,EACnBiD,MAA8B;IAEtB,IAAA0K,SAAA,GAAAtS,MAAA,CAAAuS,EAAA,CAAAC,aAAA,GAAAF,SAAS;IAEjB,IAAIA,SAAS,EAAE;MACd,IAAI,CAACG,4BAA4B,CAAC7K,MAAM,CAAC;KACzC,MAAM;MACN,IAAI,CAAC8K,sBAAsB,CAAC/N,OAAO,CAAC;;EAEtC,CAAC;EAEOrD,SAAA,CAAAsB,SAAA,CAAA8P,sBAAsB,GAA9B,UAA+B/N,OAAmB;IACjD,IAAI,CAACiB,aAAa,CAACyM,OAAO,EAAE;IAC5B1N,OAAO,EAAE;EACV,CAAC;EAEOrD,SAAA,CAAAsB,SAAA,CAAA6P,4BAA4B,GAApC,UAAqC7K,MAA8B;IAClE,IAAI,CAAChC,aAAa,CAACyM,OAAO,EAAE,CAAC,CAAC;IAE9B;IACA9C,UAAU,CAAC;MAAM,OAAA3H,MAAM,CAAC,sBAAsB,CAAC;IAA9B,CAA8B,EAAE,IAAI,CAAC;EACvD,CAAC;EAED;;;;;EAKatG,SAAA,CAAAsB,SAAA,CAAAyP,OAAO,GAApB,UAAqBN,IAAkB;;;;;;;YAErC,qBAAM,IAAI,CAACY,gBAAgB,EAAE;;YAA7BpQ,EAAA,CAAAoH,IAAA,EAA6B;;;;YAE7BnJ,MAAM,CAACuC,KAAK,CAAC,8BAA8B,CAAC;;;iBAGzC,IAAI,CAACtB,QAAQ,EAAb;YACGC,IAAI,GAAG,IAAI,CAACD,QAAQ,CAACkO,cAAc,EAAE;iBACvCjO,IAAI,EAAJ;YACH,qBAAM,IAAI,CAACoQ,sBAAsB,CAACC,IAAI,EAAErQ,IAAI,CAAC;;YAA7Ca,EAAA,CAAAoH,IAAA,EAA6C;;;YAE7CnJ,MAAM,CAACuC,KAAK,CAAC,yBAAyB,CAAC;;;;;YAGxCvC,MAAM,CAACuC,KAAK,CAAC,sBAAsB,CAAC;;;YAGrC;;;;;;YAMAhC,iBAAiB,CAAC,SAAS,EAAE,IAAI,CAACW,IAAI,EAAE,4BAA4B,CAAC;YACrE,IAAI,CAACA,IAAI,GAAG,IAAI;;;;;GAChB;;EAEaJ,SAAA,CAAAsB,SAAA,CAAA+P,gBAAgB,GAA9B;;;;;YACC;YACA,qBAAM,IAAI,CAAC/Q,WAAW,CAAC8H,KAAK,EAAE;;YAD9B;YACAnH,EAAA,CAAAoH,IAAA,EAA8B;;;;;GAC9B;EAED;;;;;;;EAOOrI,SAAA,CAAAsB,SAAA,CAAAgQ,cAAc,GAArB,UACClR,IAAuB,EACvBmR,WAAmB,EACnBC,WAAmB,EACnB/O,cAA4D;IAJ7D,IAAAvC,KAAA;IAIC,IAAAuC,cAAA;MAAAA,cAAA,GAAiC,IAAI,CAACjB,OAAO,CAACiB,cAAc;IAAA;IAE5D,OAAO,IAAIW,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClCpG,KAAI,CAAC+M,WAAW,CAAC7M,IAAI,CAAC,CAAC8M,IAAI,CAAC,UAAAhF,OAAO;QAClC9H,IAAI,CAACkR,cAAc,CAClBC,WAAW,EACXC,WAAW,EACX,UAACjL,GAAG,EAAE5G,IAAI;UACT,IAAI4G,GAAG,EAAE;YACRrH,MAAM,CAACuC,KAAK,CAAC,yBAAyB,EAAE8E,GAAG,CAAC;YAC5C,OAAOD,MAAM,CAACC,GAAG,CAAC;WAClB,MAAM;YACN,OAAOlD,OAAO,CAAC1D,IAAI,CAAC;;QAEtB,CAAC,EACD8C,cAAc,CACd;MACF,CAAC,CAAC;IACH,CAAC,CAAC;EACH,CAAC;EAED;;;;;EAKOzC,SAAA,CAAAsB,SAAA,CAAAmQ,cAAc,GAArB,UACCvM,QAAgB,EAChBzC,cAA4D;IAA5D,IAAAA,cAAA;MAAAA,cAAA,GAAiC,IAAI,CAACjB,OAAO,CAACiB,cAAc;IAAA;IAE5D,IAAI,CAAC,IAAI,CAACtC,QAAQ,EAAE;MACnB,OAAO,IAAI,CAAC8E,gBAAgB,EAAE;;IAE/B,IAAI,CAACC,QAAQ,EAAE;MACd,OAAO,IAAI,CAACe,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACE,aAAa,CAAC;;IAG1D,IAAMhG,IAAI,GAAG,IAAI,CAACwG,iBAAiB,CAAC1B,QAAQ,CAAC;IAC7C,OAAO,IAAI9B,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClClG,IAAI,CAACqR,cAAc,CAClB;QACCxJ,SAAS,EAAE,SAAAA,UAAA;UACV5E,OAAO,EAAE;UACT;QACD,CAAC;QACDwF,SAAS,EAAE,SAAAA,UAAAtC,GAAG;UACbrH,MAAM,CAACuC,KAAK,CAAC,yBAAyB,EAAE8E,GAAG,CAAC;UAC5C9G,iBAAiB,CAChB,wBAAwB,EACxB8G,GAAG,EACArB,QAAQ,2BAAwB,CACnC;UACDoB,MAAM,CAACC,GAAG,CAAC;UACX;QACD,CAAC;QACDmL,qBAAqB,EAAE,SAAAA,sBAAA/R,IAAI;UAC1BF,iBAAiB,CAChB,gBAAgB,EAChBW,IAAI,EACD8E,QAAQ,wCAAqC,CAChD;UACD7B,OAAO,CAAC1D,IAAI,CAAC;UACb;QACD;OACA,EACD8C,cAAc,CACd;IACF,CAAC,CAAC;EACH,CAAC;EAED;;;;;;;EAOOzC,SAAA,CAAAsB,SAAA,CAAAqQ,oBAAoB,GAA3B,UACCzM,QAAgB,EAChBuB,IAAY,EACZtB,QAAgB,EAChB1C,cAA4D;IAA5D,IAAAA,cAAA;MAAAA,cAAA,GAAiC,IAAI,CAACjB,OAAO,CAACiB,cAAc;IAAA;IAE5D,IAAI,CAAC,IAAI,CAACtC,QAAQ,EAAE;MACnB,OAAO,IAAI,CAAC8E,gBAAgB,EAAE;;IAE/B,IAAI,CAACC,QAAQ,EAAE;MACd,OAAO,IAAI,CAACe,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACE,aAAa,CAAC;;IAE1D,IAAI,CAACK,IAAI,EAAE;MACV,OAAO,IAAI,CAACR,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACS,SAAS,CAAC;;IAEtD,IAAI,CAACxB,QAAQ,EAAE;MACd,OAAO,IAAI,CAACc,eAAe,CAAChH,MAAA,CAAAiH,cAAc,CAACG,aAAa,CAAC;;IAG1D,IAAMjG,IAAI,GAAG,IAAI,CAACwG,iBAAiB,CAAC1B,QAAQ,CAAC;IAC7C,OAAO,IAAI9B,OAAO,CAAC,UAACC,OAAO,EAAEiD,MAAM;MAClClG,IAAI,CAACwR,eAAe,CACnBnL,IAAI,EACJtB,QAAQ,EACR;QACC8C,SAAS,EAAE,SAAAA,UAACkI,OAAO;UAClB1Q,iBAAiB,CAChB,sBAAsB,EACtBW,IAAI,EACD8E,QAAQ,qCAAkC,CAC7C;UACD7B,OAAO,CAAC8M,OAAO,CAAC;UAChB;QACD,CAAC;QACDtH,SAAS,EAAE,SAAAA,UAAAtC,GAAG;UACb9G,iBAAiB,CAChB,8BAA8B,EAC9B8G,GAAG,EACArB,QAAQ,iCAA8B,CACzC;UACDoB,MAAM,CAACC,GAAG,CAAC;UACX;QACD;OACA,EACD9D,cAAc,CACd;IACF,CAAC,CAAC;EACH,CAAC;EAED;;;;;EAKazC,SAAA,CAAAsB,SAAA,CAAAuQ,eAAe,GAA5B;;;;;;YACOC,MAAM,GAAG,IAAI,CAACxR,WAAW,CAACyR,aAAa,EAAE;kBAE3C,CAACD,MAAM,IAAIA,MAAM,KAAK,KAAK,IAAIA,MAAM,KAAK,UAAU,GAApD;YACU,qBAAM,IAAI,CAACrJ,mBAAmB,EAAE,CAACuG,KAAK,CAAC,UAAAzI,GAAG;cACtD,OAAArH,MAAM,CAACwB,KAAK,CAAC6F,GAAG,CAAC;YAAjB,CAAiB,CACjB;;YAFKnG,IAAI,GAAGa,EAAA,CAAAoH,IAAA,EAEZ;YACD,IAAI,CAACjI,IAAI,EAAE;cACV,sBAAO,IAAI;;;;;YAIQ,qBAAM,IAAI,CAACgJ,cAAc,CAAChJ,IAAI,CAAC;;YAA5CgF,UAAU,GAAGnE,EAAA,CAAAoH,IAAA,EAA+B;YAC5C2J,SAAS,GAAW,IAAI,CAACpE,kBAAkB,CAACxI,UAAU,CAAC;YACzD6M,WAAW,GAAG,IAAI;;;;YAEP,qBAAM,IAAI,CAACpR,kBAAkB,EAAE;;YAA7CoR,WAAW,GAAGhR,EAAA,CAAAoH,IAAA,EAA+B;;;;YAE7CnJ,MAAM,CAACuC,KAAK,CACX,gEAAgE,EAChEyQ,IAAC,CACD;;;YAGIC,IAAI,GAAG;cACZC,EAAE,EAAEH,WAAW,GAAGA,WAAW,CAACI,UAAU,GAAG1R,SAAS;cACpDuE,QAAQ,EAAE9E,IAAI,CAACuI,WAAW,EAAE;cAC5BvD,UAAU,EAAE4M;aACZ;YACD,sBAAOG,IAAI;;;YAEXjT,MAAM,CAACwB,KAAK,CAAC,uBAAuB,EAAE4R,KAAG,CAAC;YAC1C,sBAAO,EAAE;;YAIX,IAAIR,MAAM,KAAK,WAAW,EAAE;cACrB1R,IAAI,GAAG,IAAI,CAACA,IAAI;cACtB,sBAAOA,IAAI,GAAGA,IAAI,GAAG,EAAE;;;;;;GAExB;;EAaYJ,SAAA,CAAAsB,SAAA,CAAAiR,eAAe,GAA5B,UACCC,iBAG+B,EAC/BC,QAA4B,EAC5BrS,IAAoB;;;;;;YAEpB,IAAI,CAAC,IAAI,CAACoB,OAAO,CAACa,cAAc,IAAI,CAAC,IAAI,CAACb,OAAO,CAACQ,UAAU,EAAE;cAC7D,MAAM,IAAIkB,KAAK,CACd,mEAAmE,CACnE;;YAGF;YACA,IAAI,OAAOsP,iBAAiB,KAAK,WAAW,EAAE;cAC7C,IAAI,IAAI,CAAChR,OAAO,CAACa,cAAc,IAAI,CAAC,IAAI,CAACb,OAAO,CAACQ,UAAU,EAAE;gBAC5D,MAAM,IAAIkB,KAAK,CACd,oEAAoE,CACpE;;;kBAKF1E,OAAA,CAAAkU,wBAAwB,CAACF,iBAAiB,CAAC,IAC3ChU,OAAA,CAAAmU,8BAA8B,CAACH,iBAAiB,CAAC,IACjDhU,OAAA,CAAAoU,cAAc,CAACJ,iBAAiB,CAAC,IACjC,OAAOA,iBAAiB,KAAK,WAAW,GAHxC;YAKM9L,OAAO,GAAG8L,iBAAiB,IAAI;cACpCK,QAAQ,EAAE5T,MAAA,CAAA6T,+BAA+B,CAACC;aAC1C;YACKF,QAAQ,GAAGrU,OAAA,CAAAkU,wBAAwB,CAAChM,OAAO,CAAC,GAC/CA,OAAO,CAACmM,QAAQ,GACfnM,OAAwC,CAACsM,cAAc;YAErDC,WAAW,GAAGzU,OAAA,CAAAkU,wBAAwB,CAAChM,OAAO,CAAC,GAClDA,OAAO,CAACuM,WAAW,GAClBvM,OAAwC,CAACuM,WAAW;YAExD,IAAI,IAAI,CAACzR,OAAO,CAACQ,UAAU,EAAE;cACtBkR,SAAS,GAAG1U,OAAA,CAAAoF,mBAAmB,CAAC,IAAI,CAACpC,OAAO,CAACW,KAAK,CAAC,GACtD,IAAI,CAACX,OAAO,CAACS,mBAAmB,GAChC,IAAI,CAACT,OAAO,CAACW,KAAK,CAACgR,QAAQ;cAExBC,YAAY,GAAG5U,OAAA,CAAAoF,mBAAmB,CAAC,IAAI,CAACpC,OAAO,CAACW,KAAK,CAAC,GACzD,IAAI,CAACX,OAAO,CAACW,KAAK,CAAC+B,cAAc,GACjC,IAAI,CAAC1C,OAAO,CAACW,KAAK,CAACkR,WAAW;cAEjC,IAAI,CAAC/O,aAAa,CAACgP,WAAW,CAC7B,IAAI,CAAC9R,OAAO,CAACW,KAAK,CAACiC,YAAY,EAC/B,IAAI,CAAC5C,OAAO,CAACW,KAAK,CAAC6B,MAAM,EACzBoP,YAAY,EACZF,SAAS,EACTL,QAAQ,EACRI,WAAW,CACX;;;;YAGIJ,QAAQ,GAAGL,iBAAiB;YAClC;YACA,IAAI;cACGe,YAAY,GAAGjE,IAAI,CAACkE,SAAS,CAClClE,IAAI,CAACC,KAAK,CAAC,IAAI,CAACpO,QAAQ,CAACqO,OAAO,CAAC,2BAA2B,CAAC,CAAC,CAACpP,IAAI,CACnE;cACD,IAAImT,YAAY,EAAE;gBACjBrU,MAAM,CAACmI,IAAI,CAAC,wCAAsCkM,YAAY,gJACyC,CAAC;;aAEzG,CAAC,OAAOtE,CAAC,EAAE;YAEJS,KAAK,GAA8B+C,QAAQ,CAAA/C,KAAtC,EAAE+D,WAAW,GAAiBhB,QAAQ,CAAAgB,WAAzB,EAAEC,UAAU,GAAKjB,QAAQ,CAAAiB,UAAb;YAGlB,qBAAM,IAAI,CAACpT,WAAW,CAACgI,GAAG,CAC7C;cAAEuK,QAAQ,EAAAA,QAAA;cAAEnD,KAAK,EAAAA,KAAA;cAAE+D,WAAW,EAAAA,WAAA;cAAErT,IAAI,EAAAA,IAAA;cAAEsT,UAAU,EAAAA;YAAA,CAAE,EAClD,YAAY,CACZ;;YAHKzB,WAAW,GAAGhR,EAAA,CAAAoH,IAAA,EAGnB;YACmB,qBAAM,IAAI,CAAC6G,wBAAwB,EAAE;;YAAnDxG,WAAW,GAAGzH,EAAA,CAAAoH,IAAA,EAAqC;YACzD5I,iBAAiB,CAChB,QAAQ,EACRiJ,WAAW,EACX,YAAUA,WAAW,CAACxD,QAAQ,wBAAqB,CACnD;YACDhG,MAAM,CAACuC,KAAK,CAAC,+BAA+B,EAAEwQ,WAAW,CAAC;YAC1D,sBAAOA,WAAW;;;;;;GAEnB;EAED;;;;EAIcjS,SAAA,CAAAsB,SAAA,CAAAoD,mBAAmB,GAAjC,UAAkCiP,GAAY;;;;;;YAC7C,IAAI,IAAI,CAACtT,mBAAmB,EAAE;cAC7BnB,MAAM,CAACuC,KAAK,CAAC,kBAAgBkS,GAAG,8BAA2B,CAAC;cAC5D;;;;;;YAIA,IAAI,CAACtT,mBAAmB,GAAG,IAAI;YAC/B,IAAI,CAAC,IAAI,CAACmB,OAAO,CAACQ,UAAU,EAAE;cAC7B,MAAM,IAAIkB,KAAK,CACd,uDAAuD,CACvD;;YAGFzD,iBAAiB,CAChB,oBAAoB,EACpB;cAAEgF,GAAG,EAAEkP;YAAG,CAAE,EACZ,kCAAkC,CAClC;YAEKC,UAAU,GACfD,GAAG,KAAKjV,MAAA,CAAAuS,EAAE,CAACC,aAAa,EAAE,CAACF,SAAS,GAAG6C,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,EAAE,CAAC;YAE5DC,cAAc,GAAG,CAAC,CAAC,CAACpV,KAAA,CAAA2Q,KAAK,CAACqE,UAAU,CAAC,CAACK,KAAK,IAAI,EAAE,EACrDvF,KAAK,CAAC,GAAG,CAAC,CACV5I,GAAG,CAAC,UAAAoO,KAAK;cAAI,OAAAA,KAAK,CAACxF,KAAK,CAAC,GAAG,CAAC;YAAhB,CAAgB,CAAC,CAC9ByF,IAAI,CAAC,UAAClT,EAAG;kBAAH+J,EAAA,GAAAoJ,MAAA,CAAAnT,EAAA,IAAG;gBAAFoT,CAAA,GAAArJ,EAAA,GAAC;cAAM,OAAAqJ,CAAC,KAAK,MAAM,IAAIA,CAAC,KAAK,OAAO;YAA7B,CAA6B,CAAC;YAExCC,eAAe,GAAG,CAAC,CAAC,CAAC1V,KAAA,CAAA2Q,KAAK,CAACqE,UAAU,CAAC,CAACW,IAAI,IAAI,GAAG,EACtDC,MAAM,CAAC,CAAC,CAAC,CACT9F,KAAK,CAAC,GAAG,CAAC,CACV5I,GAAG,CAAC,UAAAoO,KAAK;cAAI,OAAAA,KAAK,CAACxF,KAAK,CAAC,GAAG,CAAC;YAAhB,CAAgB,CAAC,CAC9ByF,IAAI,CAAC,UAAClT,EAAG;kBAAH+J,EAAA,GAAAoJ,MAAA,CAAAnT,EAAA,IAAG;gBAAFoT,CAAA,GAAArJ,EAAA,GAAC;cAAM,OAAAqJ,CAAC,KAAK,cAAc,IAAIA,CAAC,KAAK,OAAO;YAArC,CAAqC,CAAC;kBAElDL,cAAc,IAAIM,eAAe,GAAjC;YACH,IAAI,CAACnT,QAAQ,CAACC,OAAO,CAAC,mCAAmC,EAAE,MAAM,CAAC;;;;YAO7D,qBAAM,IAAI,CAACkD,aAAa,CAACmQ,kBAAkB,CAACb,UAAU,CAAC;;YALrD3S,EAAA,GAKF+J,EAAA,CAAA3C,IAAA,EAAuD,EAJ1DqM,WAAW,GAAAzT,EAAA,CAAAyT,WAAA,EACXC,OAAO,GAAA1T,EAAA,CAAA0T,OAAA,EACPC,YAAY,GAAA3T,EAAA,CAAA2T,YAAA,EACZC,KAAK,GAAA5T,EAAA,CAAA4T,KAAA;YAEA3M,OAAO,GAAG,IAAIvJ,4BAAA,CAAAmW,kBAAkB,CAAC;cACtCC,OAAO,EAAE,IAAIpW,4BAAA,CAAAqW,cAAc,CAAC;gBAAED,OAAO,EAAEJ;cAAO,CAAE,CAAC;cACjDM,YAAY,EAAE,IAAItW,4BAAA,CAAAuW,mBAAmB,CAAC;gBACrCD,YAAY,EAAEL;eACd,CAAC;cACFO,WAAW,EAAE,IAAIxW,4BAAA,CAAAyW,kBAAkB,CAAC;gBACnCD,WAAW,EAAET;eACb;aACD,CAAC;YAEEzC,WAAW;iBAEX,IAAI,CAACzQ,OAAO,CAACa,cAAc,EAA3B;YACW,qBAAM,IAAI,CAAC/B,WAAW,CAACgI,GAAG,CAACJ,OAAO,EAAE,SAAS,CAAC;;YAA5D+J,WAAW,GAAGjH,EAAA,CAAA3C,IAAA,EAA8C;YAC5DnJ,MAAM,CAACuC,KAAK,CAAC,iBAAiB,EAAEwQ,WAAW,CAAC;;;YAQvCoD,qBAAqB,GAAG,GAAG,CAACC,IAAI,CAACT,KAAK,CAAC;YAOvCnM,WAAW,GAAG,IAAI,CAAC9B,iBAAiB,CACzCsB,OAAO,CAACqN,UAAU,EAAE,CAAC/G,aAAa,EAAE,CAAC,kBAAkB,CAAC,CACxD;YAED;YACA9F,WAAW,CAAC8M,oBAAoB,CAACtN,OAAO,CAAC;YAEzC,IAAI2L,MAAM,IAAI,OAAOA,MAAM,CAAC4B,OAAO,KAAK,WAAW,EAAE;cACpD5B,MAAM,CAAC4B,OAAO,CAACC,YAAY,CAC1B,EAAE,EACF,IAAI,EACH,IAAI,CAAClU,OAAO,CAACW,KAA6B,CAAC+B,cAAc,CAC1D;;YAGFzE,iBAAiB,CAChB,QAAQ,EACRiJ,WAAW,EACX,YAAUA,WAAW,CAACC,WAAW,EAAE,wBAAqB,CACxD;YACDlJ,iBAAiB,CAChB,iBAAiB,EACjBiJ,WAAW,EACX,YAAUA,WAAW,CAACC,WAAW,EAAE,8CAA2C,CAC9E;YAED,IAAI0M,qBAAqB,EAAE;cACpBpC,WAAW,GAAG4B,KAAK,CACvBnG,KAAK,CAAC,GAAG,CAAC,CACViH,MAAM,CAAC,CAAC,CAAC,CACTC,IAAI,CAAC,GAAG,CAAC;cAEXnW,iBAAiB,CAChB,kBAAkB,EAClBf,MAAA,CAAAmX,aAAa,CAAC5C,WAAW,CAAC,EAC1B,oBAAkBvK,WAAW,CAACC,WAAW,EAAI,CAC7C;;YAEF;YAEA,sBAAOsJ,WAAW;;;YAElB/S,MAAM,CAACuC,KAAK,CAAC,uCAAuC,EAAEqU,KAAG,CAAC;YAE1D;YACA;YACA,IAAIjC,MAAM,IAAI,OAAOA,MAAM,CAAC4B,OAAO,KAAK,WAAW,EAAE;cACpD5B,MAAM,CAAC4B,OAAO,CAACC,YAAY,CAC1B,EAAE,EACF,IAAI,EACH,IAAI,CAAClU,OAAO,CAACW,KAA6B,CAAC+B,cAAc,CAC1D;;YAGFzE,iBAAiB,CAChB,gBAAgB,EAChBqW,KAAG,EACH,gCAAgC,CAChC;YACDrW,iBAAiB,CAChB,yBAAyB,EACzBqW,KAAG,EACH,4DAA4D,CAC5D;YACDrW,iBAAiB,CAChB,qBAAqB,EACrBqW,KAAG,EACH,yCAAyC,CACzC;;;;;YAIH,IAAI,CAACzV,mBAAmB,GAAG,KAAK;;;;;;;GAEjC;EAED;;;;;EAKOL,SAAA,CAAAsB,SAAA,CAAAyU,oBAAoB,GAA3B,UAA4B9D,WAAW;IACtC,OAAO;MACN+D,WAAW,EAAE/D,WAAW,CAAC+D,WAAW;MACpCC,YAAY,EAAEhE,WAAW,CAACgE,YAAY;MACtCC,eAAe,EAAEjE,WAAW,CAACiE,eAAe;MAC5C7D,UAAU,EAAEJ,WAAW,CAACI,UAAU;MAClC8D,aAAa,EAAElE,WAAW,CAACkE;KAC3B;EACF,CAAC;EAEOnW,SAAA,CAAAsB,SAAA,CAAAsM,kBAAkB,GAA1B,UAA2BxI,UAAU;IAArC,IAAAlF,KAAA;IACC,IAAMkW,GAAG,GAAG,EAAE;IACd,IAAIhR,UAAU,EAAE;MACfA,UAAU,CAACU,GAAG,CAAC,UAAAgJ,SAAS;QACvB,IACCA,SAAS,CAACpJ,IAAI,KAAK,gBAAgB,IACnCoJ,SAAS,CAACpJ,IAAI,KAAK,uBAAuB,EACzC;UACD0Q,GAAG,CAACtH,SAAS,CAACpJ,IAAI,CAAC,GAClBxF,KAAI,CAACmW,cAAc,CAACvH,SAAS,CAACnJ,KAAK,CAAC,IAAImJ,SAAS,CAACnJ,KAAK,KAAK,IAAI;SACjE,MAAM;UACNyQ,GAAG,CAACtH,SAAS,CAACpJ,IAAI,CAAC,GAAGoJ,SAAS,CAACnJ,KAAK;;MAEvC,CAAC,CAAC;;IAEH,OAAOyQ,GAAG;EACX,CAAC;EAEOpW,SAAA,CAAAsB,SAAA,CAAA+U,cAAc,GAAtB,UAAuB3M,KAAU;IAChC,OACC,OAAOA,KAAK,CAAC4M,WAAW,KAAK,UAAU,IAAI5M,KAAK,CAAC4M,WAAW,EAAE,KAAK,MAAM;EAE3E,CAAC;EAEOtW,SAAA,CAAAsB,SAAA,CAAAsF,iBAAiB,GAAzB,UAA0B1B,QAAgB;IACzC,IAAM6F,QAAQ,GAAqB;MAClCtD,QAAQ,EAAEvC,QAAQ;MAClBqR,IAAI,EAAE,IAAI,CAACpW;KACX;IACD4K,QAAQ,CAACtH,OAAO,GAAG,IAAI,CAACtC,QAAQ;IAExB,IAAAqV,sBAAA,QAAAhV,OAAA,CAAAgV,sBAAsB;IAE9B,IAAMpW,IAAI,GAAG,IAAIzB,4BAAA,CAAA8X,WAAW,CAAC1L,QAAQ,CAAC;IACtC,IAAIyL,sBAAsB,EAAE;MAC3BpW,IAAI,CAACuJ,yBAAyB,CAAC6M,sBAAsB,CAAC;;IAEvD,OAAOpW,IAAI;EACZ,CAAC;EAEOJ,SAAA,CAAAsB,SAAA,CAAA2B,mBAAmB,GAA3B,UAA4BmT,GAAG;IAC9B;IACA,OACC,CAAC,CAACA,GAAG,IACL,OAAOA,GAAG,CAAC5G,OAAO,KAAK,UAAU,IACjC,OAAO4G,GAAG,CAAChV,OAAO,KAAK,UAAU,IACjC,OAAOgV,GAAG,CAAC/U,UAAU,KAAK,UAAU,IACpC,OAAO+U,GAAG,CAAChO,KAAK,KAAK,UAAU;EAEjC,CAAC;EAEOpI,SAAA,CAAAsB,SAAA,CAAAoV,sBAAsB,GAA9B,UAA+BzW,MAAmB;IACjD,IAAIA,MAAM,EAAE;MACX,IAAI,CAACA,MAAM,CAAC+B,UAAU,IAAI,CAAC/B,MAAM,CAACoC,cAAc,EAAE;QACjD,OAAOpD,MAAA,CAAAiH,cAAc,CAACyQ,iBAAiB;;;IAGzC,OAAO1X,MAAA,CAAAiH,cAAc,CAAC0Q,QAAQ;EAC/B,CAAC;EAEO5W,SAAA,CAAAsB,SAAA,CAAA2E,eAAe,GAAvB,UAAwB4Q,IAAoB;IAC3C,OAAOzT,OAAO,CAACkD,MAAM,CAAC,IAAItH,QAAA,CAAA8X,SAAS,CAACD,IAAI,CAAC,CAAC;EAC3C,CAAC;EAEO7W,SAAA,CAAAsB,SAAA,CAAA2D,gBAAgB,GAAxB;IACC,IAAM4R,IAAI,GAAG,IAAI,CAACH,sBAAsB,CAAC,IAAI,CAAClV,OAAO,CAAC;IACtD,OAAO4B,OAAO,CAACkD,MAAM,CAAC,IAAItH,QAAA,CAAA+X,eAAe,CAACF,IAAI,CAAC,CAAC;EACjD,CAAC;EAEY7W,SAAA,CAAAsB,SAAA,CAAA0V,cAAc,GAA3B;;;;;;;YAIa,qBAAM,IAAI,CAACvO,mBAAmB,EAAE;;YAA3CwO,QAAQ,GAAGhW,EAAA,CAAAoH,IAAA,EAAgC;;;;YAE3CnJ,MAAM,CAACuC,KAAK,CAAC,4CAA4C,EAAEyV,OAAK,CAAC;YACjE,sBAAO9T,OAAO,CAACkD,MAAM,CAAC,+BAA+B,CAAC;;YAGvD2Q,QAAQ,CAACE,6BAA6B,EAAE;YACxC,sBAAO,IAAI/T,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;cAC3BkN,QAAQ,CAACG,yBAAyB,CAAC;gBAClCnP,SAAS,EAAE,SAAAA,UAAAtI,IAAI;kBACdmK,GAAG,CAACnK,IAAI,CAAC;gBACV,CAAC;gBACDkJ,SAAS,EAAE,SAAAA,UAAAtC,GAAG;kBACb,IAAIA,GAAG,CAACE,IAAI,KAAK,2BAA2B,EAAE;oBAC7CsD,GAAG,CAAC,IAAI/K,QAAA,CAAA8X,SAAS,CAAC7X,MAAA,CAAAiH,cAAc,CAACmR,YAAY,CAAC,CAAC;mBAC/C,MAAM,IAAI9Q,GAAG,CAACE,IAAI,KAAK,cAAc,EAAE;oBACvCsD,GAAG,CAAC,IAAI/K,QAAA,CAAA8X,SAAS,CAAC7X,MAAA,CAAAiH,cAAc,CAACoR,YAAY,CAAC,CAAC;mBAC/C,MAAM;oBACNvN,GAAG,CAACxD,GAAG,CAAC;;gBAEV;eACA,CAAC;YACH,CAAC,CAAC;QAAC;;;GACH;EAEYvG,SAAA,CAAAsB,SAAA,CAAAiW,YAAY,GAAzB;;;;;;;YAIa,qBAAM,IAAI,CAAC9O,mBAAmB,EAAE;;YAA3CwO,QAAQ,GAAGhW,EAAA,CAAAoH,IAAA,EAAgC;;;;YAE3CnJ,MAAM,CAACuC,KAAK,CAAC,4CAA4C,EAAE+V,OAAK,CAAC;YACjE,sBAAOpU,OAAO,CAACkD,MAAM,CAAC,+BAA+B,CAAC;;YAGvD2Q,QAAQ,CAACE,6BAA6B,EAAE;YACxC,sBAAO,IAAI/T,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;cAC3BkN,QAAQ,CAACM,YAAY,CAAC;gBACrBtP,SAAS,EAAE,SAAAA,UAAAtI,IAAI;kBACdmK,GAAG,CAACnK,IAAI,CAAC;gBACV,CAAC;gBACDkJ,SAAS,EAAE,SAAAA,UAAAtC,GAAG;kBACb,IAAIA,GAAG,CAACE,IAAI,KAAK,2BAA2B,EAAE;oBAC7CsD,GAAG,CAAC,IAAI/K,QAAA,CAAA8X,SAAS,CAAC7X,MAAA,CAAAiH,cAAc,CAACmR,YAAY,CAAC,CAAC;mBAC/C,MAAM,IAAI9Q,GAAG,CAACE,IAAI,KAAK,cAAc,EAAE;oBACvCsD,GAAG,CAAC,IAAI/K,QAAA,CAAA8X,SAAS,CAAC7X,MAAA,CAAAiH,cAAc,CAACoR,YAAY,CAAC,CAAC;mBAC/C,MAAM;oBACNvN,GAAG,CAACxD,GAAG,CAAC;;gBAEV;eACA,CAAC;YACH,CAAC,CAAC;QAAC;;;GACH;EAEYvG,SAAA,CAAAsB,SAAA,CAAAmW,YAAY,GAAzB;;;;;;;YAIa,qBAAM,IAAI,CAAChP,mBAAmB,EAAE;;YAA3CwO,QAAQ,GAAGhW,EAAA,CAAAoH,IAAA,EAAgC;;;;YAE3CnJ,MAAM,CAACuC,KAAK,CAAC,4CAA4C,EAAEiW,OAAK,CAAC;YACjE,MAAM,IAAIxU,KAAK,CAAC,+BAA+B,CAAC;;YAGjD+T,QAAQ,CAACE,6BAA6B,EAAE;YACxC,sBAAO,IAAI/T,OAAO,CAAC,UAAC0G,GAAG,EAAEC,GAAG;cAC3B,IAAM4N,EAAE,GAAG;gBACV1P,SAAS,EAAT,SAAAA,UAAUtI,IAAI;kBACb,IAAMiY,UAAU,GAAkBjY,IAAI,CAACkY,OAAO,CAAC/R,GAAG,CAAC,UAAAgS,MAAM;oBACxD,IAAMC,UAAU,GACfD,MAAM,CAACE,gBAAgB,CAAC7D,IAAI,CAC3B,UAAClT,EAAQ;0BAANyE,IAAA,GAAAzE,EAAA,CAAAyE,IAAI;sBAAO,OAAAA,IAAI,KAAK,aAAa;oBAAtB,CAAsB,CACpC,IAAI,EAAE;oBAER,IAAMuS,UAAU,GAAgB;sBAC/B7F,EAAE,EAAE0F,MAAM,CAACI,SAAS;sBACpBC,IAAI,EAAEJ,UAAU,CAACpS;qBACjB;oBACD,OAAOsS,UAAU;kBAClB,CAAC,CAAC;kBACFnO,GAAG,CAAC8N,UAAU,CAAC;gBAChB,CAAC;gBACD/O,SAAS,EAAE,SAAAA,UAAAtC,GAAG;kBACb,IAAIA,GAAG,CAACE,IAAI,KAAK,2BAA2B,EAAE;oBAC7CsD,GAAG,CAAC,IAAI/K,QAAA,CAAA8X,SAAS,CAAC7X,MAAA,CAAAiH,cAAc,CAACmR,YAAY,CAAC,CAAC;mBAC/C,MAAM,IAAI9Q,GAAG,CAACE,IAAI,KAAK,cAAc,EAAE;oBACvCsD,GAAG,CAAC,IAAI/K,QAAA,CAAA8X,SAAS,CAAC7X,MAAA,CAAAiH,cAAc,CAACoR,YAAY,CAAC,CAAC;mBAC/C,MAAM;oBACNvN,GAAG,CAACxD,GAAG,CAAC;;gBAEV;eACA;cACD0Q,QAAQ,CAACmB,WAAW,CAACrY,WAAW,EAAE,IAAI,EAAE4X,EAAE,CAAC;YAC5C,CAAC,CAAC;QAAC;;;GACH;EACF,OAAA3X,SAAC;AAAD,CAAC,EA1sED;AAAaqY,OAAA,CAAArY,SAAA,GAAAA,SAAA;AA4sEAqY,OAAA,CAAAtW,IAAI,GAAG,IAAI/B,SAAS,CAAC,IAAI,CAAC;AAEvCtB,MAAA,CAAA4Z,OAAO,CAACC,QAAQ,CAACF,OAAA,CAAAtW,IAAI,CAAC"},"metadata":{},"sourceType":"script"}