{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function sent() {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) {\n      try {\n        if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [op[0] & 2, t.value];\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n          case 7:\n            op = _.ops.pop();\n            _.trys.pop();\n            continue;\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n              _.ops.push(op);\n              break;\n            }\n            if (t[2]) _.ops.pop();\n            _.trys.pop();\n            continue;\n        }\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n    m = s && o[s],\n    i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function next() {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n  return ar;\n};\nimport { Amplify, ConsoleLogger as Logger, Hub, JS } from '@aws-amplify/core';\nimport { immerable, produce, setAutoFreeze, enablePatches } from 'immer';\nimport { v4 as uuid4 } from 'uuid';\nimport Observable from 'zen-observable-ts';\nimport { defaultAuthStrategy, multiAuthStrategy } from '../authModeStrategies';\nimport { isPredicatesAll, ModelPredicateCreator, ModelSortPredicateCreator } from '../predicates';\nimport { ExclusiveStorage as Storage } from '../storage/storage';\nimport { ControlMessage, SyncEngine } from '../sync';\nimport { GraphQLScalarType, isGraphQLScalarType, AuthModeStrategyType, isNonModelFieldType, isModelFieldType } from '../types';\nimport { DATASTORE, establishRelationAndKeys, exhaustiveCheck, isModelConstructor, monotonicUlidFactory, STORAGE, SYNC, USER, isNullOrUndefined, registerNonModelClass, sortCompareFunction, DeferredCallbackResolver } from '../util';\nsetAutoFreeze(true);\nenablePatches();\nvar logger = new Logger('DataStore');\nvar ulid = monotonicUlidFactory(Date.now());\nvar isNode = JS.browserOrNode().isNode;\nvar SETTING_SCHEMA_VERSION = 'schemaVersion';\nvar schema;\nvar modelNamespaceMap = new WeakMap();\n// stores data for crafting the correct update mutation input for a model\n// Patch[] - array of changed fields and metadata\n// PersistentModel - the source model, used for diffing object-type fields\nvar modelPatchesMap = new WeakMap();\nvar getModelDefinition = function getModelDefinition(modelConstructor) {\n  var namespace = modelNamespaceMap.get(modelConstructor);\n  return schema.namespaces[namespace].models[modelConstructor.name];\n};\nvar isValidModelConstructor = function isValidModelConstructor(obj) {\n  return isModelConstructor(obj) && modelNamespaceMap.has(obj);\n};\nvar namespaceResolver = function namespaceResolver(modelConstructor) {\n  return modelNamespaceMap.get(modelConstructor);\n};\n// exporting syncClasses for testing outbox.test.ts\nexport var syncClasses;\nvar userClasses;\nvar dataStoreClasses;\nvar storageClasses;\nvar initSchema = function initSchema(userSchema) {\n  var _a;\n  if (schema !== undefined) {\n    console.warn('The schema has already been initialized');\n    return userClasses;\n  }\n  logger.log('validating schema', {\n    schema: userSchema\n  });\n  var internalUserNamespace = __assign({\n    name: USER\n  }, userSchema);\n  logger.log('DataStore', 'Init models');\n  userClasses = createTypeClasses(internalUserNamespace);\n  logger.log('DataStore', 'Models initialized');\n  var dataStoreNamespace = getNamespace();\n  var storageNamespace = Storage.getNamespace();\n  var syncNamespace = SyncEngine.getNamespace();\n  dataStoreClasses = createTypeClasses(dataStoreNamespace);\n  storageClasses = createTypeClasses(storageNamespace);\n  syncClasses = createTypeClasses(syncNamespace);\n  schema = {\n    namespaces: (_a = {}, _a[dataStoreNamespace.name] = dataStoreNamespace, _a[internalUserNamespace.name] = internalUserNamespace, _a[storageNamespace.name] = storageNamespace, _a[syncNamespace.name] = syncNamespace, _a),\n    version: userSchema.version\n  };\n  Object.keys(schema.namespaces).forEach(function (namespace) {\n    var e_1, _a;\n    var _b = __read(establishRelationAndKeys(schema.namespaces[namespace]), 2),\n      relations = _b[0],\n      keys = _b[1];\n    schema.namespaces[namespace].relationships = relations;\n    schema.namespaces[namespace].keys = keys;\n    var modelAssociations = new Map();\n    Object.values(schema.namespaces[namespace].models).forEach(function (model) {\n      var connectedModels = [];\n      Object.values(model.fields).filter(function (field) {\n        return field.association && field.association.connectionType === 'BELONGS_TO' && field.type.model !== model.name;\n      }).forEach(function (field) {\n        return connectedModels.push(field.type.model);\n      });\n      modelAssociations.set(model.name, connectedModels);\n    });\n    var result = new Map();\n    var count = 1000;\n    while (true && count > 0) {\n      if (modelAssociations.size === 0) {\n        break;\n      }\n      count--;\n      if (count === 0) {\n        throw new Error('Models are not topologically sortable. Please verify your schema.');\n      }\n      try {\n        for (var _c = (e_1 = void 0, __values(Array.from(modelAssociations.keys()))), _d = _c.next(); !_d.done; _d = _c.next()) {\n          var modelName = _d.value;\n          var parents = modelAssociations.get(modelName);\n          if (parents.every(function (x) {\n            return result.has(x);\n          })) {\n            result.set(modelName, parents);\n          }\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n      Array.from(result.keys()).forEach(function (x) {\n        return modelAssociations.delete(x);\n      });\n    }\n    schema.namespaces[namespace].modelTopologicalOrdering = result;\n  });\n  return userClasses;\n};\nvar createTypeClasses = function createTypeClasses(namespace) {\n  var classes = {};\n  Object.entries(namespace.models).forEach(function (_a) {\n    var _b = __read(_a, 2),\n      modelName = _b[0],\n      modelDefinition = _b[1];\n    var clazz = createModelClass(modelDefinition);\n    classes[modelName] = clazz;\n    modelNamespaceMap.set(clazz, namespace.name);\n  });\n  Object.entries(namespace.nonModels || {}).forEach(function (_a) {\n    var _b = __read(_a, 2),\n      typeName = _b[0],\n      typeDefinition = _b[1];\n    var clazz = createNonModelClass(typeDefinition);\n    classes[typeName] = clazz;\n  });\n  return classes;\n};\nvar instancesMetadata = new WeakSet();\nfunction modelInstanceCreator(modelConstructor, init) {\n  instancesMetadata.add(init);\n  return new modelConstructor(init);\n}\nvar validateModelFields = function validateModelFields(modelDefinition) {\n  return function (k, v) {\n    var fieldDefinition = modelDefinition.fields[k];\n    if (fieldDefinition !== undefined) {\n      var type = fieldDefinition.type,\n        isRequired_1 = fieldDefinition.isRequired,\n        isArrayNullable = fieldDefinition.isArrayNullable,\n        name_1 = fieldDefinition.name,\n        isArray = fieldDefinition.isArray;\n      if ((!isArray && isRequired_1 || isArray && !isArrayNullable) && (v === null || v === undefined)) {\n        throw new Error(\"Field \" + name_1 + \" is required\");\n      }\n      if (isGraphQLScalarType(type)) {\n        var jsType_1 = GraphQLScalarType.getJSType(type);\n        var validateScalar_1 = GraphQLScalarType.getValidationFunction(type);\n        if (type === 'AWSJSON') {\n          if (typeof v === jsType_1) {\n            return;\n          }\n          if (typeof v === 'string') {\n            try {\n              JSON.parse(v);\n              return;\n            } catch (error) {\n              throw new Error(\"Field \" + name_1 + \" is an invalid JSON object. \" + v);\n            }\n          }\n        }\n        if (isArray) {\n          var errorTypeText = jsType_1;\n          if (!isRequired_1) {\n            errorTypeText = jsType_1 + \" | null | undefined\";\n          }\n          if (!Array.isArray(v) && !isArrayNullable) {\n            throw new Error(\"Field \" + name_1 + \" should be of type [\" + errorTypeText + \"], \" + typeof v + \" received. \" + v);\n          }\n          if (!isNullOrUndefined(v) && v.some(function (e) {\n            return isNullOrUndefined(e) ? isRequired_1 : typeof e !== jsType_1;\n          })) {\n            var elemTypes = v.map(function (e) {\n              return e === null ? 'null' : typeof e;\n            }).join(',');\n            throw new Error(\"All elements in the \" + name_1 + \" array should be of type \" + errorTypeText + \", [\" + elemTypes + \"] received. \" + v);\n          }\n          if (validateScalar_1 && !isNullOrUndefined(v)) {\n            var validationStatus = v.map(function (e) {\n              if (!isNullOrUndefined(e)) {\n                return validateScalar_1(e);\n              } else if (isNullOrUndefined(e) && !isRequired_1) {\n                return true;\n              } else {\n                return false;\n              }\n            });\n            if (!validationStatus.every(function (s) {\n              return s;\n            })) {\n              throw new Error(\"All elements in the \" + name_1 + \" array should be of type \" + type + \", validation failed for one or more elements. \" + v);\n            }\n          }\n        } else if (!isRequired_1 && v === undefined) {\n          return;\n        } else if (typeof v !== jsType_1 && v !== null) {\n          throw new Error(\"Field \" + name_1 + \" should be of type \" + jsType_1 + \", \" + typeof v + \" received. \" + v);\n        } else if (!isNullOrUndefined(v) && validateScalar_1 && !validateScalar_1(v)) {\n          throw new Error(\"Field \" + name_1 + \" should be of type \" + type + \", validation failed. \" + v);\n        }\n      }\n    }\n  };\n};\nvar castInstanceType = function castInstanceType(modelDefinition, k, v) {\n  var _a = modelDefinition.fields[k] || {},\n    isArray = _a.isArray,\n    type = _a.type;\n  // attempt to parse stringified JSON\n  if (typeof v === 'string' && (isArray || type === 'AWSJSON' || isNonModelFieldType(type) || isModelFieldType(type))) {\n    try {\n      return JSON.parse(v);\n    } catch (_b) {\n      // if JSON is invalid, don't throw and let modelValidator handle it\n    }\n  }\n  // cast from numeric representation of boolean to JS boolean\n  if (typeof v === 'number' && type === 'Boolean') {\n    return Boolean(v);\n  }\n  return v;\n};\nvar initializeInstance = function initializeInstance(init, modelDefinition, draft) {\n  var modelValidator = validateModelFields(modelDefinition);\n  Object.entries(init).forEach(function (_a) {\n    var _b = __read(_a, 2),\n      k = _b[0],\n      v = _b[1];\n    var parsedValue = castInstanceType(modelDefinition, k, v);\n    modelValidator(k, parsedValue);\n    draft[k] = parsedValue;\n  });\n};\nvar createModelClass = function createModelClass(modelDefinition) {\n  var clazz = /** @class */function () {\n    function Model(init) {\n      var instance = produce(this, function (draft) {\n        initializeInstance(init, modelDefinition, draft);\n        var modelInstanceMetadata = instancesMetadata.has(init) ? init : {};\n        var _id = modelInstanceMetadata.id,\n          _version = modelInstanceMetadata._version,\n          _lastChangedAt = modelInstanceMetadata._lastChangedAt,\n          _deleted = modelInstanceMetadata._deleted;\n        // instancesIds are set by modelInstanceCreator, it is accessible only internally\n        var isInternal = _id !== null && _id !== undefined;\n        var id = isInternal ? _id : modelDefinition.syncable ? uuid4() : ulid();\n        if (!isInternal) {\n          checkReadOnlyPropertyOnCreate(draft, modelDefinition);\n        }\n        draft.id = id;\n        if (modelDefinition.syncable) {\n          draft._version = _version;\n          draft._lastChangedAt = _lastChangedAt;\n          draft._deleted = _deleted;\n        }\n      });\n      return instance;\n    }\n    Model.copyOf = function (source, fn) {\n      var modelConstructor = Object.getPrototypeOf(source || {}).constructor;\n      if (!isValidModelConstructor(modelConstructor)) {\n        var msg = 'The source object is not a valid model';\n        logger.error(msg, {\n          source: source\n        });\n        throw new Error(msg);\n      }\n      var patches;\n      var model = produce(source, function (draft) {\n        fn(draft);\n        draft.id = source.id;\n        var modelValidator = validateModelFields(modelDefinition);\n        Object.entries(draft).forEach(function (_a) {\n          var _b = __read(_a, 2),\n            k = _b[0],\n            v = _b[1];\n          var parsedValue = castInstanceType(modelDefinition, k, v);\n          modelValidator(k, parsedValue);\n        });\n      }, function (p) {\n        return patches = p;\n      });\n      if (patches.length) {\n        modelPatchesMap.set(model, [patches, source]);\n        checkReadOnlyPropertyOnUpdate(patches, modelDefinition);\n      }\n      return model;\n    };\n    // \"private\" method (that's hidden via `Setting`) for `withSSRContext` to use\n    // to gain access to `modelInstanceCreator` and `clazz` for persisting IDs from server to client.\n    Model.fromJSON = function (json) {\n      var _this = this;\n      if (Array.isArray(json)) {\n        return json.map(function (init) {\n          return _this.fromJSON(init);\n        });\n      }\n      var instance = modelInstanceCreator(clazz, json);\n      var modelValidator = validateModelFields(modelDefinition);\n      Object.entries(instance).forEach(function (_a) {\n        var _b = __read(_a, 2),\n          k = _b[0],\n          v = _b[1];\n        modelValidator(k, v);\n      });\n      return instance;\n    };\n    return Model;\n  }();\n  clazz[immerable] = true;\n  Object.defineProperty(clazz, 'name', {\n    value: modelDefinition.name\n  });\n  return clazz;\n};\nvar checkReadOnlyPropertyOnCreate = function checkReadOnlyPropertyOnCreate(draft, modelDefinition) {\n  var modelKeys = Object.keys(draft);\n  var fields = modelDefinition.fields;\n  modelKeys.forEach(function (key) {\n    if (fields[key] && fields[key].isReadOnly) {\n      throw new Error(key + \" is read-only.\");\n    }\n  });\n};\nvar checkReadOnlyPropertyOnUpdate = function checkReadOnlyPropertyOnUpdate(patches, modelDefinition) {\n  var patchArray = patches.map(function (p) {\n    return [p.path[0], p.value];\n  });\n  var fields = modelDefinition.fields;\n  patchArray.forEach(function (_a) {\n    var _b = __read(_a, 2),\n      key = _b[0],\n      val = _b[1];\n    if (!val || !fields[key]) return;\n    if (fields[key].isReadOnly) {\n      throw new Error(key + \" is read-only.\");\n    }\n  });\n};\nvar createNonModelClass = function createNonModelClass(typeDefinition) {\n  var clazz = /** @class */function () {\n    function Model(init) {\n      var instance = produce(this, function (draft) {\n        initializeInstance(init, typeDefinition, draft);\n      });\n      return instance;\n    }\n    return Model;\n  }();\n  clazz[immerable] = true;\n  Object.defineProperty(clazz, 'name', {\n    value: typeDefinition.name\n  });\n  registerNonModelClass(clazz);\n  return clazz;\n};\nfunction isQueryOne(obj) {\n  return typeof obj === 'string';\n}\nfunction defaultConflictHandler(conflictData) {\n  var localModel = conflictData.localModel,\n    modelConstructor = conflictData.modelConstructor,\n    remoteModel = conflictData.remoteModel;\n  var _version = remoteModel._version;\n  return modelInstanceCreator(modelConstructor, __assign(__assign({}, localModel), {\n    _version: _version\n  }));\n}\nfunction defaultErrorHandler(error) {\n  logger.warn(error);\n}\nfunction getModelConstructorByModelName(namespaceName, modelName) {\n  var result;\n  switch (namespaceName) {\n    case DATASTORE:\n      result = dataStoreClasses[modelName];\n      break;\n    case USER:\n      result = userClasses[modelName];\n      break;\n    case SYNC:\n      result = syncClasses[modelName];\n      break;\n    case STORAGE:\n      result = storageClasses[modelName];\n      break;\n    default:\n      exhaustiveCheck(namespaceName);\n      break;\n  }\n  if (isValidModelConstructor(result)) {\n    return result;\n  } else {\n    var msg = \"Model name is not valid for namespace. modelName: \" + modelName + \", namespace: \" + namespaceName;\n    logger.error(msg);\n    throw new Error(msg);\n  }\n}\nfunction checkSchemaVersion(storage, version) {\n  return __awaiter(this, void 0, void 0, function () {\n    var Setting, modelDefinition;\n    var _this = this;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          Setting = dataStoreClasses.Setting;\n          modelDefinition = schema.namespaces[DATASTORE].models.Setting;\n          return [4 /*yield*/, storage.runExclusive(function (s) {\n            return __awaiter(_this, void 0, void 0, function () {\n              var _a, schemaVersionSetting, storedValue;\n              return __generator(this, function (_b) {\n                switch (_b.label) {\n                  case 0:\n                    return [4 /*yield*/, s.query(Setting, ModelPredicateCreator.createFromExisting(modelDefinition, function (c) {\n                      // @ts-ignore Argument of type '\"eq\"' is not assignable to parameter of type 'never'.\n                      return c.key('eq', SETTING_SCHEMA_VERSION);\n                    }), {\n                      page: 0,\n                      limit: 1\n                    })];\n                  case 1:\n                    _a = __read.apply(void 0, [_b.sent(), 1]), schemaVersionSetting = _a[0];\n                    if (!(schemaVersionSetting !== undefined && schemaVersionSetting.value !== undefined)) return [3 /*break*/, 4];\n                    storedValue = JSON.parse(schemaVersionSetting.value);\n                    if (!(storedValue !== version)) return [3 /*break*/, 3];\n                    return [4 /*yield*/, s.clear(false)];\n                  case 2:\n                    _b.sent();\n                    _b.label = 3;\n                  case 3:\n                    return [3 /*break*/, 6];\n                  case 4:\n                    return [4 /*yield*/, s.save(modelInstanceCreator(Setting, {\n                      key: SETTING_SCHEMA_VERSION,\n                      value: JSON.stringify(version)\n                    }))];\n                  case 5:\n                    _b.sent();\n                    _b.label = 6;\n                  case 6:\n                    return [2 /*return*/];\n                }\n              });\n            });\n          })];\n\n        case 1:\n          _a.sent();\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n\nvar syncSubscription;\nfunction getNamespace() {\n  var namespace = {\n    name: DATASTORE,\n    relationships: {},\n    enums: {},\n    nonModels: {},\n    models: {\n      Setting: {\n        name: 'Setting',\n        pluralName: 'Settings',\n        syncable: false,\n        fields: {\n          id: {\n            name: 'id',\n            type: 'ID',\n            isRequired: true,\n            isArray: false\n          },\n          key: {\n            name: 'key',\n            type: 'String',\n            isRequired: true,\n            isArray: false\n          },\n          value: {\n            name: 'value',\n            type: 'String',\n            isRequired: true,\n            isArray: false\n          }\n        }\n      }\n    }\n  };\n  return namespace;\n}\nvar DataStore = /** @class */function () {\n  function DataStore() {\n    var _this = this;\n    this.amplifyConfig = {};\n    this.syncPredicates = new WeakMap();\n    this.start = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var aws_appsync_graphqlEndpoint, _a, fullSyncIntervalInMilliseconds;\n        var _this = this;\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              if (!(this.initialized === undefined)) return [3 /*break*/, 1];\n              logger.debug('Starting DataStore');\n              this.initialized = new Promise(function (res, rej) {\n                _this.initResolve = res;\n                _this.initReject = rej;\n              });\n              return [3 /*break*/, 3];\n            case 1:\n              return [4 /*yield*/, this.initialized];\n            case 2:\n              _b.sent();\n              return [2 /*return*/];\n            case 3:\n              this.storage = new Storage(schema, namespaceResolver, getModelConstructorByModelName, modelInstanceCreator, this.storageAdapter, this.sessionId);\n              return [4 /*yield*/, this.storage.init()];\n            case 4:\n              _b.sent();\n              return [4 /*yield*/, checkSchemaVersion(this.storage, schema.version)];\n            case 5:\n              _b.sent();\n              aws_appsync_graphqlEndpoint = this.amplifyConfig.aws_appsync_graphqlEndpoint;\n              if (!aws_appsync_graphqlEndpoint) return [3 /*break*/, 7];\n              logger.debug('GraphQL endpoint available', aws_appsync_graphqlEndpoint);\n              _a = this;\n              return [4 /*yield*/, this.processSyncExpressions()];\n            case 6:\n              _a.syncPredicates = _b.sent();\n              this.sync = new SyncEngine(schema, namespaceResolver, syncClasses, userClasses, this.storage, modelInstanceCreator, this.maxRecordsToSync, this.syncPageSize, this.conflictHandler, this.errorHandler, this.syncPredicates, this.amplifyConfig, this.authModeStrategy);\n              fullSyncIntervalInMilliseconds = this.fullSyncInterval * 1000 * 60;\n              syncSubscription = this.sync.start({\n                fullSyncInterval: fullSyncIntervalInMilliseconds\n              }).subscribe({\n                next: function next(_a) {\n                  var type = _a.type,\n                    data = _a.data;\n                  // In Node, we need to wait for queries to be synced to prevent returning empty arrays.\n                  // In the Browser, we can begin returning data once subscriptions are in place.\n                  var readyType = isNode ? ControlMessage.SYNC_ENGINE_SYNC_QUERIES_READY : ControlMessage.SYNC_ENGINE_STORAGE_SUBSCRIBED;\n                  if (type === readyType) {\n                    _this.initResolve();\n                  }\n                  Hub.dispatch('datastore', {\n                    event: type,\n                    data: data\n                  });\n                },\n                error: function error(err) {\n                  logger.warn('Sync error', err);\n                  _this.initReject();\n                }\n              });\n              return [3 /*break*/, 8];\n            case 7:\n              logger.warn(\"Data won't be synchronized. No GraphQL endpoint configured. Did you forget `Amplify.configure(awsconfig)`?\", {\n                config: this.amplifyConfig\n              });\n              this.initResolve();\n              _b.label = 8;\n            case 8:\n              return [4 /*yield*/, this.initialized];\n            case 9:\n              _b.sent();\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    this.query = function (modelConstructor, idOrCriteria, paginationProducer) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var msg, modelDefinition, predicate, pagination, result;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4 /*yield*/, this.start()];\n            case 1:\n              _a.sent();\n              //#region Input validation\n              if (!isValidModelConstructor(modelConstructor)) {\n                msg = 'Constructor is not for a valid model';\n                logger.error(msg, {\n                  modelConstructor: modelConstructor\n                });\n                throw new Error(msg);\n              }\n              if (typeof idOrCriteria === 'string') {\n                if (paginationProducer !== undefined) {\n                  logger.warn('Pagination is ignored when querying by id');\n                }\n              }\n              modelDefinition = getModelDefinition(modelConstructor);\n              if (isQueryOne(idOrCriteria)) {\n                predicate = ModelPredicateCreator.createForId(modelDefinition, idOrCriteria);\n              } else {\n                if (isPredicatesAll(idOrCriteria)) {\n                  // Predicates.ALL means \"all records\", so no predicate (undefined)\n                  predicate = undefined;\n                } else {\n                  predicate = ModelPredicateCreator.createFromExisting(modelDefinition, idOrCriteria);\n                }\n              }\n              pagination = this.processPagination(modelDefinition, paginationProducer);\n              //#endregion\n              logger.debug('params ready', {\n                modelConstructor: modelConstructor,\n                predicate: ModelPredicateCreator.getPredicates(predicate, false),\n                pagination: __assign(__assign({}, pagination), {\n                  sort: ModelSortPredicateCreator.getPredicates(pagination && pagination.sort, false)\n                })\n              });\n              return [4 /*yield*/, this.storage.query(modelConstructor, predicate, pagination)];\n            case 2:\n              result = _a.sent();\n              return [2 /*return*/, isQueryOne(idOrCriteria) ? result[0] : result];\n          }\n        });\n      });\n    };\n    this.save = function (model, condition) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var patchesTuple, modelConstructor, msg, modelDefinition, producedCondition, _a, savedModel;\n        var _this = this;\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              return [4 /*yield*/, this.start()];\n            case 1:\n              _b.sent();\n              patchesTuple = modelPatchesMap.get(model);\n              modelConstructor = model ? model.constructor : undefined;\n              if (!isValidModelConstructor(modelConstructor)) {\n                msg = 'Object is not an instance of a valid model';\n                logger.error(msg, {\n                  model: model\n                });\n                throw new Error(msg);\n              }\n              modelDefinition = getModelDefinition(modelConstructor);\n              producedCondition = ModelPredicateCreator.createFromExisting(modelDefinition, condition);\n              return [4 /*yield*/, this.storage.runExclusive(function (s) {\n                return __awaiter(_this, void 0, void 0, function () {\n                  return __generator(this, function (_a) {\n                    switch (_a.label) {\n                      case 0:\n                        return [4 /*yield*/, s.save(model, producedCondition, undefined, patchesTuple)];\n                      case 1:\n                        _a.sent();\n                        return [2 /*return*/, s.query(modelConstructor, ModelPredicateCreator.createForId(modelDefinition, model.id))];\n                    }\n                  });\n                });\n              })];\n            case 2:\n              _a = __read.apply(void 0, [_b.sent(), 1]), savedModel = _a[0];\n              return [2 /*return*/, savedModel];\n          }\n        });\n      });\n    };\n    this.setConflictHandler = function (config) {\n      var configDataStore = config.DataStore;\n      var conflictHandlerIsDefault = function conflictHandlerIsDefault() {\n        return _this.conflictHandler === defaultConflictHandler;\n      };\n      if (configDataStore && configDataStore.conflictHandler) {\n        return configDataStore.conflictHandler;\n      }\n      if (conflictHandlerIsDefault() && config.conflictHandler) {\n        return config.conflictHandler;\n      }\n      return _this.conflictHandler || defaultConflictHandler;\n    };\n    this.setErrorHandler = function (config) {\n      var configDataStore = config.DataStore;\n      var errorHandlerIsDefault = function errorHandlerIsDefault() {\n        return _this.errorHandler === defaultErrorHandler;\n      };\n      if (configDataStore && configDataStore.errorHandler) {\n        return configDataStore.errorHandler;\n      }\n      if (errorHandlerIsDefault() && config.errorHandler) {\n        return config.errorHandler;\n      }\n      return _this.errorHandler || defaultErrorHandler;\n    };\n    this.delete = function (modelOrConstructor, idOrCriteria) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var condition, msg, modelConstructor, msg, msg, _a, deleted, model, modelConstructor, msg, modelDefinition, idPredicate, msg, _b, _c, deleted;\n        return __generator(this, function (_d) {\n          switch (_d.label) {\n            case 0:\n              return [4 /*yield*/, this.start()];\n            case 1:\n              _d.sent();\n              if (!modelOrConstructor) {\n                msg = 'Model or Model Constructor required';\n                logger.error(msg, {\n                  modelOrConstructor: modelOrConstructor\n                });\n                throw new Error(msg);\n              }\n              if (!isValidModelConstructor(modelOrConstructor)) return [3 /*break*/, 3];\n              modelConstructor = modelOrConstructor;\n              if (!idOrCriteria) {\n                msg = 'Id to delete or criteria required. Do you want to delete all? Pass Predicates.ALL';\n                logger.error(msg, {\n                  idOrCriteria: idOrCriteria\n                });\n                throw new Error(msg);\n              }\n              if (typeof idOrCriteria === 'string') {\n                condition = ModelPredicateCreator.createForId(getModelDefinition(modelConstructor), idOrCriteria);\n              } else {\n                condition = ModelPredicateCreator.createFromExisting(getModelDefinition(modelConstructor),\n                /**\n                 * idOrCriteria is always a ProducerModelPredicate<T>, never a symbol.\n                 * The symbol is used only for typing purposes. e.g. see Predicates.ALL\n                 */\n                idOrCriteria);\n                if (!condition || !ModelPredicateCreator.isValidPredicate(condition)) {\n                  msg = 'Criteria required. Do you want to delete all? Pass Predicates.ALL';\n                  logger.error(msg, {\n                    condition: condition\n                  });\n                  throw new Error(msg);\n                }\n              }\n              return [4 /*yield*/, this.storage.delete(modelConstructor, condition)];\n            case 2:\n              _a = __read.apply(void 0, [_d.sent(), 1]), deleted = _a[0];\n              return [2 /*return*/, deleted];\n            case 3:\n              model = modelOrConstructor;\n              modelConstructor = Object.getPrototypeOf(model || {}).constructor;\n              if (!isValidModelConstructor(modelConstructor)) {\n                msg = 'Object is not an instance of a valid model';\n                logger.error(msg, {\n                  model: model\n                });\n                throw new Error(msg);\n              }\n              modelDefinition = getModelDefinition(modelConstructor);\n              idPredicate = ModelPredicateCreator.createForId(modelDefinition, model.id);\n              if (idOrCriteria) {\n                if (typeof idOrCriteria !== 'function') {\n                  msg = 'Invalid criteria';\n                  logger.error(msg, {\n                    idOrCriteria: idOrCriteria\n                  });\n                  throw new Error(msg);\n                }\n                condition = idOrCriteria(idPredicate);\n              } else {\n                condition = idPredicate;\n              }\n              return [4 /*yield*/, this.storage.delete(model, condition)];\n            case 4:\n              _b = __read.apply(void 0, [_d.sent(), 1]), _c = __read(_b[0], 1), deleted = _c[0];\n              return [2 /*return*/, deleted];\n          }\n        });\n      });\n    };\n    this.observe = function (modelOrConstructor, idOrCriteria) {\n      var predicate;\n      var modelConstructor = modelOrConstructor && isValidModelConstructor(modelOrConstructor) ? modelOrConstructor : undefined;\n      if (modelOrConstructor && modelConstructor === undefined) {\n        var model = modelOrConstructor;\n        var modelConstructor_1 = model && Object.getPrototypeOf(model).constructor;\n        if (isValidModelConstructor(modelConstructor_1)) {\n          if (idOrCriteria) {\n            logger.warn('idOrCriteria is ignored when using a model instance', {\n              model: model,\n              idOrCriteria: idOrCriteria\n            });\n          }\n          return _this.observe(modelConstructor_1, model.id);\n        } else {\n          var msg = 'The model is not an instance of a PersistentModelConstructor';\n          logger.error(msg, {\n            model: model\n          });\n          throw new Error(msg);\n        }\n      }\n      if (idOrCriteria !== undefined && modelConstructor === undefined) {\n        var msg = 'Cannot provide criteria without a modelConstructor';\n        logger.error(msg, idOrCriteria);\n        throw new Error(msg);\n      }\n      if (modelConstructor && !isValidModelConstructor(modelConstructor)) {\n        var msg = 'Constructor is not for a valid model';\n        logger.error(msg, {\n          modelConstructor: modelConstructor\n        });\n        throw new Error(msg);\n      }\n      if (typeof idOrCriteria === 'string') {\n        predicate = ModelPredicateCreator.createForId(getModelDefinition(modelConstructor), idOrCriteria);\n      } else {\n        predicate = modelConstructor && ModelPredicateCreator.createFromExisting(getModelDefinition(modelConstructor), idOrCriteria);\n      }\n      return new Observable(function (observer) {\n        var handle;\n        (function () {\n          return __awaiter(_this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n              switch (_a.label) {\n                case 0:\n                  return [4 /*yield*/, this.start()];\n                case 1:\n                  _a.sent();\n                  handle = this.storage.observe(modelConstructor, predicate).filter(function (_a) {\n                    var model = _a.model;\n                    return namespaceResolver(model) === USER;\n                  }).subscribe(observer);\n                  return [2 /*return*/];\n              }\n            });\n          });\n        })();\n\n        return function () {\n          if (handle) {\n            handle.unsubscribe();\n          }\n        };\n      });\n    };\n    this.observeQuery = function (model, criteria, options) {\n      return new Observable(function (observer) {\n        var items = new Map();\n        var itemsChanged = new Map();\n        var deletedItemIds = [];\n        var handle;\n        var generateAndEmitSnapshot = function generateAndEmitSnapshot() {\n          var snapshot = generateSnapshot();\n          emitSnapshot(snapshot);\n        };\n        // a mechanism to return data after X amount of seconds OR after the\n        // \"limit\" (itemsChanged >= this.syncPageSize) has been reached, whichever comes first\n        var limitTimerRace = new DeferredCallbackResolver({\n          callback: generateAndEmitSnapshot,\n          errorHandler: observer.error,\n          maxInterval: 2000\n        });\n        var sort = (options || {}).sort;\n        var sortOptions = sort ? {\n          sort: sort\n        } : undefined;\n        (function () {\n          return __awaiter(_this, void 0, void 0, function () {\n            var err_1;\n            var _this = this;\n            return __generator(this, function (_a) {\n              switch (_a.label) {\n                case 0:\n                  _a.trys.push([0, 2,, 3]);\n                  return [4 /*yield*/, this.query(model, criteria, sortOptions)];\n                case 1:\n                  // first, query and return any locally-available records\n                  _a.sent().forEach(function (item) {\n                    return items.set(item.id, item);\n                  });\n                  // observe the model and send a stream of updates (debounced)\n                  handle = this.observe(model,\n                  // @ts-ignore TODO: fix this TSlint error\n                  criteria).subscribe(function (_a) {\n                    var element = _a.element,\n                      model = _a.model,\n                      opType = _a.opType;\n                    // Flag items which have been recently deleted\n                    // NOTE: Merging of separate operations to the same model instance is handled upstream\n                    // in the `mergePage` method within src/sync/merger.ts. The final state of a model instance\n                    // depends on the LATEST record (for a given id).\n                    if (opType === 'DELETE') {\n                      deletedItemIds.push(element.id);\n                    } else {\n                      itemsChanged.set(element.id, element);\n                    }\n                    var isSynced = _this.sync.getModelSyncedStatus(model);\n                    var limit = itemsChanged.size - deletedItemIds.length >= _this.syncPageSize;\n                    if (limit || isSynced) {\n                      limitTimerRace.resolve();\n                    }\n                    // kicks off every subsequent race as results sync down\n                    limitTimerRace.start();\n                  });\n                  // returns a set of initial/locally-available results\n                  generateAndEmitSnapshot();\n                  return [3 /*break*/, 3];\n                case 2:\n                  err_1 = _a.sent();\n                  observer.error(err_1);\n                  return [3 /*break*/, 3];\n                case 3:\n                  return [2 /*return*/];\n              }\n            });\n          });\n        })();\n        // TODO: abstract this function into a util file to be able to write better unit tests\n        var generateSnapshot = function generateSnapshot() {\n          var isSynced = _this.sync.getModelSyncedStatus(model);\n          var itemsArray = __spread(Array.from(items.values()), Array.from(itemsChanged.values()));\n          if (options === null || options === void 0 ? void 0 : options.sort) {\n            sortItems(itemsArray);\n          }\n          items.clear();\n          itemsArray.forEach(function (item) {\n            return items.set(item.id, item);\n          });\n          // remove deleted items from the final result set\n          deletedItemIds.forEach(function (id) {\n            return items.delete(id);\n          });\n          return {\n            items: Array.from(items.values()),\n            isSynced: isSynced\n          };\n        };\n        var emitSnapshot = function emitSnapshot(snapshot) {\n          // send the generated snapshot to the primary subscription\n          observer.next(snapshot);\n          // reset the changed items sets\n          itemsChanged.clear();\n          deletedItemIds = [];\n        };\n        var sortItems = function sortItems(itemsToSort) {\n          var modelDefinition = getModelDefinition(model);\n          var pagination = _this.processPagination(modelDefinition, options);\n          var sortPredicates = ModelSortPredicateCreator.getPredicates(pagination.sort);\n          if (sortPredicates.length) {\n            var compareFn = sortCompareFunction(sortPredicates);\n            itemsToSort.sort(compareFn);\n          }\n        };\n        // send one last snapshot when the model is fully synced\n        var hubCallback = function hubCallback(_a) {\n          var payload = _a.payload;\n          var _b;\n          var event = payload.event,\n            data = payload.data;\n          if (event === ControlMessage.SYNC_ENGINE_MODEL_SYNCED && ((_b = data === null || data === void 0 ? void 0 : data.model) === null || _b === void 0 ? void 0 : _b.name) === model.name) {\n            generateAndEmitSnapshot();\n            Hub.remove('api', hubCallback);\n          }\n        };\n        Hub.listen('datastore', hubCallback);\n        return function () {\n          if (handle) {\n            handle.unsubscribe();\n          }\n        };\n      });\n    };\n    this.configure = function (config) {\n      if (config === void 0) {\n        config = {};\n      }\n      var configDataStore = config.DataStore,\n        configAuthModeStrategyType = config.authModeStrategyType,\n        configConflictHandler = config.conflictHandler,\n        configErrorHandler = config.errorHandler,\n        configMaxRecordsToSync = config.maxRecordsToSync,\n        configSyncPageSize = config.syncPageSize,\n        configFullSyncInterval = config.fullSyncInterval,\n        configSyncExpressions = config.syncExpressions,\n        configAuthProviders = config.authProviders,\n        configStorageAdapter = config.storageAdapter,\n        configFromAmplify = __rest(config, [\"DataStore\", \"authModeStrategyType\", \"conflictHandler\", \"errorHandler\", \"maxRecordsToSync\", \"syncPageSize\", \"fullSyncInterval\", \"syncExpressions\", \"authProviders\", \"storageAdapter\"]);\n      _this.amplifyConfig = __assign(__assign({}, configFromAmplify), _this.amplifyConfig);\n      _this.conflictHandler = _this.setConflictHandler(config);\n      _this.errorHandler = _this.setErrorHandler(config);\n      var authModeStrategyType = configDataStore && configDataStore.authModeStrategyType || configAuthModeStrategyType || AuthModeStrategyType.DEFAULT;\n      switch (authModeStrategyType) {\n        case AuthModeStrategyType.MULTI_AUTH:\n          _this.authModeStrategy = multiAuthStrategy;\n          break;\n        case AuthModeStrategyType.DEFAULT:\n          _this.authModeStrategy = defaultAuthStrategy;\n          break;\n        default:\n          _this.authModeStrategy = defaultAuthStrategy;\n          break;\n      }\n      // store on config object, so that Sync, Subscription, and Mutation processors can have access\n      _this.amplifyConfig.authProviders = configDataStore && configDataStore.authProviders || configAuthProviders;\n      _this.syncExpressions = configDataStore && configDataStore.syncExpressions || _this.syncExpressions || configSyncExpressions;\n      _this.maxRecordsToSync = configDataStore && configDataStore.maxRecordsToSync || configMaxRecordsToSync || 10000;\n      // store on config object, so that Sync, Subscription, and Mutation processors can have access\n      _this.amplifyConfig.maxRecordsToSync = _this.maxRecordsToSync;\n      _this.syncPageSize = configDataStore && configDataStore.syncPageSize || configSyncPageSize || 1000;\n      // store on config object, so that Sync, Subscription, and Mutation processors can have access\n      _this.amplifyConfig.syncPageSize = _this.syncPageSize;\n      _this.fullSyncInterval = configDataStore && configDataStore.fullSyncInterval || _this.fullSyncInterval || configFullSyncInterval || 24 * 60; // 1 day\n      _this.storageAdapter = configDataStore && configDataStore.storageAdapter || _this.storageAdapter || configStorageAdapter || undefined;\n      _this.sessionId = _this.retrieveSessionId();\n    };\n    this.clear = function clear() {\n      return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (this.storage === undefined) {\n                return [2 /*return*/];\n              }\n\n              if (syncSubscription && !syncSubscription.closed) {\n                syncSubscription.unsubscribe();\n              }\n              return [4 /*yield*/, this.storage.clear()];\n            case 1:\n              _a.sent();\n              if (this.sync) {\n                this.sync.unsubscribeConnectivity();\n              }\n              this.initialized = undefined; // Should re-initialize when start() is called.\n              this.storage = undefined;\n              this.sync = undefined;\n              this.syncPredicates = new WeakMap();\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    this.stop = function stop() {\n      return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!(this.initialized !== undefined)) return [3 /*break*/, 2];\n              return [4 /*yield*/, this.start()];\n            case 1:\n              _a.sent();\n              _a.label = 2;\n            case 2:\n              if (syncSubscription && !syncSubscription.closed) {\n                syncSubscription.unsubscribe();\n              }\n              if (this.sync) {\n                this.sync.unsubscribeConnectivity();\n              }\n              this.initialized = undefined; // Should re-initialize when start() is called.\n              this.sync = undefined;\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n  }\n\n  DataStore.prototype.getModuleName = function () {\n    return 'DataStore';\n  };\n  DataStore.prototype.processPagination = function (modelDefinition, paginationProducer) {\n    var sortPredicate;\n    var _a = paginationProducer || {},\n      limit = _a.limit,\n      page = _a.page,\n      sort = _a.sort;\n    if (limit === undefined && page === undefined && sort === undefined) {\n      return undefined;\n    }\n    if (page !== undefined && limit === undefined) {\n      throw new Error('Limit is required when requesting a page');\n    }\n    if (page !== undefined) {\n      if (typeof page !== 'number') {\n        throw new Error('Page should be a number');\n      }\n      if (page < 0) {\n        throw new Error(\"Page can't be negative\");\n      }\n    }\n    if (limit !== undefined) {\n      if (typeof limit !== 'number') {\n        throw new Error('Limit should be a number');\n      }\n      if (limit < 0) {\n        throw new Error(\"Limit can't be negative\");\n      }\n    }\n    if (sort) {\n      sortPredicate = ModelSortPredicateCreator.createFromExisting(modelDefinition, paginationProducer.sort);\n    }\n    return {\n      limit: limit,\n      page: page,\n      sort: sortPredicate\n    };\n  };\n  DataStore.prototype.processSyncExpressions = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var syncPredicates;\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!this.syncExpressions || !this.syncExpressions.length) {\n              return [2 /*return*/, new WeakMap()];\n            }\n            return [4 /*yield*/, Promise.all(this.syncExpressions.map(function (syncExpression) {\n              return __awaiter(_this, void 0, void 0, function () {\n                var _a, modelConstructor, conditionProducer, modelDefinition, condition, predicate;\n                return __generator(this, function (_b) {\n                  switch (_b.label) {\n                    case 0:\n                      return [4 /*yield*/, syncExpression];\n                    case 1:\n                      _a = _b.sent(), modelConstructor = _a.modelConstructor, conditionProducer = _a.conditionProducer;\n                      modelDefinition = getModelDefinition(modelConstructor);\n                      return [4 /*yield*/, this.unwrapPromise(conditionProducer)];\n                    case 2:\n                      condition = _b.sent();\n                      if (isPredicatesAll(condition)) {\n                        return [2 /*return*/, [modelDefinition, null]];\n                      }\n                      predicate = this.createFromCondition(modelDefinition, condition);\n                      return [2 /*return*/, [modelDefinition, predicate]];\n                  }\n                });\n              });\n            }))];\n          case 1:\n            syncPredicates = _a.sent();\n            return [2 /*return*/, this.weakMapFromEntries(syncPredicates)];\n        }\n      });\n    });\n  };\n  DataStore.prototype.createFromCondition = function (modelDefinition, condition) {\n    try {\n      return ModelPredicateCreator.createFromExisting(modelDefinition, condition);\n    } catch (error) {\n      logger.error('Error creating Sync Predicate');\n      throw error;\n    }\n  };\n  DataStore.prototype.unwrapPromise = function (conditionProducer) {\n    return __awaiter(this, void 0, void 0, function () {\n      var condition, error_1;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n            return [4 /*yield*/, conditionProducer()];\n          case 1:\n            condition = _a.sent();\n            return [2 /*return*/, condition];\n          case 2:\n            error_1 = _a.sent();\n            if (error_1 instanceof TypeError) {\n              return [2 /*return*/, conditionProducer];\n            }\n            throw error_1;\n          case 3:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  DataStore.prototype.weakMapFromEntries = function (entries) {\n    return entries.reduce(function (map, _a) {\n      var _b = __read(_a, 2),\n        modelDefinition = _b[0],\n        predicate = _b[1];\n      if (map.has(modelDefinition)) {\n        var name_2 = modelDefinition.name;\n        logger.warn(\"You can only utilize one Sync Expression per model.\\n          Subsequent sync expressions for the \" + name_2 + \" model will be ignored.\");\n        return map;\n      }\n      if (predicate) {\n        map.set(modelDefinition, predicate);\n      }\n      return map;\n    }, new WeakMap());\n  };\n  // database separation for Amplify Console. Not a public API\n  DataStore.prototype.retrieveSessionId = function () {\n    try {\n      var sessionId = sessionStorage.getItem('datastoreSessionId');\n      if (sessionId) {\n        var aws_appsync_graphqlEndpoint = this.amplifyConfig.aws_appsync_graphqlEndpoint;\n        var appSyncUrl = aws_appsync_graphqlEndpoint.split('/')[2];\n        var _a = __read(appSyncUrl.split('.'), 1),\n          appSyncId = _a[0];\n        return sessionId + \"-\" + appSyncId;\n      }\n    } catch (_b) {\n      return undefined;\n    }\n  };\n  return DataStore;\n}();\nvar instance = new DataStore();\nAmplify.register(instance);\nexport { DataStore as DataStoreClass, initSchema, instance as DataStore };","map":{"version":3,"names":["Amplify","ConsoleLogger","Logger","Hub","JS","immerable","produce","setAutoFreeze","enablePatches","v4","uuid4","Observable","defaultAuthStrategy","multiAuthStrategy","isPredicatesAll","ModelPredicateCreator","ModelSortPredicateCreator","ExclusiveStorage","Storage","ControlMessage","SyncEngine","GraphQLScalarType","isGraphQLScalarType","AuthModeStrategyType","isNonModelFieldType","isModelFieldType","DATASTORE","establishRelationAndKeys","exhaustiveCheck","isModelConstructor","monotonicUlidFactory","STORAGE","SYNC","USER","isNullOrUndefined","registerNonModelClass","sortCompareFunction","DeferredCallbackResolver","logger","ulid","Date","now","isNode","browserOrNode","SETTING_SCHEMA_VERSION","schema","modelNamespaceMap","WeakMap","modelPatchesMap","getModelDefinition","modelConstructor","namespace","get","namespaces","models","name","isValidModelConstructor","obj","has","namespaceResolver","syncClasses","userClasses","dataStoreClasses","storageClasses","initSchema","userSchema","undefined","console","warn","log","internalUserNamespace","__assign","createTypeClasses","dataStoreNamespace","getNamespace","storageNamespace","syncNamespace","_a","version","Object","keys","forEach","_b","__read","relations","relationships","modelAssociations","Map","values","model","connectedModels","fields","filter","field","association","connectionType","type","push","set","result","count","size","Error","_c","e_1","__values","Array","from","_d","next","done","modelName","value","parents","every","x","delete","modelTopologicalOrdering","classes","entries","modelDefinition","clazz","createModelClass","nonModels","typeName","typeDefinition","createNonModelClass","instancesMetadata","WeakSet","modelInstanceCreator","init","add","validateModelFields","k","v","fieldDefinition","isRequired_1","isRequired","isArrayNullable","name_1","isArray","jsType_1","getJSType","validateScalar_1","getValidationFunction","JSON","parse","error","errorTypeText","some","e","elemTypes","map","join","validationStatus","s","castInstanceType","Boolean","initializeInstance","draft","modelValidator","parsedValue","Model","instance","modelInstanceMetadata","_id","id","_version","_lastChangedAt","_deleted","isInternal","syncable","checkReadOnlyPropertyOnCreate","copyOf","source","fn","getPrototypeOf","constructor","msg","patches","p","length","checkReadOnlyPropertyOnUpdate","fromJSON","json","_this","defineProperty","modelKeys","key","isReadOnly","patchArray","path","val","isQueryOne","defaultConflictHandler","conflictData","localModel","remoteModel","defaultErrorHandler","getModelConstructorByModelName","namespaceName","checkSchemaVersion","storage","Setting","runExclusive","__awaiter","query","createFromExisting","c","page","limit","apply","sent","schemaVersionSetting","storedValue","clear","save","stringify","syncSubscription","enums","pluralName","DataStore","amplifyConfig","syncPredicates","start","initialized","debug","Promise","res","rej","initResolve","initReject","storageAdapter","sessionId","aws_appsync_graphqlEndpoint","processSyncExpressions","sync","maxRecordsToSync","syncPageSize","conflictHandler","errorHandler","authModeStrategy","fullSyncIntervalInMilliseconds","fullSyncInterval","subscribe","data","readyType","SYNC_ENGINE_SYNC_QUERIES_READY","SYNC_ENGINE_STORAGE_SUBSCRIBED","dispatch","event","err","config","idOrCriteria","paginationProducer","predicate","createForId","pagination","processPagination","getPredicates","sort","condition","patchesTuple","producedCondition","savedModel","setConflictHandler","configDataStore","conflictHandlerIsDefault","setErrorHandler","errorHandlerIsDefault","modelOrConstructor","isValidPredicate","deleted","idPredicate","observe","modelConstructor_1","observer","handle","unsubscribe","observeQuery","criteria","options","items","itemsChanged","deletedItemIds","generateAndEmitSnapshot","snapshot","generateSnapshot","emitSnapshot","limitTimerRace","callback","maxInterval","sortOptions","item","element","opType","isSynced","getModelSyncedStatus","resolve","err_1","itemsArray","__spread","sortItems","itemsToSort","sortPredicates","compareFn","hubCallback","payload","SYNC_ENGINE_MODEL_SYNCED","remove","listen","configure","configAuthModeStrategyType","authModeStrategyType","configConflictHandler","configErrorHandler","configMaxRecordsToSync","configSyncPageSize","configFullSyncInterval","configSyncExpressions","syncExpressions","configAuthProviders","authProviders","configStorageAdapter","configFromAmplify","__rest","DEFAULT","MULTI_AUTH","retrieveSessionId","closed","unsubscribeConnectivity","stop","prototype","getModuleName","sortPredicate","all","syncExpression","conditionProducer","unwrapPromise","createFromCondition","weakMapFromEntries","error_1","TypeError","reduce","name_2","sessionStorage","getItem","appSyncUrl","split","appSyncId","register","DataStoreClass"],"sources":["../../src/datastore/datastore.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module"}